---
title: Python-ç¬¬16ç¯‡ã€Šä¸ªäººç¨åŠ¡åŠ©æ‰‹ã€‹
categories:
  - ğŸŒ™é€¢å‚æ‚è°ˆä¸æ¬è¿
  - â­æœæœè¯¾ç¨‹
abbrlink: f47c2f05
date: 2026-02-02 05:47:04
tags:
---

### å¯¼è¯­

ä¸Šç¯‡æˆ‘ä»¬è§£æ”¾äº†åŒæ‰‹ï¼Œæ‰¹é‡å¤„ç†Excelçš„æ•ˆç‡ç«‹ç«¿è§å½±ã€‚ä½†è´¢åŠ¡å·¥ä½œä¸­è¿˜æœ‰ä¸ªâ€œæ¯å¹´ä¸€åº¦â€çš„é‡å¤´æˆâ€”â€”ä¸ªäººæ‰€å¾—ç¨ï¼ä»Šå¤©å’±ä»¬æ‰“é€ ä¸€ä½è´´èº«çš„ç¨åŠ¡ç®¡å®¶ï¼šå®ƒæ‡‚å¾—æœ€æ–°çš„ä¸ªç¨ç®—æ³•ï¼Œå¸®ä½ ç®¡ç†ä¸ƒé¡¹ä¸“é¡¹é™„åŠ æ‰£é™¤ï¼Œå¹´ç»ˆè¿˜èƒ½ä¸€é”®ç”Ÿæˆæ±‡ç®—æ¸…å•ã€‚

<!--more-->

***

### æœ¬ç¯‡ç›®æ ‡

- ç†è§£ä¸ªç¨ç´¯è®¡é¢„æ‰£æ³•çš„è®¡ç®—é€»è¾‘
- å®ç°è‡ªåŠ¨è®¡ç®—æ¯æœˆåº”ç¼´ä¸ªç¨
- ç®¡ç†ä¸“é¡¹é™„åŠ æ‰£é™¤é¡¹ç›®
- ç”Ÿæˆå¹´åº¦æ±‡ç®—æ¸…ç¼´æŠ¥å‘Š
- é¢„æµ‹å¹´åº¦é€€ç¨æˆ–è¡¥ç¨é‡‘é¢

***

### ä¸€ã€å‡†å¤‡å·¥ä½œï¼šå®‰è£…åº“

```python
# å‘½ä»¤è¡Œè¿è¡Œ
# pip install pandas openpyxl

import pandas as pd
import json
from datetime import datetime
from typing import Dict
import os
```

### äºŒã€ä¸ªç¨è®¡ç®—åŸç†ï¼ˆè¯´äººè¯ç‰ˆï¼‰

2025å¹´çš„ä¸ªç¨é‡‡ç”¨**ç´¯è®¡é¢„æ‰£æ³•**ï¼Œå¬èµ·æ¥å“äººï¼Œå…¶å®å¾ˆè®²é“ç†ï¼š
1. ä»Šå¹´èµšäº†å¤šå°‘ï¼ˆç´¯è®¡æ”¶å…¥ï¼‰
2. èƒ½æ‰£å¤šå°‘ï¼ˆç´¯è®¡äº”é™©ä¸€é‡‘ + ç´¯è®¡åŸºæœ¬å‡é™¤è´¹ç”¨60,000 + ç´¯è®¡ä¸“é¡¹é™„åŠ æ‰£é™¤ï¼‰
3. å·®é¢éƒ¨åˆ†æŒ‰ç¨ç‡è¡¨ç®—ç¨
4. å‡å»ä¹‹å‰æœˆä»½å·²äº¤çš„ç¨

**ç¨ç‡è¡¨é€ŸæŸ¥ï¼ˆ2025å¹´ï¼‰ï¼š**
| ç´¯è®¡åº”çº³ç¨æ‰€å¾—é¢        | ç¨ç‡  | é€Ÿç®—æ‰£é™¤æ•°  |
| --------------- | --- | ------ |
| â‰¤ 36,000        | 3%  | 0      |
| 36,000-144,000  | 10% | 2,520  |
| 144,000-300,000 | 20% | 16,920 |
| ...ä»¥æ­¤ç±»æ¨         | ... | ...    |

```python
# ========== ä¸ªç¨è®¡ç®—å¼•æ“ ==========
# 2025å¹´ä¸ªç¨ç¨ç‡è¡¨ï¼ˆç»¼åˆæ‰€å¾—é€‚ç”¨ï¼‰
TAX_BRACKETS = [
    (0, 36000, 0.03, 0),
    (36000, 144000, 0.10, 2520),
    (144000, 300000, 0.20, 16920),
    (300000, 420000, 0.25, 31920),
    (420000, 660000, 0.30, 52920),
    (660000, 960000, 0.35, 85920),
    (960000, float('inf'), 0.45, 181920)
]

def calculate_monthly_tax(
    monthly_income: float,
    monthly_insurance: float,
    special_deductions: Dict[str, float],
    months_passed: int = 1,
    previous_tax: float = 0
) -> Dict:
    """
    è®¡ç®—å•æœˆä¸ªç¨ï¼ˆç´¯è®¡é¢„æ‰£æ³•ï¼‰
    
    å‚æ•°:
        monthly_income: æœ¬æœˆæ”¶å…¥
        monthly_insurance: æœ¬æœˆäº”é™©ä¸€é‡‘
        special_deductions: ä¸“é¡¹é™„åŠ æ‰£é™¤ç´¯è®¡
        months_passed: å·²è¿‡æœˆä»½æ•°ï¼ˆ1-12ï¼‰
        previous_tax: ä¹‹å‰æœˆä»½å·²ç¼´ç¨é¢
    """
    # 1. è®¡ç®—ç´¯è®¡å€¼
    cumulative_income = monthly_income * months_passed
    cumulative_insurance = monthly_insurance * months_passed
    cumulative_basic_deduction = 5000 * months_passed  # åŸºæœ¬å‡é™¤è´¹ç”¨5000/æœˆ
    cumulative_special = sum(special_deductions.values()) * months_passed
    
    # 2. è®¡ç®—ç´¯è®¡åº”çº³ç¨æ‰€å¾—é¢
    taxable_income = cumulative_income - cumulative_insurance - cumulative_basic_deduction - cumulative_special
    
    if taxable_income <= 0:
        return {
            "æœ¬æœˆåº”ç¼´ä¸ªç¨": 0,
            "ç´¯è®¡åº”ç¼´ä¸ªç¨": 0,
            "ç´¯è®¡å·²ç¼´ä¸ªç¨": previous_tax,
            "ç´¯è®¡åº”çº³ç¨æ‰€å¾—é¢": taxable_income,
            "é€‚ç”¨ç¨ç‡": 0,
            "é€Ÿç®—æ‰£é™¤æ•°": 0
        }
    
    # 3. æŸ¥æ‰¾é€‚ç”¨ç¨ç‡
    for low, high, rate, deduction in TAX_BRACKETS:
        if low < taxable_income <= high:
            # 4. è®¡ç®—ç´¯è®¡åº”ç¼´ç¨é¢
            cumulative_tax = taxable_income * rate - deduction
            current_month_tax = cumulative_tax - previous_tax
            
            return {
                "æœ¬æœˆåº”ç¼´ä¸ªç¨": round(current_month_tax, 2),
                "ç´¯è®¡åº”ç¼´ä¸ªç¨": round(cumulative_tax, 2),
                "ç´¯è®¡å·²ç¼´ä¸ªç¨": round(previous_tax, 2),
                "ç´¯è®¡åº”çº³ç¨æ‰€å¾—é¢": round(taxable_income, 2),
                "é€‚ç”¨ç¨ç‡": f"{int(rate*100)}%",
                "é€Ÿç®—æ‰£é™¤æ•°": deduction
            }
    
    return {"error": "è®¡ç®—å¼‚å¸¸"}

# æµ‹è¯•ä¸ªç¨è®¡ç®—
def test_tax():
    print("ğŸ§® ä¸ªç¨è®¡ç®—æµ‹è¯•ï¼š")
    
    # æ¡ˆä¾‹ï¼šå°ç‹æœˆè–ª20,000ï¼Œäº”é™©ä¸€é‡‘3,000ï¼Œæœ‰æˆ¿è´·åˆ©æ¯ä¸“é¡¹æ‰£é™¤
    result = calculate_monthly_tax(
        monthly_income=20000,
        monthly_insurance=3000,
        special_deductions={"ä½æˆ¿è´·æ¬¾åˆ©æ¯": 1000},
        months_passed=6,  # è®¡ç®—6æœˆä»½ä¸ªç¨
        previous_tax=4320  # å‰5ä¸ªæœˆå·²ç¼´4320å…ƒ
    )
    
    for key, value in result.items():
        print(f"  {key}: {value}")

# test_tax()
```

***

### ä¸‰ã€ä¸“é¡¹é™„åŠ æ‰£é™¤ç®¡ç†

ä¸ƒé¡¹æ‰£é™¤é¡¹ï¼šå­å¥³æ•™è‚²ã€ç»§ç»­æ•™è‚²ã€å¤§ç—…åŒ»ç–—ã€ä½æˆ¿è´·æ¬¾åˆ©æ¯ã€ä½æˆ¿ç§Ÿé‡‘ã€èµ¡å…»è€äººã€3å²ä»¥ä¸‹å©´å¹¼å„¿ç…§æŠ¤

```python
# ========== ä¸“é¡¹é™„åŠ æ‰£é™¤ç®¡ç† ==========
class SpecialDeductionManager:
    """ä¸“é¡¹é™„åŠ æ‰£é™¤ç®¡ç†å™¨"""
    
    # æ‰£é™¤æ ‡å‡†ï¼ˆ2025å¹´ï¼‰
    DEDUCTION_STANDARDS = {
        "å­å¥³æ•™è‚²": 2000,  # æ¯ä¸ªå­å¥³æ¯æœˆ
        "ç»§ç»­æ•™è‚²": 400,   # å­¦å†æ•™è‚²æ¯æœˆ
        "å¤§ç—…åŒ»ç–—": 0,     # å¹´åº¦æ±‡ç®—æ—¶æ®å®æ‰£é™¤
        "ä½æˆ¿è´·æ¬¾åˆ©æ¯": 1000,  # æ¯æœˆ
        "ä½æˆ¿ç§Ÿé‡‘": 1500,      # ç›´è¾–å¸‚æ ‡å‡†ï¼Œå…¶ä»–1100æˆ–800
        "èµ¡å…»è€äºº": 3000,      # ç‹¬ç”Ÿå­å¥³æ¯æœˆ
        "3å²ä»¥ä¸‹å©´å¹¼å„¿ç…§æŠ¤": 2000  # æ¯ä¸ªå©´å¹¼å„¿æ¯æœˆ
    }
    
    def __init__(self, data_file="deductions.json"):
        self.data_file = data_file
        self.deductions = self.load_deductions()
    
    def load_deductions(self):
        """åŠ è½½æ‰£é™¤é¡¹"""
        if os.path.exists(self.data_file):
            try:
                with open(self.data_file, 'r', encoding='utf-8') as f:
                    return json.load(f)
            except:
                pass
        return {}
    
    def save_deductions(self):
        """ä¿å­˜æ‰£é™¤é¡¹"""
        with open(self.data_file, 'w', encoding='utf-8') as f:
            json.dump(self.deductions, f, ensure_ascii=False, indent=2)
    
    def add_deduction(self, category: str, details: str, amount: float = None):
        """æ·»åŠ æ‰£é™¤é¡¹"""
        if category not in self.DEDUCTION_STANDARDS:
            print(f"âš ï¸ æ— æ•ˆçš„æ‰£é™¤ç±»åˆ«ï¼š{category}")
            print(f"å¯é€‰ç±»åˆ«: {list(self.DEDUCTION_STANDARDS.keys())}")
            return
        
        if amount is None:
            amount = self.DEDUCTION_STANDARDS[category]
        
        # éªŒè¯é‡‘é¢åˆç†æ€§
        if amount > self.DEDUCTION_STANDARDS[category] * 1.2:
            print(f"âš ï¸ æ³¨æ„ï¼š{category}æ ‡å‡†é‡‘é¢ä¸º{self.DEDUCTION_STANDARDS[category]}å…ƒ")
            confirm = input("æ˜¯å¦ç»§ç»­ï¼Ÿ(y/n): ")
            if confirm.lower() != 'y':
                return
        
        self.deductions[category] = {
            "é‡‘é¢": amount,
            "è¯¦æƒ…": details,
            "æ·»åŠ æ—¶é—´": datetime.now().strftime('%Y-%m-%d')
        }
        self.save_deductions()
        print(f"âœ… å·²æ·»åŠ  {category}: Â¥{amount}/æœˆ - {details}")
    
    def remove_deduction(self, category: str):
        """åˆ é™¤æ‰£é™¤é¡¹"""
        if category in self.deductions:
            del self.deductions[category]
            self.save_deductions()
            print(f"âœ… å·²åˆ é™¤ {category}")
        else:
            print(f"âš ï¸ æœªæ‰¾åˆ° {category}")
    
    def list_deductions(self):
        """åˆ—å‡ºæ‰€æœ‰æ‰£é™¤é¡¹"""
        print("\n" + "=" * 50)
        print("ä¸“é¡¹é™„åŠ æ‰£é™¤æ¸…å•")
        print("=" * 50)
        
        if not self.deductions:
            print("ğŸ“­ æš‚æ— æ‰£é™¤é¡¹")
            return {}
        
        total_monthly = 0
        for cat, info in self.deductions.items():
            print(f"\nğŸ·ï¸ {cat}:")
            print(f"  é‡‘é¢: Â¥{info['é‡‘é¢']}/æœˆ")
            print(f"  è¯¦æƒ…: {info['è¯¦æƒ…']}")
            print(f"  æ·»åŠ æ—¶é—´: {info['æ·»åŠ æ—¶é—´']}")
            total_monthly += info['é‡‘é¢']
        
        print(f"\nğŸ’¡ åˆè®¡æ¯æœˆå¯æ‰£é™¤: Â¥{total_monthly}")
        print(f"ğŸ’° å¹´åº¦å¯æ‰£é™¤: Â¥{total_monthly * 12}")
        
        return self.deductions

def manage_deductions():
    """äº¤äº’å¼ç®¡ç†æ‰£é™¤é¡¹"""
    manager = SpecialDeductionManager()
    
    while True:
        print("\n" + "=" * 45)
        print("ä¸“é¡¹é™„åŠ æ‰£é™¤ç®¡ç†")
        print("=" * 45)
        print("1. æ·»åŠ æ‰£é™¤é¡¹")
        print("2. åˆ é™¤æ‰£é™¤é¡¹")
        print("3. æŸ¥çœ‹æ‰€æœ‰æ‰£é™¤é¡¹")
        print("4. è¿”å›ä¸Šçº§èœå•")
        print("=" * 45)
        
        choice = input("è¯·é€‰æ‹©: ").strip()
        
        if choice == "1":
            print("\nğŸ“ æ·»åŠ æ‰£é™¤é¡¹")
            print("å¯é€‰ç±»åˆ«:")
            for i, cat in enumerate(manager.DEDUCTION_STANDARDS.keys(), 1):
                print(f"  {i}. {cat}")
            
            cat_input = input("\nè¯·è¾“å…¥ç±»åˆ«åç§°: ").strip()
            if cat_input not in manager.DEDUCTION_STANDARDS:
                print("âŒ ç±»åˆ«åç§°é”™è¯¯ï¼")
                continue
            
            details = input("è¯¦ç»†è¯´æ˜: ").strip()
            custom_amount = input("é‡‘é¢ï¼ˆç›´æ¥å›è½¦ä½¿ç”¨æ ‡å‡†ï¼‰: ").strip()
            
            if custom_amount:
                try:
                    amount = float(custom_amount)
                    manager.add_deduction(cat_input, details, amount)
                except:
                    print("âŒ é‡‘é¢æ ¼å¼é”™è¯¯")
            else:
                manager.add_deduction(cat_input, details)
        
        elif choice == "2":
            manager.list_deductions()
            cat = input("\nè¦åˆ é™¤çš„ç±»åˆ«åç§°: ").strip()
            manager.remove_deduction(cat)
        
        elif choice == "3":
            manager.list_deductions()
            input("\næŒ‰å›è½¦é”®ç»§ç»­...")
        
        elif choice == "4":
            break
```

***

### å››ã€å¹´åº¦æ±‡ç®—å‡†å¤‡

```python
# ========== å¹´åº¦æ±‡ç®—æ¸…ç¼´ ==========
class TaxYearCalculator:
    """å¹´åº¦ä¸ªç¨è®¡ç®—å™¨"""
    
    def __init__(self, deduction_manager: SpecialDeductionManager):
        self.dm = deduction_manager
        self.records = []
    
    def add_monthly_record(self, month: int, income: float, insurance: float, tax_paid: float):
        """æ·»åŠ æœˆåº¦æ•°æ®"""
        self.records.append({
            "æœˆä»½": month,
            "æ”¶å…¥": income,
            "äº”é™©ä¸€é‡‘": insurance,
            "å·²ç¼´ä¸ªç¨": tax_paid
        })
        print(f"âœ… å·²è®°å½• {month}æœˆæ•°æ®")
    
    def generate_annual_report(self):
        """ç”Ÿæˆå¹´åº¦æ±‡ç®—æŠ¥å‘Š"""
        if not self.records:
            print("âš ï¸ æš‚æ— æœˆåº¦æ•°æ®")
            return
        
        print("\n" + "=" * 55)
        print("å¹´åº¦ä¸ªç¨æ±‡ç®—æ¸…ç¼´æŠ¥å‘Š")
        print("=" * 55)
        
        df = pd.DataFrame(self.records)
        
        # è®¡ç®—ç´¯è®¡å€¼
        total_income = df['æ”¶å…¥'].sum()
        total_insurance = df['äº”é™©ä¸€é‡‘'].sum()
        total_tax_paid = df['å·²ç¼´ä¸ªç¨'].sum()
        
        # è·å–ä¸“é¡¹é™„åŠ æ‰£é™¤
        special_deductions = self.dm.list_deductions()
        total_special = sum(v['é‡‘é¢'] for v in special_deductions.values()) * 12
        
        # è®¡ç®—åº”çº³ç¨æ‰€å¾—é¢
        taxable_income = total_income - total_insurance - 60000 - total_special
        
        print(f"\nğŸ’° æ”¶å…¥æƒ…å†µ:")
        print(f"  å¹´åº¦æ€»æ”¶å…¥: Â¥{total_income:,.2f}")
        print(f"  å¹´åº¦äº”é™©ä¸€é‡‘: Â¥{total_insurance:,.2f}")
        print(f"  å¹´åº¦ä¸“é¡¹é™„åŠ æ‰£é™¤: Â¥{total_special:,.2f}")
        print(f"  åŸºæœ¬å‡é™¤è´¹ç”¨: Â¥60,000.00")
        
        print(f"\nğŸ“Š åº”çº³ç¨æ‰€å¾—é¢: Â¥{taxable_income:,.2f}")
        
        if taxable_income <= 0:
            print("ğŸ‰ æ­å–œï¼æ‚¨æ— éœ€ç¼´çº³ä¸ªç¨")
            return
        
        # è®¡ç®—åº”ç¼´ä¸ªç¨
        for low, high, rate, deduction in TAX_BRACKETS:
            if low < taxable_income <= high:
                annual_tax = taxable_income * rate - deduction
                break
        
        print(f"\nğŸ’¸ ä¸ªç¨è®¡ç®—:")
        print(f"  é€‚ç”¨ç¨ç‡: {int(rate*100)}%")
        print(f"  é€Ÿç®—æ‰£é™¤æ•°: Â¥{deduction:,}")
        print(f"  å¹´åº¦åº”ç¼´ä¸ªç¨: Â¥{annual_tax:,.2f}")
        print(f"  å¹´åº¦å·²ç¼´ä¸ªç¨: Â¥{total_tax_paid:,.2f}")
        
        # é€€ç¨/è¡¥ç¨åˆ¤æ–­
        diff = annual_tax - total_tax_paid
        
        if diff > 0:
            print(f"\nâš ï¸ éœ€è¦è¡¥ç¨: Â¥{diff:,.2f}")
            print("   è¯·åœ¨æ¬¡å¹´3-6æœˆé€šè¿‡ä¸ªç¨APPåŠç†æ±‡ç®—å¹¶è¡¥ç¼´")
        elif diff < 0:
            print(f"\nğŸ‰ å¯ä»¥é€€ç¨: Â¥{abs(diff):,.2f}")
            print("   è¯·åœ¨æ¬¡å¹´3-6æœˆé€šè¿‡ä¸ªç¨APPç”³è¯·é€€ç¨")
        else:
            print(f"\nâœ… å·²ç¼´ç¨é¢ä¸åº”ç¼´ç¨é¢ä¸€è‡´ï¼Œæ— éœ€è¡¥é€€")
        
        # ç”ŸæˆæŠ¥è¡¨æ–‡ä»¶
        report_data = {
            "é¡¹ç›®": ["å¹´åº¦æ€»æ”¶å…¥", "å¹´åº¦äº”é™©ä¸€é‡‘", "ä¸“é¡¹é™„åŠ æ‰£é™¤", "åŸºæœ¬å‡é™¤è´¹ç”¨", "åº”çº³ç¨æ‰€å¾—é¢", 
                     "å¹´åº¦åº”ç¼´ä¸ªç¨", "å¹´åº¦å·²ç¼´ä¸ªç¨", "é€€ç¨/è¡¥ç¨é‡‘é¢"],
            "é‡‘é¢": [total_income, total_insurance, total_special, 60000, taxable_income,
                     annual_tax, total_tax_paid, abs(diff) if diff != 0 else 0],
            "è¯´æ˜": ["", "", "", "", "", "", "", "æ­£æ•°ä¸ºè¡¥ç¨ï¼Œè´Ÿæ•°ä¸ºé€€ç¨"]
        }
        
        report_df = pd.DataFrame(report_data)
        filename = f"ä¸ªç¨æ±‡ç®—æŠ¥å‘Š_{datetime.now().strftime('%Y%m%d')}.xlsx"
        report_df.to_excel(filename, index=False)
        
        print(f"\nâœ… è¯¦ç»†æŠ¥å‘Šå·²ä¿å­˜: {filename}")

def input_monthly_data():
    """äº¤äº’å¼è¾“å…¥æœˆåº¦æ•°æ®"""
    calculator = TaxYearCalculator(deduction_manager)
    
    while True:
        print("\n" + "=" * 40)
        print("ğŸ“… å½•å…¥æœˆåº¦å·¥èµ„æ•°æ®")
        print("=" * 40)
        
        month = input("æœˆä»½ï¼ˆ1-12ï¼Œæˆ–qé€€å‡ºï¼‰: ").strip()
        if month.lower() == 'q':
            break
        
        try:
            month = int(month)
            if not 1 <= month <= 12:
                print("æœˆä»½å¿…é¡»åœ¨1-12ä¹‹é—´ï¼")
                continue
        except:
            print("è¯·è¾“å…¥æ•°å­—ï¼")
            continue
        
        try:
            income = float(input("æœ¬æœˆæ”¶å…¥: ").strip())
            insurance = float(input("æœ¬æœˆäº”é™©ä¸€é‡‘: ").strip())
            tax_paid = float(input("æœ¬æœˆå·²ç¼´ä¸ªç¨: ").strip())
            
            calculator.add_monthly_record(month, income, insurance, tax_paid)
        except:
            print("âŒ é‡‘é¢æ ¼å¼é”™è¯¯ï¼")
        
        another = input("\nç»§ç»­å½•å…¥ä¸‹ä¸€ä¸ªæœˆï¼Ÿ(y/n): ").strip()
        if another.lower() != 'y':
            break
    
    return calculator
```

***

### äº”ã€å®Œæ•´é¡¹ç›®ä»£ç 

```python
# ========== ä¸ªäººç¨åŠ¡åŠ©æ‰‹ - å®Œæ•´ç‰ˆ ==========
import json
import pandas as pd
from datetime import datetime
from typing import Dict
import os

# 2025å¹´ä¸ªç¨ç¨ç‡è¡¨
TAX_BRACKETS = [
    (0, 36000, 0.03, 0),
    (36000, 144000, 0.10, 2520),
    (144000, 300000, 0.20, 16920),
    (300000, 420000, 0.25, 31920),
    (420000, 660000, 0.30, 52920),
    (660000, 960000, 0.35, 85920),
    (960000, float('inf'), 0.45, 181920)
]

class SpecialDeductionManager:
    """ä¸“é¡¹é™„åŠ æ‰£é™¤ç®¡ç†"""
    
    DEDUCTION_STANDARDS = {
        "å­å¥³æ•™è‚²": 2000, "ç»§ç»­æ•™è‚²": 400, "å¤§ç—…åŒ»ç–—": 0,
        "ä½æˆ¿è´·æ¬¾åˆ©æ¯": 1000, "ä½æˆ¿ç§Ÿé‡‘": 1500,
        "èµ¡å…»è€äºº": 3000, "3å²ä»¥ä¸‹å©´å¹¼å„¿ç…§æŠ¤": 2000
    }
    
    def __init__(self, data_file="deductions.json"):
        self.data_file = data_file
        self.deductions = self.load_deductions()
    
    def load_deductions(self):
        if os.path.exists(self.data_file):
            try:
                with open(self.data_file, 'r', encoding='utf-8') as f:
                    return json.load(f)
            except:
                pass
        return {}
    
    def save_deductions(self):
        with open(self.data_file, 'w', encoding='utf-8') as f:
            json.dump(self.deductions, f, ensure_ascii=False, indent=2)
    
    def add_deduction(self, category: str, details: str, amount: float = None):
        if category not in self.DEDUCTION_STANDARDS:
            print(f"âŒ æ— æ•ˆç±»åˆ«: {category}")
            return False
        
        if amount is None:
            amount = self.DEDUCTION_STANDARDS[category]
        
        self.deductions[category] = {
            "é‡‘é¢": amount,
            "è¯¦æƒ…": details,
            "æ·»åŠ æ—¶é—´": datetime.now().strftime('%Y-%m-%d')
        }
        self.save_deductions()
        print(f"âœ… å·²æ·»åŠ  {category}: Â¥{amount}/æœˆ")
        return True
    
    def remove_deduction(self, category: str):
        if category in self.deductions:
            del self.deductions[category]
            self.save_deductions()
            print(f"âœ… å·²åˆ é™¤ {category}")
        else:
            print(f"âš ï¸ æœªæ‰¾åˆ° {category}")
    
    def list_deductions(self):
        if not self.deductions:
            print("ğŸ“­ æš‚æ— æ‰£é™¤é¡¹")
            return {}
        
        total = 0
        print("\n" + "=" * 45)
        print("ä¸“é¡¹é™„åŠ æ‰£é™¤æ¸…å•")
        print("=" * 45)
        
        for cat, info in self.deductions.items():
            print(f"\nğŸ·ï¸ {cat}:")
            print(f"  é‡‘é¢: Â¥{info['é‡‘é¢']}/æœˆ")
            print(f"  è¯¦æƒ…: {info['è¯¦æƒ…']}")
            total += info['é‡‘é¢']
        
        print(f"\nğŸ’¡ åˆè®¡: Â¥{total}/æœˆ (å¹´åº¦Â¥{total*12})")
        return self.deductions

class TaxYearCalculator:
    """å¹´åº¦ä¸ªç¨è®¡ç®—å™¨"""
    
    def __init__(self, deduction_manager: SpecialDeductionManager):
        self.dm = deduction_manager
        self.records = []
    
    def add_monthly_record(self, month: int, income: float, insurance: float, tax_paid: float):
        self.records.append({
            "æœˆä»½": month,
            "æ”¶å…¥": income,
            "äº”é™©ä¸€é‡‘": insurance,
            "å·²ç¼´ä¸ªç¨": tax_paid
        })
    
    def generate_report(self):
        if not self.records:
            print("âš ï¸ æš‚æ— æ•°æ®")
            return
        
        print("\n" + "=" * 55)
        print("å¹´åº¦ä¸ªç¨æ±‡ç®—æ¸…ç¼´æŠ¥å‘Š")
        print("=" * 55)
        
        df = pd.DataFrame(self.records)
        total_income = df['æ”¶å…¥'].sum()
        total_insurance = df['äº”é™©ä¸€é‡‘'].sum()
        total_tax_paid = df['å·²ç¼´ä¸ªç¨'].sum()
        
        special_deductions = self.dm.list_deductions()
        total_special = sum(v['é‡‘é¢'] for v in special_deductions.values()) * 12
        
        taxable_income = total_income - total_insurance - 60000 - total_special
        
        print(f"\nğŸ’° æ”¶å…¥æƒ…å†µ:")
        print(f"  å¹´åº¦æ€»æ”¶å…¥: Â¥{total_income:,.2f}")
        print(f"  å¹´åº¦äº”é™©ä¸€é‡‘: Â¥{total_insurance:,.2f}")
        print(f"  ä¸“é¡¹é™„åŠ æ‰£é™¤: Â¥{total_special:,.2f}")
        print(f"  åº”çº³ç¨æ‰€å¾—é¢: Â¥{taxable_income:,.2f}")
        
        if taxable_income <= 0:
            print("ğŸ‰ æ— éœ€ç¼´çº³ä¸ªç¨")
            return
        
        for low, high, rate, deduction in TAX_BRACKETS:
            if low < taxable_income <= high:
                annual_tax = taxable_income * rate - deduction
                break
        
        print(f"\nğŸ’¸ å¹´åº¦åº”ç¼´ä¸ªç¨: Â¥{annual_tax:,.2f}")
        print(f"ğŸ’µ å¹´åº¦å·²ç¼´ä¸ªç¨: Â¥{total_tax_paid:,.2f}")
        
        diff = annual_tax - total_tax_paid
        
        if diff > 0:
            print(f"\nâš ï¸ éœ€è¦è¡¥ç¨: Â¥{diff:,.2f}")
        elif diff < 0:
            print(f"\nğŸ‰ å¯ä»¥é€€ç¨: Â¥{abs(diff):,.2f}")
        else:
            print("\nâœ… æ— éœ€è¡¥é€€")
        
        # ä¿å­˜æŠ¥å‘Š
        report_data = {
            "é¡¹ç›®": ["å¹´åº¦æ€»æ”¶å…¥", "äº”é™©ä¸€é‡‘", "ä¸“é¡¹æ‰£é™¤", "åŸºæœ¬å‡é™¤", "åº”çº³ç¨æ‰€å¾—é¢", 
                     "åº”ç¼´ä¸ªç¨", "å·²ç¼´ä¸ªç¨", "è¡¥ç¨/é€€ç¨"],
            "é‡‘é¢": [total_income, total_insurance, total_special, 60000, taxable_income,
                     annual_tax, total_tax_paid, diff],
            "è¯´æ˜": ["", "", "", "", "", "", "", "æ­£æ•°è¡¥ç¨ï¼Œè´Ÿæ•°é€€ç¨"]
        }
        
        report_df = pd.DataFrame(report_data)
        filename = f"ä¸ªç¨æ±‡ç®—æŠ¥å‘Š_{datetime.now().strftime('%Y%m%d')}.xlsx"
        report_df.to_excel(filename, index=False)
        print(f"\nâœ… æŠ¥å‘Šå·²ä¿å­˜: {filename}")

def calculate_single_month():
    """å•æœˆä¸ªç¨è®¡ç®—"""
    print("\n" + "=" * 40)
    print("ğŸ“… å•æœˆä¸ªç¨è®¡ç®—å™¨")
    print("=" * 40)
    
    try:
        income = float(input("æœ¬æœˆæ”¶å…¥: ").strip())
        insurance = float(input("æœ¬æœˆäº”é™©ä¸€é‡‘: ").strip())
        
        dm = SpecialDeductionManager()
        special = dm.list_deductions()
        
        months_passed = int(input("å·²è¿‡æœˆä»½æ•°: ").strip())
        previous_tax = float(input("ä¹‹å‰ç´¯è®¡å·²ç¼´ä¸ªç¨: ").strip())
        
        result = calculate_monthly_tax(
            income, insurance, special, months_passed, previous_tax
        )
        
        print("\n" + "=" * 40)
        for key, value in result.items():
            print(f"{key}: {value}")
        
    except Exception as e:
        print(f"âŒ è¾“å…¥é”™è¯¯: {e}")

def main():
    dm = SpecialDeductionManager()
    
    while True:
        print("\n" + "=" * 50)
        print("ä¸ªäººç¨åŠ¡åŠ©æ‰‹ v1.0")
        print("=" * 50)
        print("1. ç®¡ç†ä¸“é¡¹é™„åŠ æ‰£é™¤")
        print("2. è®¡ç®—å•æœˆä¸ªç¨")
        print("3. å½•å…¥å¹´åº¦å·¥èµ„æ•°æ®")
        print("4. ç”Ÿæˆå¹´åº¦æ±‡ç®—æŠ¥å‘Š")
        print("5. é€€å‡º")
        print("=" * 50)
        
        choice = input("è¯·é€‰æ‹©åŠŸèƒ½: ").strip()
        
        if choice == "1":
            while True:
                print("\n" + "=" * 40)
                print("ä¸“é¡¹é™„åŠ æ‰£é™¤ç®¡ç†")
                print("=" * 40)
                print("1. æ·»åŠ æ‰£é™¤é¡¹")
                print("2. åˆ é™¤æ‰£é™¤é¡¹")
                print("3. æŸ¥çœ‹æ‰£é™¤é¡¹")
                print("4. è¿”å›ä¸Šçº§")
                
                c = input("è¯·é€‰æ‹©: ").strip()
                
                if c == "1":
                    cats = list(dm.DEDUCTION_STANDARDS.keys())
                    print("\nå¯é€‰ç±»åˆ«:")
                    for i, cat in enumerate(cats, 1):
                        print(f"  {i}. {cat}")
                    
                    cat_name = input("\nç±»åˆ«åç§°: ").strip()
                    if cat_name not in cats:
                        print("âŒ ç±»åˆ«é”™è¯¯ï¼")
                        continue
                    
                    details = input("è¯¦æƒ…: ").strip()
                    custom = input("é‡‘é¢ï¼ˆå›è½¦ä½¿ç”¨æ ‡å‡†ï¼‰: ").strip()
                    
                    if custom:
                        try:
                            amt = float(custom)
                            dm.add_deduction(cat_name, details, amt)
                        except:
                            print("âŒ é‡‘é¢æ ¼å¼é”™è¯¯")
                    else:
                        dm.add_deduction(cat_name, details)
                
                elif c == "2":
                    dm.list_deductions()
                    cat = input("\nåˆ é™¤çš„ç±»åˆ«: ").strip()
                    dm.remove_deduction(cat)
                
                elif c == "3":
                    dm.list_deductions()
                    input("\næŒ‰å›è½¦ç»§ç»­...")
                
                elif c == "4":
                    break
        
        elif choice == "2":
            calculate_single_month()
            input("\næŒ‰å›è½¦ç»§ç»­...")
        
        elif choice == "3":
            calc = TaxYearCalculator(dm)
            while True:
                print("\nå½•å…¥æœˆåº¦æ•°æ®ï¼ˆqé€€å‡ºï¼‰")
                month = input("æœˆä»½: ").strip()
                if month == 'q':
                    break
                try:
                    m = int(month)
                    inc = float(input("æ”¶å…¥: ").strip())
                    ins = float(input("äº”é™©ä¸€é‡‘: ").strip())
                    tax = float(input("å·²ç¼´ä¸ªç¨: ").strip())
                    calc.add_monthly_record(m, inc, ins, tax)
                except Exception as e:
                    print(f"âŒ é”™è¯¯: {e}")
        
        elif choice == "4":
            calc = TaxYearCalculator(dm)
            # é‡æ–°åŠ è½½records
            for record in calc.records:
                calc.add_monthly_record(record['æœˆä»½'], record['æ”¶å…¥'], 
                                      record['äº”é™©ä¸€é‡‘'], record['å·²ç¼´ä¸ªç¨'])
            calc.generate_report()
            input("\næŒ‰å›è½¦ç»§ç»­...")
        
        elif choice == "5":
            print("ğŸ‘‹ å†è§ï¼")
            break
        
        else:
            print("è¯·è¾“å…¥1-5ï¼")

if __name__ == "__main__":
    main()
```

***

### å…­ã€ä½¿ç”¨æ–¹æ³•

1. **é¦–æ¬¡ä½¿ç”¨**ï¼šè¿è¡Œç¨‹åºï¼Œå…ˆè¿›å…¥â€œä¸“é¡¹é™„åŠ æ‰£é™¤ç®¡ç†â€æ·»åŠ ä½ çš„æ‰£é™¤é¡¹
2. **å•æœˆè®¡ç®—**ï¼šè¾“å…¥å•æœˆæ•°æ®è¿›è¡Œä¸ªç¨è¯•ç®—
3. **å¹´åº¦æ±‡ç®—**ï¼šé€æœˆå½•å…¥å·¥èµ„å•æ•°æ®ï¼Œæœ€åç”Ÿæˆæ±‡ç®—æŠ¥å‘Š
4. **ä¿å­˜æ–‡ä»¶**ï¼šæ‰€æœ‰æ•°æ®ä¿å­˜åœ¨`deductions.json`ä¸­ï¼Œå¯å¤‡ä»½

***

### ä¸ƒã€çŸ¥è¯†ç‚¹åŠ æ²¹ç«™

#### 7.1 JSONæ•°æ®æŒä¹…åŒ–

```python
# ä¿å­˜å­—å…¸åˆ°æ–‡ä»¶
import json
data = {"key": "value"}
with open('file.json', 'w', encoding='utf-8') as f:
    json.dump(data, f, ensure_ascii=False, indent=2)

# ä»æ–‡ä»¶è¯»å–
with open('file.json', 'r', encoding='utf-8') as f:
    loaded = json.load(f)
```

***

#### 7.2 ç±»å‹æ³¨è§£è®©ä»£ç æ›´å¥å£®

```python
def func(name: str, age: int) -> bool:
    # å‚æ•°: ç±»å‹ -> è¿”å›å€¼: ç±»å‹
    return age >= 18
```

***

### å…«ã€æ€»ç»“

- âœ… ç¬¦åˆ2025å¹´ç¨æ³•çš„ä¸ªç¨è®¡ç®—å™¨
- âœ… ä¸“é¡¹é™„åŠ æ‰£é™¤çš„å¢åˆ æŸ¥ç®¡ç†
- âœ… å¹´åº¦æ±‡ç®—æ¸…ç¼´æŠ¥å‘Šç”Ÿæˆ
- âœ… é€€ç¨/è¡¥ç¨é¢„æµ‹

***

### ä¸‹ç¯‡é¢„å‘Š

ç¬¬17ç¯‡ã€Šç®€å•çš„ç½‘é¡µçˆ¬è™«ã€‹â€”â€”è‡ªåŠ¨æŠ“å–è´¢ç»æ–°é—»ã€æå–å…³é”®ä¿¡æ¯ï¼Œæ‰“é€ ä½ çš„ä¸“å±èµ„è®¯é›·è¾¾ï¼

***

> ğŸ¤– Powered by Kimi K2 Thinking ğŸ’» å†…å®¹ç»è‘µè‘µğŸŒ»å®¡æ ¸ä¸ä¿®æ”¹

***

---
title: å‰æ²¿æ”¹è¿›-ReduceNetï¼šé€æ­¥ä¸VanillaNetå’ŒDepthShrinkerè„±é’©ï¼Œæ¡¥æ¥çŸ¥è¯†è’¸é¦å’Œç¥ç»æ¶æ„æœç´¢
categories:
  - ğŸŒ™è¿›é˜¶å­¦ä¹ 
  - â­äººå·¥æ™ºèƒ½
  - ğŸ’«å‰æ²¿æ”¹è¿› Frontier Improvement
abbrlink: 6d96441
date: 2023-06-04 04:49:52
tags:
---

{% asset_img 1.png %}

<!--more-->

### ReduceNetä¿®æ­£

ç”±äºä¹‹å‰å¯¹VanillaNetä¸­å¯æ¶ˆè§£çš„æ¿€æ´»å‡½æ•°é”™è¯¯è§£è¯»ï¼ŒåŠ ä¸Šçº¿æ€§æ®‹å·®çš„ç»“åˆè®©æˆ‘ä¸Šå¤´ï¼Œä»¥åŠä»£ç å®ç°çš„é”™è¯¯ï¼Œå¯¼è‡´æˆ‘é™·å…¥äº†ä¸€ç³»åˆ—ä¸åˆ‡å®é™…çš„å¦„æƒ³ã€‚

{% asset_img 2.png %}

é‡æ–°æ€è€ƒäº†ä¸€ä¸‹å®åœ¨æ²¡æœ‰å¿…è¦ç”¨ä¸Šè¿°çš„LambdaReLUï¼Œæ¯•ç«Ÿæ— æ³•ä¿è¯å®ƒèƒ½æœ‰å¤šå°‘æ€§èƒ½æ”¶ç›Šã€‚Bottleneck å½¢å¼çš„conv+LambdaReLU+convæœ€ç»ˆæ˜¯è¦åŒ–åšçº¿æ€§å·ç§¯çš„ï¼Œç›®å‰æˆ‘ç²¾åŠ›å’Œæ—¶é—´éå¸¸æœ‰é™ï¼Œè®¾å¤‡ä¹Ÿåªæœ‰ç¬”è®°æœ¬çš„3060å®åœ¨æ‰¿æ‹…ä¸äº†è¿™ç§ideaçš„ä¸ç¡®å®šæ€§ã€‚è€Œä¸”è¿™ç§æ–¹å¼å®é™…ä¸Šå’ŒRepVGGï¼ŒRepOPTä¼¼ä¹æ²¡æœ‰æœ¬è´¨åŒºåˆ«ã€‚å®ƒä»¬çš„å½¢å¼å¾ˆåƒï¼Œä½œç”¨æˆ‘è®¤ä¸ºä¹Ÿæ˜¯å·®ä¸å¤šçš„ï¼Œå³å¢åŠ äº†ä¸€ç§ç²¾ç»†è°ƒæ•´å­¦ä¹ ç‡çš„è®¾è®¡ç»´åº¦ï¼ˆå› ä¸ºæˆ‘ä»¬ç›®å‰è°ƒæ•´å­¦ä¹ ç‡çš„æ–¹å¼å®åœ¨æœ‰ç‚¹å‘†æ¿å’Œæ— å¯å¥ˆä½•ï¼‰ã€‚ç±»ä¼¼å¼•å…¥äº†â€œå¤šä¸ªéšæœºç§å­â€ï¼ˆç²¾ç»†è°ƒæ•´éƒ¨åˆ†ç»“æ„çš„lrï¼Œscalingå› å­åˆ†é…æ¢¯åº¦ï¼Œä»¥åŠæ··åˆåˆå§‹åŒ–ï¼‰ï¼Œå’Œæ™®é€šçš„æ¨¡å‹è®­ç»ƒç›¸æ¯”ï¼Œå¤šæŠ½äº†å‡ æ¬¡å½©ç¥¨ï¼Œè¿™å½“ç„¶æ¦‚ç‡ä¸Šä¼šæ¯”è¾ƒå¼ºã€‚ä½†æ˜¯å¤šæŠ½å‡ æ¬¡å½©ç¥¨ä¸ä»£è¡¨å°±è¡Œä¸€å®šæ¯”åˆ«çš„æ›´ä¼˜çš„éšæœºç§å­ï¼ˆä¸­å¥–é¢å€¼æ›´å¤§çš„å½©ç¥¨ï¼‰æ›´å¼ºã€‚è¿™ä¹Ÿéƒ¨åˆ†è§£é‡Šä¸ºä»€ä¹ˆé‡å‚æŠ€æœ¯æœ‰å‡ ç‡æå‡æ€§èƒ½ï¼Œä½†æ˜¯æœ‰æ—¶å€™åˆæ²¡æœ‰ç”¨ã€‚

äºæ˜¯æ”¹ç‰ˆçš„ReduceNetç›´æ¥è½¬å‘å¯¹depth shrinkerçš„ç²¾ç®€ã€‚è¿™ç§è½¬å˜çš„è®¾è®¡é€»è¾‘å¦‚ä¸‹ï¼š

1. ä¹‹å‰å·²ç»éªŒè¯è¿‡äº†ï¼Œbottleneckæ¨¡å—ä¸­é—´éçº¿æ€§çš„å±‚å¢åŠ å®½åº¦ï¼Œæ¨¡å‹æ€§èƒ½100%æå‡ã€‚ï¼ˆå¾ˆæƒ­æ„§ï¼Œä¹‹å‰æŠŠéçº¿æ€§çš„ä½œç”¨å½’äºäº†LambdaReLUï¼‰ã€‚
2. æ—¢ç„¶lambdaå‚æ•°å¯ä»¥æ§åˆ¶çº¿æ€§å’Œéçº¿æ€§ï¼Œé‚£å°±å…ˆç›´æ¥è®­ç»ƒä¸€ä¸ªçº¯éçº¿æ€§çš„å¤§ç½‘ç»œå¥½äº†ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨bottleneckç»“æ„ï¼Œç›´æ¥å®ä¾‹åŒ–ä¸€ä¸ªå¤§ç½‘ç»œã€‚é‚£å°ç½‘ç»œæ¥è‡ªå“ªé‡Œå‘¢ï¼Œç›´æ¥ç”¨lambdaè®©åŸå…ˆçš„æ¿€æ´»å‡½æ•°ç›´æ¥å˜æˆçº¿æ€§çš„identity mapping(å°±æ˜¯ç›´æ¥æš´åŠ›ç§»é™¤ReLU)ï¼Œçº¿æ€§èåˆä¸¤ä¸ªå·ç§¯å±‚å°±å¯ä»¥äº†ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å¤§ç½‘ç»œå’Œå°ç½‘ç»œåœ¨è®­ç»ƒé˜¶æ®µç›´æ¥å…±äº«ç›¸åŒçš„ç½‘ç»œç»“æ„ï¼ˆé™¤äº†é‚£ä¸ªç”±Lambdaæ§åˆ¶çš„æ¿€æ´»å‡½æ•°ï¼‰ã€‚å°ç½‘ç»œç›´æ¥ç”±ç›¸åŒçš„å¤§ç½‘ç»œè½¬åŒ–è€Œæ¥ï¼Œè¿™æœ¬èº«å°±æ˜¯æå…·ä»·å€¼çš„å½¢å¼ç‰¹ç‚¹ã€‚è®©è’¸é¦è¿‡ç¨‹å’Œä»£ç å½¢å¼åœ°éƒ½å˜å¾—éå¸¸ç®€æ´ä¼˜é›…ã€‚ä¸Šè¿°æ–¹æ¡ˆå†ä¸æµä¹Ÿèƒ½ä¸ºæœ€æœ´ç´ çš„è’¸é¦æä¾›ä¸€ä¸ªç®€å•çš„æ–¹æ¡ˆã€‚å½“ç„¶ï¼Œdepth shrinkeræœ¬èº«å°±å…·æœ‰ç±»ä¼¼çš„ç‰¹ç‚¹ï¼Œè®ºæ–‡å¹¶æ²¡æœ‰ç‰¹åˆ«å¼ºè°ƒï¼Œè™½ç„¶å½¢å¼ä¹Ÿç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œéœ€è¦å­¦ä¹ 0å’Œ1 maskå‘é‡ï¼Œç”„åˆ«æ¿€æ´»é‡è¦æ€§ã€‚

æ–°ç‰ˆæœ¬çš„ReduceNetè¿½æ±‚æ›´ç®€æ´çš„å‹ç¼©ï¼Œè€Œä¸æ˜¯åƒdepth shrinkerä¸€æ ·éœ€è¦å­¦ä¹ å¦‚ä½•ç”„åˆ«æ¿€æ´»é‡è¦æ€§ï¼ˆé€šè¿‡å¼•å…¥ä¸€ä¸ªmaskå‚æ•°ï¼Œ0æˆ–1ï¼‰ï¼Œå¢åŠ æ¿€æ´»å‡½æ•°ï¼Œå¹¶ç”¨è‡ªè’¸é¦çš„æ–¹å¼æ¢å¤æ€§èƒ½ã€‚é¡ºä¾¿å¸®åŠ©depth shrinkeréªŒè¯è¿™äº›å¤æ‚çš„æ“ä½œæµç¨‹æ˜¯å¦æ˜¯å¿…è¦çš„ã€‚

***

### ReduceNetè®­ç»ƒæµç¨‹

{% asset_img 3.png %}

ReduceNetè®­ç»ƒå°†åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š
- ç¬¬ä¸€é˜¶æ®µscalerä¸º1.0, LambdaReLUä¸ºçº¯ç²¹çš„ReLUï¼Œåˆ©ç”¨å‰ä¸¤å±‚å·ç§¯bottleneckç»“æ„çš„expansionå‚æ•°æ¥å¢åŠ æ¨¡å‹è§„æ¨¡ä»¥å¾—åˆ°ä¸€ä¸ªå¤§æ¨¡å‹çš„ç²¾åº¦ã€‚
- ç¬¬äºŒé˜¶æ®µscalerä¸º0.,å†»ç»“åˆ†ç±»å±‚çš„æƒé‡ï¼ˆå°†æ¥ä¼šç»§ç»­å†»ç»“basic blockä¸­conv3,bn2,bn3çš„æƒé‡ï¼Œæˆ–è€…ç›´æ¥é‡‡ç”¨è’¸é¦çš„æ–¹å¼ï¼‰LambdaReLUä¸ºçº¯ç²¹çš„identity mappingã€‚è¿™ä¸ªæ—¶å€™ï¼Œè¯¥ç½‘ç»œç›¸å½“äºæ˜¯ç¬¬ä¸€é˜¶æ®µçš„å¤§ç½‘ç»œé€€åŒ–è€Œæ¥çš„å°ç½‘ç»œã€‚æˆ‘ä»¬é€šè¿‡å†»ç»“å¤§ç½‘ç»œçš„åˆ†ç±»å±‚æƒé‡,å¸Œæœ›èƒ½å¤Ÿå¼•å¯¼å°ç½‘ç»œå¾—åˆ°è¾ƒé«˜çš„æ¨¡å‹æ€§èƒ½ã€‚

è¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆè¦å¤ç”¨ç¬¬ä¸€é˜¶æ®µçš„åˆ†ç±»å±‚ï¼ˆFCï¼‰ã€‚æˆ‘ä»¬æŠŠåˆ†ç±»çœ‹ä½œæ˜¯ä¸€ä¸ªç‰¹å¾æ£€ç´¢çš„è¿‡ç¨‹ï¼Œbackboneç”¨æ¥å­¦ä¹ ç‰¹å¾ï¼Œåˆ†ç±»å±‚ç”¨æ¥åŒ¹é…ç‰¹å¾ã€‚åˆ†ç±»å±‚FC layerçš„æƒé‡çŸ©é˜µçš„å­¦ä¹ ç›¸å½“äºä¸ºæ•°æ®é›†çš„ç±»åˆ«æ‰¾åˆ°äº†ä¸€ä¸ªä¸­å¿ƒå‘é‡æˆ–è€…ç±»åˆ«å‘é‡ï¼ˆclass vectorï¼‰ï¼ˆå½“ç„¶å…¶å®è¿˜æœ‰biasæƒé‡ï¼Œæˆ–è®¸biaså¯ä»¥æŠ›å¼ƒï¼‰ã€‚åˆ†ç±»çš„è¿‡ç¨‹ç›¸å½“äºbackboneç”Ÿæˆçš„ç‰¹å¾åœ¨å’Œè¿™äº›class vectorè¿›è¡ŒåŒ¹é…ï¼ˆè®¡ç®—ç›¸ä¼¼åº¦ï¼‰ï¼Œæœ€åç»è¿‡softmaxå¾—åˆ°ç±»åˆ«æ¦‚ç‡ã€‚

å› æ­¤ï¼Œè¿™æ ·è®¾è®¡åŸºäºä¸€ä¸ªç›´è§‰æ€§çš„å‡è®¾ï¼Œå³æ›´å¤§çš„æ¨¡å‹å¾€å¾€èƒ½è®­ç»ƒå‡ºæ›´å¥½çš„åˆ†ç±»å±‚ã€‚é‚£ä¹ˆç¬¬äºŒé˜¶æ®µå°±ç›´æ¥å¤ç”¨ç¬¬ä¸€é˜¶æ®µåˆ†ç±»å±‚çš„æƒé‡å°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›class vectorå¯ä»¥å¼•å¯¼ç¬¬äºŒé˜¶æ®µçš„å°ç½‘ç»œå¾—åˆ°æ¯”è¾ƒå¥½çš„ç²¾åº¦ï¼Œç®€åŒ–è’¸é¦è¿‡ç¨‹ï¼Œä¸éœ€è¦soft labels å’Œç‰¹å¾å¯¹é½ï¼ˆä¸éœ€è¦å†æ¬¡ä½¿ç”¨å¤§æ¨¡å‹ï¼‰ã€‚

æˆ‘è¯´å¯èƒ½å“ˆï¼ŒFCçš„é‡ç”¨å·²ç»ç›¸å½“äºä¸€ç§éšæ™¦çš„dark knowledgeäº†ï¼Œåç»­ä¼šç»§ç»­å¤ç”¨ç¬¬ä¸€é˜¶æ®µçš„æŸäº›BNå±‚ï¼Œä»¥ç»§æ‰¿ä¸€äº›ä¿¡æ¯ã€‚æ ¹æ®BNå±‚çš„ä½œç”¨ï¼Œè¿™ç›¸å½“äºæŸç§ç¨‹åº¦ä¸Šçš„ç‰¹å¾å¯¹é½äº†ã€‚å¦‚æœæ•ˆæœä¸è¡Œï¼Œå°±ç›´æ¥å¤ç”¨åˆ†ç±»å±‚å¹¶åŠ å…¥ç›´æ¥çš„ç‰¹å¾å¯¹é½å’Œsoft labelsã€‚

***

### ReduceNetç»§ç»­ç²¾ç®€pipeline

ReduceNetå†ä¸æµï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨åŸå§‹çš„è’¸é¦æ–¹å¼ï¼Œç›´æ¥å……å½“Depth Shrinkerçš„é˜‰å‰²ç‰ˆæœ¬ã€‚å†ç»§ç»­ç»“åˆå¤ç”¨åˆ†ç±»å±‚å’Œéƒ¨åˆ†conv,bnå¯ä»¥åœ¨ç°æœ‰è’¸é¦æ¡†æ¶çš„åŸºç¡€ä¸Šå¤§å¹…åº¦å‡å°‘è®­ç»ƒæˆæœ¬ã€‚å¦å¤–ç”±äºï¼Œå¤§ç½‘ç»œå’Œå°ç½‘ç»œæ˜¯ç»“æ„ç›¸ä¼¼çš„ï¼Œå®Œå…¨å¯ä»¥å¯¹æ ‡é€šé“å‰ªæç®—æ³•ï¼Œé¿å¼€å‰ªæç¢°åˆ°çš„ä¸€äº›çç¢é—®é¢˜ã€‚

æ¯•ç«Ÿï¼Œå¤§ç½‘ç»œå’Œå°ç½‘ç»œå…±äº«ç›¸åŒçš„ç»“æ„ï¼Œè¿™æ ·çš„è®¾è®¡å½¢å¼å¯¹äºä¸€ä¸ªç®€æ´ä¼˜é›…çš„pipelineæ¥è¯´æ˜¯éå¸¸è¯±äººçš„ï¼Œè¿™ä¸€ç‚¹å·²ç»è¶³å¤Ÿæœ‰ä»·å€¼äº†ã€‚

å›¾1çš„pipelineå…¶å®ä»ç„¶æœ‰å¾ˆå¤§çš„å†—ä½™è®¾è®¡ã€‚ç¬¬äºŒé˜¶æ®µä¼¼ä¹æ²¡æœ‰å¿…è¦ä¿ç•™ä¸¤ä¸ªçº¿æ€§å·ç§¯ï¼Œå› ä¸ºç›´æ¥ç”¨æ–°çš„ä¸€å±‚å·ç§¯ç›´æ¥ä»£æ›¿å°±å¯ä»¥äº†ï¼ˆæ–°çš„ä¸€å±‚å·ç§¯å½¢çŠ¶å’Œbottleneckçš„ä¸¤å±‚çº¿æ€§å·ç§¯èåˆåçš„æ ·å­ç›¸åŒï¼‰ã€‚è¿™æ ·å­å’ŒVanillaNet,depth shrinkeréƒ½æœ‰äº†éå¸¸å¤§çš„åŒºåˆ«ï¼Œå˜æˆå®Œå…¨ä¸åŒçš„ä¸œè¥¿äº†ã€‚æœ€ç»ˆè®¾è®¡å¦‚ä¸‹å›¾

{% asset_img 4.png %}

ç¬¬äºŒæ¬¡è®­ç»ƒçº¢è‰²çš„ä¸¤ä¸ªBNå’ŒConv3ç»§æ‰¿è‡ªç¬¬ä¸€æ¬¡è®­ç»ƒçš„ç»“æœï¼Œå‚æ•°å†»ç»“ï¼Œä»ç„¶å¤ç”¨åˆ†ç±»å±‚ã€‚ç¬¬äºŒæ¬¡è®­ç»ƒæ–°çš„å°ç½‘ç»œåªéœ€è¦æ›´æ–°ç¬¬ä¸€å±‚çš„conv3å°±å¯ä»¥äº†ã€‚æ¯”èµ·å›¾1,è®­ç»ƒçš„æ—¶å€™ä¸éœ€è¦æ›´å¤§çš„ç½‘ç»œï¼Œä¹Ÿä¸éœ€è¦èåˆä¸¤ä¸ªçº¿æ€§å·ç§¯ç®—å­ï¼ˆç›´æ¥newä¸€ä¸ªï¼‰ã€‚å› ä¸ºç›´æ¥å¼•å…¥ä¸€ä¸ªå·ç§¯å±‚æ¯”èåˆç®—å­æ›´ç®€å•ï¼Œè€Œä¸”ç›´æ¥ç”¨å°ç½‘ç»œï¼Œå¤§å¹…åº¦é™ä½äº†è®­ç»ƒæˆæœ¬ã€‚ä½†æ˜¯æœ€ç»ˆå°ç½‘ç»œå’Œå¤§ç½‘ç»œä»ç„¶æ˜¯éå¸¸ç±»ä¼¼çš„ï¼Œå¯ä»¥å…±äº«ä¸€ä¸ªæ¨¡å‹æ–‡ä»¶ã€‚

***

### ReduceNetç»§ç»­è¿›åŒ–

è€ƒè™‘åˆ°åœ¨è®­ç»ƒä¸­å¢åŠ ä¸€å±‚å·ç§¯æ¯”è¾ƒéº»çƒ¦ï¼Œæ–°çš„æ–¹æ¡ˆæ”¹ç”¨ç±»ä¼¼LORAçš„ç»“æ„ï¼Œåªä¸è¿‡æ˜¯éçº¿æ€§çš„ï¼Œå¹¶éç”¨äºå¾®è°ƒã€‚ç¬¬äºŒä¸ªconv3ä¹‹å‰æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œå·¦åˆ†æ”¯æ˜¯conv3å’Œconv1çš„éçº¿æ€§bottleneckç»“æ„ï¼Œå³åˆ†æ”¯æ˜¯ä¸€å±‚æ¯”è¾ƒçª„çš„éçº¿æ€§conv3ã€‚ç¤ºæ„å›¾æœ‰æ—¶é—´å†è¡¥ä¸Šï¼Œæˆ–è€…ç»“åˆè¿™éƒ¨åˆ†æ–‡å­—å’Œä¸Šé¢çš„å›¾è‡ªè¡Œè„‘è¡¥ã€‚

ä»£ç å¦‚ä¸‹ï¼š

``` python
class BasicBlock(nn.Module):

    def __init__(self, in_planes, planes, stride=1,scaler=1.,expansion=1):
        super(BasicBlock, self).__init__()

        self.shortcut = True if stride==1 else False
        self.scaler = scaler
         
        self.branch1 = nn.Sequential(
                                    nn.Conv2d(in_planes, expansion*planes, kernel_size=3, stride=stride, padding=1, bias=False),
                                    nn.BatchNorm2d(expansion*planes),
                                    nn.ReLU(),
                                    nn.Conv2d(expansion*planes, planes, kernel_size=1, stride=1, padding=0, bias=False),
                                    nn.BatchNorm2d(planes),
                                    nn.ReLU())

        self.branch2 = nn.Sequential(
                                     nn.Conv2d(in_planes, planes, kernel_size=3, stride=stride, padding=1, bias=False),
                                     nn.BatchNorm2d(planes),
                                     nn.ReLU()
                                     )


        self.conv3 = nn.Conv2d(planes, planes, kernel_size=3, stride=1, padding=1, bias=False)
        self.bn3 = nn.BatchNorm2d(planes)
        self.shortcut = nn.Sequential()
        if stride != 1 or in_planes != planes:
           self.shortcut = nn.Sequential(
                                        nn.Conv2d(in_planes, planes, kernel_size=1, stride=stride, bias=False),
                                        nn.BatchNorm2d(planes)
                                        )

    def forward(self, x):
        out = self.scaler*self.branch1(x)+self.branch2(x)

        out = self.bn3(self.conv3(out))
        out = out + self.shortcut(x) 
        return out
```

åœ¨ç¬¬äºŒæ¬¡è®­ç»ƒçš„æ—¶å€™å°†self.scalerè®¾ç½®ä¸º0.ï¼Œå°†bottleneckç›´æ¥ä¸¢å¼ƒæ¥å¯ä»¥äº†ã€‚è¿™ä¸ªå’Œç¥ç»æ¶æ„æœ‰ç‚¹åƒäº†ï¼Œè®­ç»ƒç”¨å¤§ç½‘ç»œï¼Œå†â€œæ…¢æ…¢å‡å°‘æœç´¢èŒƒå›´ç²¾ç»†è®­ç»ƒå°ç½‘ç»œâ€ã€‚å…³é”®æ˜¯æ€ä¹ˆæŠŠå¤§ç½‘ç»œçš„çŸ¥è¯†è½¬ç§»ç»™å°ç½‘ç»œã€‚ç¨³å¦¥ç‚¹çš„è¯å¯ä»¥ç›´æ¥ä½¿ç”¨æˆç†Ÿçš„å„ç§è’¸é¦æ–¹æ¡ˆã€‚ReduceNetå¢åŠ çš„åŠŸèƒ½å¯èƒ½æ˜¯ï¼š
1. å¤ç”¨Linearå’ŒConv3æƒé‡å’Œä¸€äº›BNå±‚ä»¥å‡å°‘è’¸é¦æˆæœ¬å’Œç°æœ‰è’¸é¦æ¡†æ¶å…¼å®¹ã€‚
2. é‡‡ç”¨ç»“æ„ç›¸ä¼¼çš„å¤§å°ç½‘ç»œï¼Œç”¨expansionå‚æ•°æ§åˆ¶bottleneckç»“æ„è¿›è€Œæ§åˆ¶å¤§ç½‘ç»œè§„æ¨¡ï¼Œå°ç½‘ç»œåˆ™æ˜¯ä¸¢å¼ƒè¿™éƒ¨åˆ†bottleneckåˆ†æ”¯ã€‚

ç›®å‰ä¸ºæ­¢ï¼ŒReduceNetå’ŒDepth Shrinkerå¯ä»¥åŸºæœ¬è„±é’©äº†ã€‚è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥ç›´æ¥åœ¨ä¸€ä¸ªç½‘ç»œå®ä¾‹ä¸Šæ“ä½œï¼Œä¸å¿…åŠ å…¥å„ç§çç¢çš„ç²¾ç»†æ§åˆ¶ï¼ˆæ¯”å¦‚ï¼Œçªç„¶åœ¨ç½‘ç»œä¸­é¢å¤–åŠ å…¥ä¸€å±‚å·ç§¯ï¼Œèåˆä¸¤ä¸ªçº¿æ€§å·ç§¯ç­‰ï¼‰

***

### ReduceNetæ‹¥æŠ±LORAè¿›è¡Œè’¸é¦å¾®è°ƒ

å½“ä¸¢å¼ƒéçº¿æ€§bottleneckåˆ†æ”¯çš„æ—¶å€™ï¼Œå¤§ç½‘ç»œå°±ä¼šé€€åŒ–æˆå°ç½‘ç»œï¼Œéœ€è¦ç»§ç»­è®­ç»ƒï¼Œé€šè¿‡æŸç§æ–¹å¼æ¢å¤æ¨¡å‹æ€§èƒ½ã€‚è¿™åˆä½•å°ä¸æ˜¯ä¸€ç§å¾®è°ƒå‘¢ï¼Ÿä¸Šä¸€ä¸ªæ–¹æ¡ˆå¹¶æ²¡æœ‰å®é™…å¼•å…¥LORAï¼ˆbottleneckç»“æ„çš„ä¸¤ä¸ªçº¿æ€§å·ç§¯ï¼‰ï¼Œå…¶å®å½“ç¬¬äºŒæ¬¡è®­ç»ƒå°ç½‘ç»œå®Œå…¨å¯ä»¥å¼•å…¥LORAåˆ†æ”¯æ¥å¢åŠ å­¦ä¹ èƒ½åŠ›ï¼Œäº‹åèåˆå°±å¯ä»¥äº†ã€‚å³å†»ç»“ç›´æ¥æ‰€è°“çš„å…¨éƒ¨å°ç½‘ç»œï¼Œç”¨LORAåˆ†æ”¯æ¥è¿›è¡Œå¾®è°ƒå­¦ä¹ ã€‚è¿™ç§å¾®è°ƒå­¦ä¹ å¯ä»¥ç»“åˆå¤§ç½‘ç»œè¿›è¡Œæ­£å¸¸çš„è’¸é¦ï¼Œå°†éçº¿æ€§çš„â€œçŸ¥è¯†â€è½¬ç§»åˆ°LORAåˆ†æ”¯é‡Œã€‚æ³¨æ„ï¼ŒLORAåˆ†æ”¯çš„åé¢æ˜¯å¸¦æœ‰reluçš„ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯åœ¨ç”¨çº¿æ€§å‡½æ•°é€¼è¿‘éçº¿æ€§å‡½æ•°ï¼Œè¿™æ ·çš„æ•ˆæœå¤§æ¦‚ç‡æ˜¯ä¸å¥½çš„ã€‚æ­¤æ—¶æœ¬è´¨ä¸Šæ˜¯ä¸€å±‚éçº¿æ€§ï¼ˆLORAä¸¤å±‚å·ç§¯å¯ä»¥èåˆä¸ºä¸€å±‚ï¼‰åœ¨é€¼è¿‘ä¸¤å±‚bottleneckçš„éçº¿æ€§å·ç§¯ã€‚

è¿™å…¶å®åˆå°†LORAï¼ŒControlNetï¼ŒRepVGGçš„æ€æƒ³åˆè”ç³»åœ¨ä¸€èµ·äº†ï¼Œä¸èƒ½ä¿è¯æœ‰å¾ˆå¤§çš„æ•ˆæœï¼Œè‡³å°‘å¯ä»¥"æŠ½æ›´å¤šçš„å½©ç¥¨"æ¥å¢åŠ ä¸­å¥–çš„å‡ ç‡ã€‚æœ€åï¼Œè¿™ä¸ªLORAåˆ†æ”¯åˆå¯ä»¥è§†æƒ…å†µå¼•å…¥åä¸ºVanillaNetä¸­çš„LambdaReLU(deep training strategy)ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­ç”±éçº¿æ€§é€æ¸è½¬ä¸ºçº¿æ€§ï¼Œä¸å½±å“æœ€åçš„èåˆè¿‡ç¨‹ã€‚

å¦å¤–ï¼Œè¿™é‡Œçš„LORAå…¶å®ç¨å¾®æœ‰ç‚¹ä¸åŒï¼Œæˆ‘ä»¬æ˜¯è¦å¢åŠ å‚æ•°ï¼Œè€Œä¸æ˜¯å‡å°‘å‚æ•°ï¼Œæ‰€ä»¥å¯ä»¥ç¨å¾®è‚†æ— å¿Œæƒ®åœ°é‡‡ç”¨é€šé“å…ˆå¢åŠ åå‡å°‘ï¼ˆåŸç‰ˆLORAç›¸åï¼‰çš„bottleneckç»“æ„ã€‚

***

### ä»£ç é“¾æ¥

[[repo] GitHub - ohmydroid/reducenet](https://github.com/ohmydroid/reducenet)

ä¸€ç›´åœ¨æ”¹è¿›æ–¹æ¡ˆï¼Œä¸€å¤©æ¢äº†4ä¸ªæ€è·¯ã€‚ä»£ç åŠŸèƒ½è¿˜æ²¡æœ‰å®Œå…¨å®ç°ï¼Œåªèƒ½æ–‡å­—è®°å½•ä¸€ä¸‹ã€‚ç›®å‰åªå†»ç»“äº†åˆ†ç±»å±‚å’Œ BN å±‚ï¼Œè¿˜éœ€è¦ç»§ç»­è°ƒå‚å’Œä¿®æ­£ç»†èŠ‚çš„è®¾è®¡ã€‚

æ–°ç‰ˆæœ¬ReduceNetå’ŒVanillaNetåŸºæœ¬æ²¡ä»€ä¹ˆå…³ç³»äº†ï¼Œå’Œdepth shrinkerè²Œä¼¼ä¹Ÿå˜å¾—æˆªç„¶ä¸åŒã€‚æ–‡ç« åˆšå¼€å§‹çš„æ€è·¯æœ‰ç‚¹å†—ä½™ï¼Œä½†æ˜¯æˆ‘éƒ½ä¿ç•™ä¸‹æ¥ï¼Œä»¥æ–¹ä¾¿ç†è§£æ€è·¯çš„è½¬æ¢è¿‡ç¨‹ã€‚

ReduceNetç›®å‰æ•´ä½“æ˜¯æ¡†æ¶è®¾è®¡ï¼Œå¯è¡Œæ€§æ˜¯å»ºç«‹åœ¨ç°æœ‰æˆç†Ÿæ–¹æ¡ˆåŸºç¡€ä¸Šçš„ã€‚åªä¸è¿‡æˆ‘ä»¬åœ¨å½¢å¼è¿›è¡Œäº†ç²¾ç®€å’Œæ•´åˆã€‚

è€Œä¸”ï¼Œç°åœ¨çš„æ–¹æ¡ˆæŠŠè’¸é¦å’Œç¥ç»æ¶æ„æœç´¢æ¡¥æ¥èµ·æ¥äº†ã€‚å¤§æ¨¡å‹ç›¸å½“äºç¥ç»æ¶æ„çš„è¶…ç½‘ï¼Œå°æ¨¡å‹ç›¸å½“äºå­ç½‘ã€‚æˆ‘ä»¬é€šè¿‡è’¸é¦ï¼Œç”¨ç»“æ„ç›¸ä¼¼çš„å¤§æ¨¡å‹æŠŠæ€§èƒ½è½¬ç§»åˆ°å°æ¨¡å‹ï¼Œç›®æ ‡å¾ˆæ˜ç¡®ã€‚è€Œç¥ç»æ¶æ„æœç´¢çš„ç—›ç‚¹æ˜¯æ ¹æœ¬æ²¡æœ‰è®­ç»ƒæ•´ä¸ªç½‘ç»œï¼Œè€Œæ˜¯ä¸æ–­é‡‡æ ·å­ç½‘ï¼Œå¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„å­ç½‘ä¹Ÿä¸»è¦é ç®—åŠ›æœç´¢ï¼Œèµ„æºçº¦æŸï¼Œè¿æ°”ä»¥åŠæŸäº›å¤æ‚çš„é¢„æµ‹è¯„ä¼°ç®—æ³•ï¼Œç›¸å¯¹æ˜¾å¾—æœ‰ç‚¹æ¼«æ— ç›®çš„ã€‚æœ€é‡è¦çš„å®Œå…¨ä¸çŸ¥é“è¦èŠ±è´¹å¤šå°‘èµ„æºæ‰èƒ½å¾—åˆ°æœŸæœ›çš„æ€§èƒ½ã€‚ReduceNetåˆ™å®Œç¾è§£å†³äº†æ€§èƒ½ï¼Œèµ„æºè¾¹ç•Œ(ç”¨expansionæ§åˆ¶bottleneckå¾—åˆ°å¤§æ¨¡å‹æ€§èƒ½)å’Œç›®æ ‡å¯¼å‘çš„é—®é¢˜ï¼ˆè®©å¤§æ¨¡å‹çš„æ€§èƒ½è½¬ç§»ç»™å°æ¨¡å‹ï¼Œæƒé‡å¤ç”¨ï¼Œsoft labels,ç‰¹å¾å¯¹é½ç­‰æ‰‹æ®µå¯ä»¥ä¸€ä¸€ç”¨ä¸Šï¼Œç›´åˆ°å°æ¨¡å‹æ€§èƒ½â€œé¥±å’Œâ€ï¼‰ã€‚

æœ€è¿‘å¤ªç´¯äº†ï¼Œæˆ‘åˆé¸¡è¡€ä¸€å¤©ã€‚è¿™è¿˜ä¸æ˜¯æœ€ç»ˆçš„è®¾è®¡ç‰ˆæœ¬ï¼Œå¾—é—²å¾…ç»­ã€‚ä»ç„¶ä¸æ’é™¤ä¼šæœ‰å¼±æ™ºçš„ä»£ç é”™è¯¯ã€‚

***

### å‚è€ƒèµ„æ–™

> <https://zhuanlan.zhihu.com/p/634198940>

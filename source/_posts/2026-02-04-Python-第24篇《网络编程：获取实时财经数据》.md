---
title: Python-ç¬¬24ç¯‡ã€Šç½‘ç»œç¼–ç¨‹ï¼šè·å–å®æ—¶è´¢ç»æ•°æ®ã€‹
categories:
  - ğŸŒ™é€¢å‚æ‚è°ˆä¸æ¬è¿
  - â­æœæœè¯¾ç¨‹
abbrlink: 8c5f2269
date: 2026-02-04 06:06:29
tags:
---

### å¯¼è¯­

ä»Šå¤©å’±ä»¬é€ ä¸€ä¸ªâ€œæ±‡ç‡é›·è¾¾â€â€”â€”è‡ªåŠ¨è°ƒç”¨å…è´¹APIè·å–å®æ—¶æ±‡ç‡ï¼ŒJSONæ•°æ®ä¸€é”®è§£æï¼Œç›‘æ§åˆ°ç†æƒ³ç‚¹ä½è‡ªåŠ¨æé†’ã€‚å­¦ä¼šè¿™æ‹›ï¼Œä½ è¿˜èƒ½çˆ¬é‡‘ä»·ã€è‚¡ä»·ã€åŸæ²¹ä»·æ ¼ï¼

<!--more-->

***

### æœ¬ç¯‡ç›®æ ‡

- ç†è§£APIå’ŒJSONæ•°æ®æ ¼å¼
- æŒæ¡`requests`åº“è°ƒç”¨RESTful API
- å­¦ä¼šè§£æå’Œæå–JSONæ•°æ®
- å®ç°å¸¦æé†’åŠŸèƒ½çš„æ±‡ç‡ç›‘æ§å™¨
- æ•°æ®æœ¬åœ°åŒ–ä¿å­˜å’Œå†å²è¿½è¸ª

***

### ä¸€ã€å‡†å¤‡å·¥ä½œï¼šå®‰è£…åº“

```python
# å‘½ä»¤è¡Œè¿è¡Œ
# pip install requests pandas

import requests
import json
import time
from datetime import datetime
import pandas as pd
import os
from typing import Dict, List

print("âœ… ç½‘ç»œç¼–ç¨‹ç¯å¢ƒå‡†å¤‡å°±ç»ªï¼")
```

***

### äºŒã€ä»€ä¹ˆæ˜¯APIå’ŒJSONï¼Ÿ

#### 2.1 API = æ•°æ®â€œå¤–å–æœåŠ¡â€

APIï¼ˆåº”ç”¨ç¨‹åºæ¥å£ï¼‰å°±åƒé¤å…çš„å¤–å–æœåŠ¡ï¼š
- ä½ ä¸‹å•ï¼ˆå‘é€è¯·æ±‚URLï¼‰
- å¨æˆ¿åšé¥­ï¼ˆæœåŠ¡å™¨å¤„ç†ï¼‰
- å¤–å–å°å“¥é€ä¸Šé—¨ï¼ˆè¿”å›JSONæ•°æ®ï¼‰

**å…è´¹è´¢ç»APIæ¨èï¼š**
- æ±‡ç‡ï¼š`https://api.exchangerate-api.com/v4/latest/USD`ï¼ˆå…è´¹ï¼Œæ— éœ€æ³¨å†Œï¼‰
- å›½å†…æ±‡ç‡ï¼š`https://www.banhou.com/api/v1/exchange_rate`ï¼ˆæ¨¡æ‹Ÿï¼‰
- é»„é‡‘ä»·æ ¼ï¼š`https://api.gold-api.com/price/XAU`ï¼ˆæ¨¡æ‹Ÿï¼‰

***

#### 2.2 JSON = æ•°æ®â€œå¿«é€’ç›’â€

JSONæ˜¯APIè¿”å›çš„æ•°æ®æ ¼å¼ï¼Œé•¿å¾—åƒPythonå­—å…¸ï¼š

```python
# ç¤ºä¾‹æ±‡ç‡APIè¿”å›çš„JSON
{
  "result": "success",
  "base_code": "USD",
  "time_last_update_utc": "2025-01-26 12:30:02",
  "rates": {
    "CNY": 7.2456,
    "EUR": 0.9234,
    "GBP": 0.7856,
    "JPY": 149.85
  }
}
```

***

### ä¸‰ã€ç¬¬ä¸€æ¬¡APIè°ƒç”¨ï¼šè·å–å®æ—¶æ±‡ç‡

```python
# ========== åŸºç¡€APIè°ƒç”¨ ==========
def get_exchange_rate(base_currency: str = 'USD', target_currency: str = 'CNY') -> Dict:
    """
    è·å–å®æ—¶æ±‡ç‡
    base_currency: åŸºç¡€è´§å¸ï¼ˆå¦‚USDï¼‰
    target_currency: ç›®æ ‡è´§å¸ï¼ˆå¦‚CNYï¼‰
    è¿”å›ï¼š{'æ±‡ç‡': float, 'æ›´æ–°æ—¶é—´': str, 'çŠ¶æ€': str}
    """
    # API URLï¼ˆå…è´¹ç‰ˆï¼Œæ¯å°æ—¶æ›´æ–°ï¼‰
    url = f"https://api.exchangerate-api.com/v4/latest/{base_currency}"
    
    try:
        print(f"\nğŸŒ æ­£åœ¨è¯·æ±‚: {url}")
        
        # å‘é€GETè¯·æ±‚ï¼ˆtimeouté˜²æ­¢å¡æ­»ï¼‰
        response = requests.get(url, timeout=10)
        
        # æ£€æŸ¥çŠ¶æ€ç ï¼ˆ200è¡¨ç¤ºæˆåŠŸï¼‰
        if response.status_code != 200:
            return {
                'çŠ¶æ€': f'å¤±è´¥',
                'é”™è¯¯': f'Status Code: {response.status_code}',
                'æ±‡ç‡': 0
            }
        
        # è§£æJSON
        data = response.json()
        
        # æå–ç›®æ ‡æ±‡ç‡
        if 'rates' in data and target_currency in data['rates']:
            rate = data['rates'][target_currency]
            
            return {
                'æ±‡ç‡': rate,
                'æ›´æ–°æ—¶é—´': data.get('time_last_update_utc', 'æœªçŸ¥'),
                'çŠ¶æ€': 'æˆåŠŸ',
                'åŸºç¡€è´§å¸': data.get('base_code', base_currency),
                'ç›®æ ‡è´§å¸': target_currency
            }
        else:
            return {
                'çŠ¶æ€': 'å¤±è´¥',
                'é”™è¯¯': f'æœªæ‰¾åˆ°è´§å¸ {target_currency}',
                'æ±‡ç‡': 0
            }
    
    except requests.exceptions.Timeout:
        return {'çŠ¶æ€': 'å¤±è´¥', 'é”™è¯¯': 'è¯·æ±‚è¶…æ—¶ï¼ˆ10ç§’ï¼‰', 'æ±‡ç‡': 0}
    
    except requests.exceptions.ConnectionError:
        return {'çŠ¶æ€': 'å¤±è´¥', 'é”™è¯¯': 'ç½‘ç»œè¿æ¥é”™è¯¯', 'æ±‡ç‡': 0}
    
    except Exception as e:
        return {'çŠ¶æ€': 'å¤±è´¥', 'é”™è¯¯': str(e), 'æ±‡ç‡': 0}

# æµ‹è¯•
print("æ±‡ç‡æŸ¥è¯¢æµ‹è¯•ï¼š")
result = get_exchange_rate('USD', 'CNY')
if result['çŠ¶æ€'] == 'æˆåŠŸ':
    print(f"âœ… 1ç¾å…ƒ = {result['æ±‡ç‡']:.4f}äººæ°‘å¸")
    print(f"â° æ›´æ–°æ—¶é—´: {result['æ›´æ–°æ—¶é—´']}")
else:
    print(f"âŒ æŸ¥è¯¢å¤±è´¥: {result['é”™è¯¯']}")

# æŸ¥è¯¢å…¶ä»–è´§å¸
result_eur = get_exchange_rate('USD', 'EUR')
print(f"ğŸ’¶ 1ç¾å…ƒ = {result_eur['æ±‡ç‡']:.4f}æ¬§å…ƒ")
```

***

### å››ã€å¤šè´§å¸æ±‡ç‡ç›‘æ§å™¨

```python
# ========== å¤šè´§å¸ç›‘æ§å™¨ ==========
class ExchangeRateMonitor:
    """æ±‡ç‡ç›‘æ§å™¨"""
    
    def __init__(self, base_currency: str = 'USD'):
        self.base_currency = base_currency
        self.target_currencies = ['CNY', 'EUR', 'GBP', 'JPY']
        self.history_file = f"æ±‡ç‡å†å²_{base_currency}.json"
        self.load_history()
    
    def load_history(self):
        """åŠ è½½å†å²æ±‡ç‡"""
        if os.path.exists(self.history_file):
            try:
                with open(self.history_file, 'r', encoding='utf-8') as f:
                    self.history = json.load(f)
            except:
                self.history = {}
        else:
            self.history = {}
    
    def save_history(self):
        """ä¿å­˜å†å²æ±‡ç‡"""
        with open(self.history_file, 'w', encoding='utf-8') as f:
            json.dump(self.history, f, ensure_ascii=False, indent=2)
    
    def get_all_rates(self) -> Dict:
        """è·å–æ‰€æœ‰ç›®æ ‡è´§å¸æ±‡ç‡"""
        print(f"\n{'='*50}")
        print(f"æ‰¹é‡æŸ¥è¯¢ {self.base_currency} æ±‡ç‡")
        print(f"{'='*50}")
        
        rates = {}
        
        for currency in self.target_currencies:
            result = get_exchange_rate(self.base_currency, currency)
            
            if result['çŠ¶æ€'] == 'æˆåŠŸ':
                rates[currency] = result['æ±‡ç‡']
                print(f"âœ… {self.base_currency}/{currency}: {result['æ±‡ç‡']:.4f}")
            else:
                rates[currency] = 0
                print(f"âŒ {self.base_currency}/{currency}: {result['é”™è¯¯']}")
            
            # ç¤¼è²Œæ€§æš‚åœ1ç§’ï¼ˆé¿å…é¢‘ç¹è¯·æ±‚ï¼‰
            time.sleep(1)
        
        # è®°å½•åˆ°å†å²
        timestamp = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        self.history[timestamp] = rates
        self.save_history()
        
        print(f"\nğŸ’¾ å·²ä¿å­˜åˆ°å†å²è®°å½•")
        
        return rates
    
    def show_history(self, n: int = 10):
        """æ˜¾ç¤ºæœ€è¿‘næ¡å†å²è®°å½•"""
        print(f"\n{'='*50}")
        print(f"æœ€è¿‘ {n} æ¬¡æ±‡ç‡æŸ¥è¯¢å†å²")
        print(f"{'='*50}")
        
        # æŒ‰æ—¶é—´æ’åºï¼Œå–æœ€è¿‘çš„
        sorted_history = sorted(self.history.items(), key=lambda x: x[0], reverse=True)
        
        for timestamp, rates in sorted_history[:n]:
            print(f"\nâ° {timestamp}")
            for currency, rate in rates.items():
                if rate > 0:
                    print(f"  {self.base_currency}/{currency}: {rate:.4f}")
    
    def monitor_rate(self, target_currency: str, target_rate: float, direction: str = 'above'):
        """
        ç›‘æ§æ±‡ç‡è¾¾åˆ°ç›®æ ‡å€¼
        target_currency: ç›®æ ‡è´§å¸
        target_rate: ç›®æ ‡æ±‡ç‡
        direction: 'above'ï¼ˆé«˜äºï¼‰æˆ– 'below'ï¼ˆä½äºï¼‰
        """
        print(f"\n{'='*60}")
        print(f"å¯åŠ¨æ±‡ç‡ç›‘æ§: {self.base_currency}/{target_currency}")
        print(f"ç›®æ ‡: å½“æ±‡ç‡ {'é«˜äº' if direction == 'above' else 'ä½äº'} {target_rate:.4f} æ—¶æé†’")
        print(f"{'='*60}")
        
        check_count = 0
        max_checks = 20  # æœ€å¤šæ£€æŸ¥20æ¬¡
        
        try:
            while check_count < max_checks:
                check_count += 1
                now = datetime.now().strftime('%H:%M:%S')
                print(f"\nç¬¬ {check_count}/{max_checks} æ¬¡æ£€æŸ¥ - {now}")
                
                result = get_exchange_rate(self.base_currency, target_currency)
                
                if result['çŠ¶æ€'] == 'æˆåŠŸ':
                    current_rate = result['æ±‡ç‡']
                    print(f"å½“å‰æ±‡ç‡: {current_rate:.4f}")
                    
                    # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç›®æ ‡
                    if direction == 'above' and current_rate >= target_rate:
                        print(f"ğŸ‰ è¾¾åˆ°ç›®æ ‡ï¼æ±‡ç‡å·²é«˜äº {target_rate:.4f}")
                        self._send_alert(self.base_currency, target_currency, current_rate, target_rate)
                        break
                    
                    elif direction == 'below' and current_rate <= target_rate:
                        print(f"ğŸ‰ è¾¾åˆ°ç›®æ ‡ï¼æ±‡ç‡å·²ä½äº {target_rate:.4f}")
                        self._send_alert(self.base_currency, target_currency, current_rate, target_rate)
                        break
                    
                    else:
                        print(f"æœªè¾¾åˆ°ç›®æ ‡ï¼Œç»§ç»­ç›‘æ§...")
                
                else:
                    print(f"æŸ¥è¯¢å¤±è´¥: {result['é”™è¯¯']}")
                
                # æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡ï¼ˆé¿å…é¢‘ç¹è¯·æ±‚ï¼‰
                time.sleep(30)
            
            if check_count >= max_checks:
                print(f"\nâ° ç›‘æ§ç»“æŸï¼Œå·²è¾¾åˆ°æœ€å¤§æ£€æŸ¥æ¬¡æ•° {max_checks}")
        
        except KeyboardInterrupt:
            print("\n\nç”¨æˆ·æ‰‹åŠ¨åœæ­¢ç›‘æ§")
    
    def _send_alert(self, base: str, target: str, current: float, target_rate: float):
        """å‘é€æé†’ï¼ˆè¿™é‡Œç”¨æ‰“å°æ¨¡æ‹Ÿï¼Œå¯æ‰©å±•ä¸ºé‚®ä»¶/å¾®ä¿¡ï¼‰"""
        print("\n" + "="*50)
        print("ğŸš¨ æ±‡ç‡æé†’")
        print("="*50)
        print(f"è´§å¸å¯¹: {base}/{target}")
        print(f"å½“å‰æ±‡ç‡: {current:.4f}")
        print(f"ç›®æ ‡æ±‡ç‡: {target_rate:.4f}")
        print(f"æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
        print("="*50)
        print("\a")  # å‘å‡ºæç¤ºéŸ³ï¼ˆWindowsï¼‰

# æµ‹è¯•ç›‘æ§å™¨
monitor = ExchangeRateMonitor('USD')

# æŸ¥è¯¢æ‰€æœ‰æ±‡ç‡
rates = monitor.get_all_rates()

# æŸ¥çœ‹å†å²
monitor.show_history(5)

# å¯åŠ¨ç›‘æ§ï¼ˆç¤ºä¾‹ï¼šç›‘æ§USD/CNYæ˜¯å¦è·Œç ´7.20ï¼‰
# monitor.monitor_rate('CNY', 7.20, direction='below')
```

***

### äº”ã€å®æˆ˜ï¼šå®æ—¶æ±‡ç‡ç›‘æ§å™¨ï¼ˆå®Œæ•´ç‰ˆï¼‰

```python
# ========== å®æ—¶æ±‡ç‡ç›‘æ§å™¨ - å®Œæ•´ç‰ˆ ==========
import requests
import json
import time
from datetime import datetime
import os
from typing import Dict, List
import pandas as pd

class RealtimeExchangeMonitor:
    """å®æ—¶æ±‡ç‡ç›‘æ§å™¨ï¼ˆä¸“ä¸šç‰ˆï¼‰"""
    
    def __init__(self, config_file='monitor_config.json'):
        self.config_file = config_file
        self.monitoring = False
        self.load_config()
    
    def load_config(self):
        """åŠ è½½ç›‘æ§é…ç½®"""
        default_config = {
            "base_currency": "USD",
            "monitor_pairs": [
                {"currency": "CNY", "target": 7.25, "direction": "below", "active": True},
                {"currency": "EUR", "target": 0.92, "direction": "above", "active": False},
                {"currency": "JPY", "target": 150, "direction": "above", "active": False}
            ],
            "check_interval": 300,  # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰ï¼Œ5åˆ†é’Ÿ
            "alert_sound": True,
            "save_history": True,
            "history_file": "exchange_history.csv"
        }
        
        if os.path.exists(self.config_file):
            try:
                with open(self.config_file, 'r', encoding='utf-8') as f:
                    self.config = json.load(f)
                print("âœ… é…ç½®åŠ è½½æˆåŠŸ")
            except:
                self.config = default_config
                print("âš ï¸ é…ç½®åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®")
        else:
            self.config = default_config
            self.save_config()
            print("ğŸ“„ åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶")
    
    def save_config(self):
        """ä¿å­˜é…ç½®"""
        with open(self.config_file, 'w', encoding='utf-8') as f:
            json.dump(self.config, f, ensure_ascii=False, indent=2)
    
    def add_monitor_pair(self):
        """æ·»åŠ ç›‘æ§è´§å¸å¯¹"""
        print("\n" + "="*40)
        print("æ·»åŠ ç›‘æ§è´§å¸å¯¹")
        print("="*40)
        
        base = input("åŸºç¡€è´§å¸ï¼ˆå¦‚USDï¼‰: ").strip().upper()
        target = input("ç›®æ ‡è´§å¸ï¼ˆå¦‚CNYï¼‰: ").strip().upper()
        target_rate = float(input("ç›®æ ‡æ±‡ç‡: ").strip())
        direction = input("æ–¹å‘ï¼ˆabove/belowï¼‰: ").strip().lower()
        
        new_pair = {
            "currency": target,
            "target": target_rate,
            "direction": direction,
            "active": True
        }
        
        self.config["monitor_pairs"].append(new_pair)
        self.save_config()
        
        print(f"âœ… å·²æ·»åŠ  {base}/{target} ç›‘æ§")
    
    def get_rate_with_fallback(self, base: str, target: str) -> Dict:
        """è·å–æ±‡ç‡ï¼ˆå¸¦å¤‡ç”¨APIï¼‰"""
        # ä¸»API
        try:
            result = get_exchange_rate(base, target)
            if result['çŠ¶æ€'] == 'æˆåŠŸ':
                return result
        except:
            pass
        
        # å¤‡ç”¨APIï¼ˆè¿™é‡Œç”¨å¦ä¸€ä¸ªå…è´¹APIï¼‰
        try:
            print("å°è¯•å¤‡ç”¨API...")
            url = f"https://api.frankfurter.app/latest?base={base}&symbols={target}"
            response = requests.get(url, timeout=5)
            data = response.json()
            
            if 'rates' in data and target in data['rates']:
                return {
                    'æ±‡ç‡': data['rates'][target],
                    'æ›´æ–°æ—¶é—´': data.get('date', ''),
                    'çŠ¶æ€': 'æˆåŠŸ',
                    'åŸºç¡€è´§å¸': base,
                    'ç›®æ ‡è´§å¸': target
                }
        except Exception as e:
            print(f"å¤‡ç”¨APIä¹Ÿå¤±è´¥: {e}")
        
        return {'çŠ¶æ€': 'å¤±è´¥', 'é”™è¯¯': 'æ‰€æœ‰APIä¸å¯ç”¨', 'æ±‡ç‡': 0}
    
    def save_to_history(self, rates: Dict):
        """ä¿å­˜åˆ°å†å²è®°å½•CSV"""
        if not self.config['save_history']:
            return
        
        timestamp = datetime.now()
        history_file = self.config['history_file']
        
        # å‡†å¤‡æ•°æ®
        row = {
            'æ—¶é—´æˆ³': timestamp.strftime('%Y-%m-%d %H:%M:%S'),
            'åŸºç¡€è´§å¸': self.config['base_currency']
        }
        
        # æ·»åŠ å„è´§å¸æ±‡ç‡
        for currency, rate in rates.items():
            row[f'{currency}_æ±‡ç‡'] = rate
        
        # è¯»å–æˆ–åˆ›å»ºDataFrame
        if os.path.exists(history_file):
            df = pd.read_csv(history_file)
            df = pd.concat([df, pd.DataFrame([row])], ignore_index=True)
        else:
            df = pd.DataFrame([row])
        
        # ä¿å­˜ï¼ˆåªä¿ç•™æœ€è¿‘1000æ¡ï¼‰
        df = df.tail(1000)
        df.to_csv(history_file, index=False)
        
        print(f"ğŸ’¾ å†å²è®°å½•å·²æ›´æ–°: {history_file}")
    
    def show_history_chart(self):
        """æ˜¾ç¤ºæ±‡ç‡èµ°åŠ¿å›¾ï¼ˆéœ€è¦matplotlibï¼‰"""
        try:
            import matplotlib.pyplot as plt
            
            history_file = self.config['history_file']
            
            if not os.path.exists(history_file):
                print("âš ï¸ æš‚æ— å†å²æ•°æ®")
                return
            
            df = pd.read_csv(history_file)
            df['æ—¶é—´æˆ³'] = pd.to_datetime(df['æ—¶é—´æˆ³'])
            
            # ç»˜åˆ¶å„è´§å¸èµ°åŠ¿
            plt.figure(figsize=(12, 6))
            
            currencies = ['CNY', 'EUR', 'JPY', 'GBP']
            colors = ['red', 'blue', 'green', 'orange']
            
            for i, currency in enumerate(currencies):
                col = f'{currency}_æ±‡ç‡'
                if col in df.columns:
                    plt.plot(df['æ—¶é—´æˆ³'], df[col], marker='o', label=f'{self.config["base_currency"]}/{currency}', color=colors[i])
            
            plt.title(f'{self.config["base_currency"]}æ±‡ç‡èµ°åŠ¿', fontsize=14)
            plt.xlabel('æ—¶é—´')
            plt.ylabel('æ±‡ç‡')
            plt.legend()
            plt.xticks(rotation=45)
            plt.grid(True, linestyle='--', alpha=0.6)
            plt.tight_layout()
            
            plt.savefig(f'æ±‡ç‡èµ°åŠ¿å›¾_{datetime.now().strftime("%Y%m%d")}.png', dpi=150)
            plt.show()
            
        except ImportError:
            print("âš ï¸ æœªå®‰è£…matplotlibï¼Œæ— æ³•æ˜¾ç¤ºå›¾è¡¨")
    
    def run_monitor(self):
        """è¿è¡Œç›‘æ§"""
        print("\nğŸ¤– å¯åŠ¨æ±‡ç‡è‡ªåŠ¨ç›‘æ§ç³»ç»Ÿ")
        print(f"ç›‘æ§åŸºç¡€è´§å¸: {self.config['base_currency']}")
        print(f"æ£€æŸ¥é—´éš”: {self.config['check_interval']}ç§’")
        
        active_pairs = [p for p in self.config['monitor_pairs'] if p['active']]
        
        if not active_pairs:
            print("âš ï¸ æ²¡æœ‰æ¿€æ´»çš„ç›‘æ§é¡¹")
            return
        
        self.monitoring = True
        
        try:
            check_count = 0
            
            while self.monitoring:
                check_count += 1
                print(f"\n{'='*50}")
                print(f"ç¬¬ {check_count} æ¬¡æ£€æŸ¥ - {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
                print(f"{'='*50}")
                
                # è·å–æ‰€æœ‰æ¿€æ´»çš„è´§å¸æ±‡ç‡
                rates = {}
                for pair in active_pairs:
                    target = pair['currency']
                    result = self.get_rate_with_fallback(self.config['base_currency'], target)
                    
                    if result['çŠ¶æ€'] == 'æˆåŠŸ':
                        rate = result['æ±‡ç‡']
                        rates[target] = rate
                        
                        # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç›®æ ‡
                        target_rate = pair['target']
                        direction = pair['direction']
                        
                        if direction == 'above' and rate >= target_rate:
                            print(f"ğŸ¯ {self.config['base_currency']}/{target} è¾¾åˆ°ç›®æ ‡ï¼")
                            self._send_alert(self.config['base_currency'], target, rate, target_rate)
                        elif direction == 'below' and rate <= target_rate:
                            print(f"ğŸ¯ {self.config['base_currency']}/{target} è¾¾åˆ°ç›®æ ‡ï¼")
                            self._send_alert(self.config['base_currency'], target, rate, target_rate)
                        else:
                            diff = abs(rate - target_rate)
                            print(f"  {target}: {rate:.4f} (è·ç¦»ç›®æ ‡{target_rate:.4f}å·®{diff:.4f})")
                    else:
                        print(f"  {target}: æŸ¥è¯¢å¤±è´¥")
                    
                    time.sleep(1)  # ç¤¼è²Œå»¶è¿Ÿ
                
                # ä¿å­˜å†å²
                if rates:
                    self.save_to_history(rates)
                
                # ç­‰å¾…ä¸‹æ¬¡æ£€æŸ¥
                print(f"\nâ° ç­‰å¾… {self.config['check_interval']} ç§’åä¸‹æ¬¡æ£€æŸ¥...")
                time.sleep(self.config['check_interval'])
        
        except KeyboardInterrupt:
            print("\n\nç”¨æˆ·æ‰‹åŠ¨åœæ­¢ç›‘æ§")
            self.monitoring = False
    
    def _send_alert(self, base: str, target: str, current: float, target_rate: float):
        """å‘é€æé†’"""
        print("\n" + "="*50)
        print("ğŸš¨ æ±‡ç‡ç›‘æ§æé†’")
        print("="*50)
        print(f"æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
        print(f"è´§å¸å¯¹: {base}/{target}")
        print(f"å½“å‰æ±‡ç‡: {current:.4f}")
        print(f"ç›®æ ‡æ±‡ç‡: {target_rate:.4f}")
        
        if current >= target_rate:
            print("ğŸ“ˆ æ±‡ç‡ä¸Šæ¶¨çªç ´ç›®æ ‡ï¼")
        else:
            print("ğŸ“‰ æ±‡ç‡ä¸‹è·Œè·Œç ´ç›®æ ‡ï¼")
        
        # å‘å‡ºæç¤ºéŸ³
        if self.config.get('alert_sound', False):
            print('\a')  # å“é“ƒ
        
        print("="*50)
        
        # å¯é€‰ï¼šä¿å­˜æé†’è®°å½•
        alert_file = "æ±‡ç‡æé†’è®°å½•.txt"
        with open(alert_file, 'a', encoding='utf-8') as f:
            f.write(f"{datetime.now()} - {base}/{target}: {current:.4f} (ç›®æ ‡: {target_rate:.4f})\n")

def main():
    """ä¸»èœå•"""
    monitor = RealtimeExchangeMonitor()
    
    print("=" * 60)
    print("å®æ—¶æ±‡ç‡ç›‘æ§å™¨ï¼ˆä¸“ä¸šç‰ˆï¼‰")
    print("æ”¯æŒå¤šè´§å¸å¯¹ç›‘æ§ï¼Œè‡ªåŠ¨è®°å½•å†å²ï¼Œè§¦å‘æé†’")
    print("=" * 60)
    
    while True:
        print("\n" + "=" * 45)
        print("åŠŸèƒ½èœå•")
        print("=" * 45)
        print("1. æŸ¥è¯¢å½“å‰æ±‡ç‡")
        print("2. æŸ¥çœ‹å†å²è®°å½•")
        print("3. æ·»åŠ ç›‘æ§è´§å¸å¯¹")
        print("4. æŸ¥çœ‹é…ç½®")
        print("5. å¯åŠ¨è‡ªåŠ¨ç›‘æ§")
        print("6. æ˜¾ç¤ºæ±‡ç‡èµ°åŠ¿å›¾")
        print("7. é€€å‡º")
        print("=" * 45)
        
        choice = input("è¯·é€‰æ‹©: ").strip()
        
        if choice == "1":
            base = input("åŸºç¡€è´§å¸ï¼ˆé»˜è®¤USDï¼‰: ").strip().upper() or 'USD'
            target = input("ç›®æ ‡è´§å¸ï¼ˆå¦‚CNYï¼‰: ").strip().upper()
            
            if target:
                result = monitor.get_rate_with_fallback(base, target)
                if result['çŠ¶æ€'] == 'æˆåŠŸ':
                    print(f"\nâœ… 1 {base} = {result['æ±‡ç‡']:.4f} {target}")
                    print(f"â° æ›´æ–°æ—¶é—´: {result['æ›´æ–°æ—¶é—´']}")
        
        elif choice == "2":
            monitor.show_history(10)
        
        elif choice == "3":
            monitor.add_monitor_pair()
        
        elif choice == "4":
            print("\nå½“å‰é…ç½®:")
            print(json.dumps(monitor.config, ensure_ascii=False, indent=2))
        
        elif choice == "5":
            print("\nå¯åŠ¨å‰è¯·ç¡®ä¿é…ç½®æ­£ç¡®ã€‚")
            confirm = input("ç¡®è®¤å¯åŠ¨è‡ªåŠ¨ç›‘æ§ï¼Ÿ(y/n): ").strip()
            if confirm.lower() == 'y':
                monitor.run_monitor()
        
        elif choice == "6":
            monitor.show_history_chart()
        
        elif choice == "7":
            print("ğŸ‘‹ æ„Ÿè°¢ä½¿ç”¨ï¼Œç›‘æ§å·²åœæ­¢ï¼")
            monitor.monitoring = False
            break
        
        else:
            print("è¯·è¾“å…¥1-7ï¼")

if __name__ == "__main__":
    main()
```

***

### å…­ã€çŸ¥è¯†ç‚¹åŠ æ²¹ç«™

#### 6.1 JSONè§£ææŠ€å·§

```python
"""
JSONç»“æ„ï¼š
{
  "key1": "value1",
  "key2": 123,
  "key3": {
    "nested": "value"
  },
  "key4": ["item1", "item2"]
}

Pythonè§£æï¼š
data = response.json()

å®‰å…¨å–å€¼ï¼š
name = data.get('name', 'é»˜è®¤å€¼')  # keyä¸å­˜åœ¨ä¸æŠ¥é”™
# ç­‰åŒäºï¼š
name = data['name'] if 'name' in data else 'é»˜è®¤å€¼'

åµŒå¥—å–å€¼ï¼ˆå®¹æ˜“å‡ºé”™ï¼‰ï¼š
# ä¸æ¨è
value = data['a']['b']['c']  # å¦‚æœaæˆ–bä¸å­˜åœ¨ä¼šæŠ¥é”™

# æ¨è
value = data.get('a', {}).get('b', {}).get('c', é»˜è®¤å€¼)

ç±»å‹è½¬æ¢ï¼š
# JSONæ•°å­— â†’ Python
rate = float(data['rate'])

# JSONå­—ç¬¦ä¸² â†’ Python
name = str(data['name'])

# JSONæ•°ç»„ â†’ Pythonåˆ—è¡¨
items = list(data['items'])
"""
```

***

#### 6.2 APIè°ƒç”¨æœ€ä½³å®è·µ

```python
"""
1. è¶…æ—¶è®¾ç½®
   requests.get(url, timeout=10)  # 10ç§’æ²¡å“åº”å°±æ”¾å¼ƒ

2. é”™è¯¯é‡è¯•
   for i in range(3):  # é‡è¯•3æ¬¡
       try:
           response = requests.get(url, timeout=5)
           break
       except:
           time.sleep(2)
           continue

3. è¯·æ±‚å¤´
   headers = {
       'User-Agent': 'MyApp/1.0',
       'Accept': 'application/json'
   }
   requests.get(url, headers=headers)

4. å‚æ•°ä¼ é€’
   params = {'base': 'USD', 'symbols': 'CNY,EUR'}
   requests.get(url, params=params)  # è‡ªåŠ¨è½¬ ?base=USD&symbols=CNY,EUR

5. å“åº”æ£€æŸ¥
   if response.status_code == 200:  # æˆåŠŸ
       data = response.json()
   elif response.status_code == 404:  # æœªæ‰¾åˆ°
       print("APIåœ°å€é”™è¯¯")
   elif response.status_code == 429:  # è¯·æ±‚è¿‡å¤š
       print("APIé™æµï¼Œè¯·ç¨åå†è¯•")
"""
```

***

### ä¸ƒã€æ€»ç»“

- âœ… APIå’ŒJSONçš„åŸºç¡€æ¦‚å¿µ
- âœ… ç”¨requestsåº“è°ƒç”¨RESTful API
- âœ… JSONæ•°æ®çš„è§£æå’Œæå–
- âœ… å¤šè´§å¸æ±‡ç‡ç›‘æ§å™¨
- âœ… å†å²æ•°æ®ä¿å­˜å’Œå¯è§†åŒ–

***

### ä¸‹ç¯‡é¢„å‘Š

ç¬¬25ç¯‡ã€Šæ€»ç»“ä¸å±•æœ›ï¼šPythonå­¦ä¹ è·¯çº¿å›¾ã€‹â€”â€”å›é¡¾25ç¯‡å­¦ä¹ æ—…ç¨‹ï¼Œè§„åˆ’è¿›é˜¶è·¯çº¿ï¼Œæ¨èå­¦ä¹ èµ„æºå’Œå®æˆ˜é¡¹ç›®ï¼

***

> ğŸ¤– Powered by Kimi K2 Thinking ğŸ’» å†…å®¹ç»è‘µè‘µğŸŒ»å®¡æ ¸ä¸ä¿®æ”¹

***

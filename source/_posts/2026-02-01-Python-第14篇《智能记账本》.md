---
title: Python-ç¬¬14ç¯‡ã€Šæ™ºèƒ½è®°è´¦æœ¬ã€‹
categories:
  - ğŸŒ™é€¢å‚æ‚è°ˆä¸æ¬è¿
  - â­æœæœè¯¾ç¨‹
abbrlink: 9321f605
date: 2026-02-01 02:03:22
tags:
---

### å¯¼è¯­

ä¸Šä¸€ç¯‡æˆ‘ä»¬åšäº†è‚¡ç¥¨ç›‘æ§å™¨ï¼Œå­¦ä¼šäº†ä»ç½‘ç»œè·å–å®æ—¶æ•°æ®ã€‚ä¸è¿‡ï¼ŒæŠ•èµ„åªæ˜¯ç†è´¢çš„ä¸€éƒ¨åˆ†ï¼Œæ›´åŸºç¡€çš„æ˜¯æ—¥å¸¸æ”¶æ”¯ç®¡ç†ã€‚ä»Šå¤©æˆ‘ä»¬æ¥æ‰“é€ ä¸€æ¬¾â€œæ‡‚ä½ â€çš„æ™ºèƒ½è®°è´¦æœ¬â€”â€”å®ƒèƒ½è‡ªåŠ¨è¯†åˆ«æ¶ˆè´¹ç±»åˆ«ã€åœ¨ä½ ä¹±èŠ±é’±æ—¶å‘å‡ºè­¦å‘Šï¼Œè¿˜èƒ½ä¸€é”®ç”Ÿæˆæœˆåº¦æŠ¥è¡¨ã€‚

<!--more-->

***

### æœ¬ç¯‡ç›®æ ‡

- è®¾è®¡ç®€å•çš„è®°è´¦æ•°æ®å­˜å‚¨æ ¼å¼
- å®ç°æ”¶æ”¯è‡ªåŠ¨åˆ†ç±»ï¼ˆå…³é”®è¯åŒ¹é…ï¼‰
- æ·»åŠ é¢„ç®—è¶…æ”¯é¢„è­¦åŠŸèƒ½
- ç”Ÿæˆå¸¦å›¾è¡¨çš„æœˆåº¦æ”¶æ”¯æŠ¥è¡¨
- æ‰“é€ äº¤äº’å¼è®°è´¦ç¨‹åº

***

### ä¸€ã€å‡†å¤‡å·¥ä½œï¼šåˆ›å»ºè®°è´¦æ•°æ®æ–‡ä»¶

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ°æ–¹å­˜å‚¨è®°è´¦æ•°æ®ã€‚ç”¨CSVæ–‡ä»¶æœ€ç®€å•ï¼Œå¯ä»¥ç”¨Excelæ‰“å¼€ï¼Œä¹Ÿèƒ½è¢«Pythonè½»æ¾è¯»å†™ã€‚

```python
# ========== Step 1: åˆ›å»ºè®°è´¦æ•°æ®æ–‡ä»¶ ==========
import csv
import os
from datetime import datetime
import pandas as pd
import matplotlib.pyplot as plt

# å®šä¹‰è®°è´¦æ–‡ä»¶è·¯å¾„
RECORD_FILE = "my_accounts.csv"

def init_account_file():
    """åˆå§‹åŒ–è®°è´¦æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰"""
    if not os.path.exists(RECORD_FILE):
        with open(RECORD_FILE, 'w', newline='', encoding='utf-8') as f:
            writer = csv.writer(f)
            # å†™å…¥è¡¨å¤´ï¼šæ—¥æœŸ, ç±»å‹(æ”¶å…¥/æ”¯å‡º), åˆ†ç±», é‡‘é¢, å¤‡æ³¨
            writer.writerow(['æ—¥æœŸ', 'ç±»å‹', 'åˆ†ç±»', 'é‡‘é¢', 'å¤‡æ³¨'])
        print(f"âœ… å·²åˆ›å»ºè®°è´¦æ–‡ä»¶: {RECORD_FILE}")
    else:
        print(f"ğŸ“‚ å·²å­˜åœ¨è®°è´¦æ–‡ä»¶: {RECORD_FILE}")

# åˆå§‹åŒ–
init_account_file()
```

**è¿è¡Œå**ï¼Œä½ ä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹çœ‹åˆ°ä¸€ä¸ª`my_accounts.csv`æ–‡ä»¶ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è®°è´¦æœ¬çš„æ•°æ®åº“å•¦ï¼

***

### äºŒã€æ”¶æ”¯åˆ†ç±»è‡ªåŠ¨è¯†åˆ«

#### 2.1 è®¾è®¡åˆ†ç±»è§„åˆ™

è‡ªåŠ¨åˆ†ç±»çš„æ ¸å¿ƒæ˜¯â€œå…³é”®è¯åŒ¹é…â€ã€‚æ¯”å¦‚å¤‡æ³¨é‡ŒåŒ…å«â€œåƒé¥­â€ã€â€œå¤–å–â€ã€â€œé¤å…â€ï¼Œå°±å½’ä¸ºâ€œé¤é¥®â€ç±»ã€‚

```python
# ========== Step 2: è‡ªåŠ¨åˆ†ç±»å¼•æ“ ==========
# å®šä¹‰åˆ†ç±»å…³é”®è¯å­—å…¸
CATEGORY_RULES = {
    "é¤é¥®": ["åƒé¥­", "å¤–å–", "é¤å…", "å’–å•¡", "å¥¶èŒ¶", "å¿«é¤", "é£Ÿå ‚", "ç¾é£Ÿ"],
    "äº¤é€š": ["æ‰“è½¦", "åœ°é“", "å…¬äº¤", "æ»´æ»´", "åŠ æ²¹", "åœè½¦", "é«˜é“", "æœºç¥¨"],
    "è´­ç‰©": ["æ·˜å®", "äº¬ä¸œ", "æ‹¼å¤šå¤š", "è´­ç‰©", "è¡£æœ", "é‹å­", "åŒ…åŒ…", "åŒ–å¦†å“"],
    "å¨±ä¹": ["ç”µå½±", "æ¸¸æˆ", "KTV", "æ¼”å”±ä¼š", "æ—…æ¸¸", "é—¨ç¥¨", "å¥èº«", "è§†é¢‘ä¼šå‘˜"],
    "ç”Ÿæ´»ç¼´è´¹": ["æ°´ç”µè´¹", "ç”µè´¹", "æ°´è´¹", "ç‡ƒæ°”", "è¯è´¹", "ç½‘è´¹", "æˆ¿ç§Ÿ", "ç‰©ä¸š"],
    "äººæƒ…å¾€æ¥": ["çº¢åŒ…", "ç¤¼ç‰©", "ç¤¼é‡‘", "è¯·å®¢", "èšé¤", "éšç¤¼"],
    "åŒ»ç–—ä¿å¥": ["åŒ»é™¢", "è¯åº—", "çœ‹ç—…", "ä½“æ£€", "ä¹°è¯", "åŒ»ç–—"],
    "å­¦ä¹ æå‡": ["ä¹°ä¹¦", "è¯¾ç¨‹", "åŸ¹è®­", "å­¦ä¹ ", "è€ƒè¯•", "èµ„æ–™"],
    "å·¥èµ„æ”¶å…¥": ["å·¥èµ„", "è–ªæ°´", "è–ªèµ„", "å¥–é‡‘"],
    "å…¶ä»–æ”¶å…¥": ["çº¢åŒ…", "è½¬è´¦", "é€€æ¬¾", "å‰¯ä¸š"]
}

def auto_category(note, trans_type):
    """
    è‡ªåŠ¨è¯†åˆ«åˆ†ç±»
    note: å¤‡æ³¨ä¿¡æ¯
    trans_type: ç±»å‹ï¼ˆ"æ”¶å…¥" æˆ– "æ”¯å‡º"ï¼‰
    """
    note = note.lower()  # è½¬ä¸ºå°å†™
    
    # æ ¹æ®ç±»å‹é€‰æ‹©åˆ†ç±»è§„åˆ™
    if trans_type == "æ”¶å…¥":
        check_cats = {"å·¥èµ„æ”¶å…¥": CATEGORY_RULES["å·¥èµ„æ”¶å…¥"], 
                      "å…¶ä»–æ”¶å…¥": CATEGORY_RULES["å…¶ä»–æ”¶å…¥"]}
    else:  # æ”¯å‡º
        check_cats = {k: v for k, v in CATEGORY_RULES.items() if k not in ["å·¥èµ„æ”¶å…¥", "å…¶ä»–æ”¶å…¥"]}
    
    # åŒ¹é…å…³é”®è¯
    for category, keywords in check_cats.items():
        for keyword in keywords:
            if keyword in note:
                return category
    
    # å¦‚æœæ²¡åŒ¹é…åˆ°ï¼Œæ”¯å‡ºé»˜è®¤"å…¶ä»–æ”¯å‡º"ï¼Œæ”¶å…¥é»˜è®¤"å…¶ä»–æ”¶å…¥"
    return "å…¶ä»–æ”¯å‡º" if trans_type == "æ”¯å‡º" else "å…¶ä»–æ”¶å…¥"

# æµ‹è¯•ä¸€ä¸‹
print("ğŸ§  åˆ†ç±»æµ‹è¯•ï¼š")
print(f"'ä¸­åˆå¤–å–' -> {auto_category('ä¸­åˆå¤–å–', 'æ”¯å‡º')}")
print(f"'å·¥èµ„å‘æ”¾' -> {auto_category('å·¥èµ„å‘æ”¾', 'æ”¶å…¥')}")
print(f"'æ·˜å®è´­ç‰©' -> {auto_category('æ·˜å®è´­ç‰©', 'æ”¯å‡º')}")
```

**è¾“å‡ºç»“æœï¼š**
```
ğŸ§  åˆ†ç±»æµ‹è¯•ï¼š
'ä¸­åˆå¤–å–' -> é¤é¥®
'å·¥èµ„å‘æ”¾' -> å·¥èµ„æ”¶å…¥
'æ·˜å®è´­ç‰©' -> è´­ç‰©
```

***

#### 2.2 æ·»åŠ è®°è´¦åŠŸèƒ½

ç°åœ¨å®ç°æ·»åŠ è®°å½•çš„å‡½æ•°ï¼š

```python
# ========== Step 3: æ·»åŠ è®°è´¦è®°å½• ==========
def add_record():
    """äº¤äº’å¼æ·»åŠ è®°è´¦è®°å½•"""
    print("\n" + "=" * 40)
    print("æ·»åŠ æ–°è®°å½•")
    print("=" * 40)
    
    # 1. è¾“å…¥ç±»å‹
    while True:
        trans_type = input("ç±»å‹ï¼ˆ1-æ”¶å…¥ï¼Œ2-æ”¯å‡ºï¼‰ï¼š").strip()
        if trans_type == "1":
            trans_type = "æ”¶å…¥"
            break
        elif trans_type == "2":
            trans_type = "æ”¯å‡º"
            break
        else:
            print("è¯·è¾“å…¥1æˆ–2ï¼")
    
    # 2. è¾“å…¥é‡‘é¢
    while True:
        try:
            amount = float(input("é‡‘é¢ï¼š").strip())
            if amount <= 0:
                print("é‡‘é¢å¿…é¡»å¤§äº0ï¼")
            else:
                break
        except:
            print("è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—ï¼")
    
    # 3. è¾“å…¥å¤‡æ³¨
    note = input("å¤‡æ³¨ï¼ˆå¦‚ï¼šåˆé¥­å¤–å–ï¼‰ï¼š").strip()
    
    # 4. è‡ªåŠ¨åˆ†ç±»
    category = auto_category(note, trans_type)
    print(f"ğŸ“Œ è‡ªåŠ¨åˆ†ç±»ä¸ºï¼š{category}")
    
    # 5. è·å–å½“å‰æ—¥æœŸ
    date_str = datetime.now().strftime('%Y-%m-%d')
    
    # 6. å†™å…¥æ–‡ä»¶
    with open(RECORD_FILE, 'a', newline='', encoding='utf-8') as f:
        writer = csv.writer(f)
        writer.writerow([date_str, trans_type, category, amount, note])
    
    print("âœ… è®°å½•æ·»åŠ æˆåŠŸï¼\n")

# æµ‹è¯•æ·»åŠ å‡ æ¡è®°å½•
# add_record()
# add_record()
```

***

### ä¸‰ã€é¢„ç®—è¶…æ”¯æé†’

#### 3.1 è®¾ç½®æœˆåº¦é¢„ç®—

å…ˆä¸ºæ¯ä¸ªæ”¯å‡ºåˆ†ç±»è®¾ç½®æœˆåº¦é¢„ç®—ï¼š

```python
# ========== Step 4: é¢„ç®—ç®¡ç†ç³»ç»Ÿ ==========
# è®¾ç½®å„ç±»åˆ«çš„æœˆåº¦é¢„ç®—ï¼ˆå…ƒï¼‰
MONTHLY_BUDGET = {
    "é¤é¥®": 2000,
    "äº¤é€š": 800,
    "è´­ç‰©": 1500,
    "å¨±ä¹": 1000,
    "ç”Ÿæ´»ç¼´è´¹": 1500,
    "äººæƒ…å¾€æ¥": 800,
    "åŒ»ç–—ä¿å¥": 500,
    "å­¦ä¹ æå‡": 500,
    "å…¶ä»–æ”¯å‡º": 500
}

def check_budget_alert():
    """æ£€æŸ¥é¢„ç®—è¶…æ”¯æƒ…å†µ"""
    print("\n" + "=" * 40)
    print("é¢„ç®—ä½¿ç”¨æƒ…å†µæ£€æŸ¥")
    print("=" * 40)
    
    # è¯»å–æœ¬æœˆæ•°æ®
    df = pd.read_csv(RECORD_FILE, encoding='utf-8')
    df['æ—¥æœŸ'] = pd.to_datetime(df['æ—¥æœŸ'])
    
    # è·å–å½“å‰æœˆä»½
    current_month = datetime.now().strftime('%Y-%m')
    df_this_month = df[df['æ—¥æœŸ'].dt.strftime('%Y-%m') == current_month]
    
    # åªç»Ÿè®¡æ”¯å‡º
    df_expense = df_this_month[df_this_month['ç±»å‹'] == 'æ”¯å‡º']
    
    # æŒ‰åˆ†ç±»ç»Ÿè®¡
    expense_by_cat = df_expense.groupby('åˆ†ç±»')['é‡‘é¢'].sum()
    
    # æ£€æŸ¥æ¯ç±»é¢„ç®—
    alert_triggered = False
    for category, budget in MONTHLY_BUDGET.items():
        spent = expense_by_cat.get(category, 0)
        usage_rate = (spent / budget) * 100 if budget > 0 else 0
        
        # æ˜¾ç¤ºè¿›åº¦æ¡
        bar_length = 20
        filled = int(bar_length * min(usage_rate / 100, 1))
        bar = "â–ˆ" * filled + "â–‘" * (bar_length - filled)
        
        print(f"\n{category}:")
        print(f"  é¢„ç®—: Â¥{budget:.2f} | å·²ç”¨: Â¥{spent:.2f}")
        print(f"  [{bar}] {usage_rate:.1f}%")
        
        # è¶…æ”¯è­¦å‘Š
        if usage_rate >= 100:
            print(f"  ğŸš¨ **å·²è¶…æ”¯ï¼** æœ¬æœˆåœ¨'{category}'ä¸Šå·²èŠ±è´¹Â¥{spent:.2f}ï¼Œè¶…å‡ºé¢„ç®—Â¥{spent - budget:.2f}")
            alert_triggered = True
        elif usage_rate >= 80:
            print(f"  âš ï¸  **å³å°†è¶…æ”¯ï¼** å·²ä½¿ç”¨{budget:.1f}%")
            alert_triggered = True
    
    if not alert_triggered:
        print("\nâœ… æ­å–œï¼å„ç±»æ”¯å‡ºéƒ½åœ¨é¢„ç®—èŒƒå›´å†…ï¼Œç»§ç»­ä¿æŒï¼")
    
    return expense_by_cat
```

***

### å››ã€æœˆåº¦æŠ¥è¡¨ç”Ÿæˆ

#### 4.1 ç”Ÿæˆç»Ÿè®¡å›¾è¡¨

ç”¨`matplotlib`ç”Ÿæˆæ¼‚äº®çš„æ”¶æ”¯æŠ¥è¡¨ï¼š

```python
# ========== Step 5: æœˆåº¦æŠ¥è¡¨ç”Ÿæˆå™¨ ==========
def generate_monthly_report():
    """ç”Ÿæˆæœ¬æœˆæ”¶æ”¯æŠ¥è¡¨"""
    print("\n" + "=" * 40)
    print("ç”Ÿæˆæœˆåº¦æŠ¥è¡¨")
    print("=" * 40)
    
    # è¯»å–æ•°æ®
    try:
        df = pd.read_csv(RECORD_FILE, encoding='utf-8')
        df['æ—¥æœŸ'] = pd.to_datetime(df['æ—¥æœŸ'])
    except:
        print("ğŸ“­ æš‚æ— è®°è´¦æ•°æ®ï¼Œæ— æ³•ç”ŸæˆæŠ¥è¡¨")
        return
    
    # è·å–å½“å‰æœˆä»½
    current_month = datetime.now().strftime('%Y-%m')
    df_this_month = df[df['æ—¥æœŸ'].dt.strftime('%Y-%m') == current_month]
    
    if df_this_month.empty:
        print(f"ğŸ“­ {current_month} æš‚æ— æ•°æ®")
        return
    
    # 1. æ”¶å…¥æ”¯å‡ºæ€»è§ˆ
    income = df_this_month[df_this_month['ç±»å‹'] == 'æ”¶å…¥']['é‡‘é¢'].sum()
    expense = df_this_month[df_this_month['ç±»å‹'] == 'æ”¯å‡º']['é‡‘é¢'].sum()
    balance = income - expense
    
    print(f"\nğŸ“Š {current_month} æ”¶æ”¯æ€»è§ˆ")
    print(f"æ€»æ”¶å…¥:  Â¥{income:10,.2f}")
    print(f"æ€»æ”¯å‡º:  Â¥{expense:10,.2f}")
    print(f"å‡€ç»“ä½™:  Â¥{balance:10,.2f}")
    print(f"ç»“ä½™ç‡:  {(balance/income*100 if income>0 else 0):10.1f}%")
    
    # 2. æ”¯å‡ºåˆ†ç±»é¥¼å›¾
    expense_by_cat = df_this_month[df_this_month['ç±»å‹'] == 'æ”¯å‡º'].groupby('åˆ†ç±»')['é‡‘é¢'].sum()
    
    plt.figure(figsize=(12, 5))
    
    # å­å›¾1ï¼šæ”¯å‡ºåˆ†ç±»é¥¼å›¾
    plt.subplot(1, 2, 1)
    plt.pie(expense_by_cat.values, labels=expense_by_cat.index, autopct='%1.1f%%')
    plt.title(f'{current_month} æ”¯å‡ºåˆ†ç±»')
    
    # å­å›¾2ï¼šæ¯æ—¥æ”¯å‡ºè¶‹åŠ¿
    plt.subplot(1, 2, 2)
    daily_expense = df_this_month[df_this_month['ç±»å‹'] == 'æ”¯å‡º'].groupby(df['æ—¥æœŸ'].dt.day)['é‡‘é¢'].sum()
    plt.plot(daily_expense.index, daily_expense.values, marker='o')
    plt.title('æ¯æ—¥æ”¯å‡ºè¶‹åŠ¿')
    plt.xlabel('æ—¥æœŸ')
    plt.ylabel('é‡‘é¢ï¼ˆå…ƒï¼‰')
    plt.grid(True)
    
    plt.tight_layout()
    plt.savefig(f'{current_month}_report.png', dpi=150, bbox_inches='tight')
    print(f"\nâœ… å›¾è¡¨å·²ä¿å­˜ä¸º: {current_month}_report.png")
    plt.show()
    
    # 3. è¯¦ç»†æµæ°´
    print(f"\nğŸ“ è¯¦ç»†æµæ°´ï¼ˆæŒ‰æ—¥æœŸæ’åºï¼‰ï¼š")
    df_sorted = df_this_month.sort_values('æ—¥æœŸ', ascending=False)
    for _, row in df_sorted.iterrows():
        print(f"{row['æ—¥æœŸ'].strftime('%m-%d')}  {row['ç±»å‹']}  {row['åˆ†ç±»']:>6}  Â¥{row['é‡‘é¢']:>8.2f}  {row['å¤‡æ³¨']}")
```

***

### äº”ã€å®Œæ•´é¡¹ç›®ä»£ç 

ç°åœ¨æŠŠæ‰€æœ‰åŠŸèƒ½æ•´åˆæˆä¸€ä¸ªäº¤äº’å¼ç¨‹åºï¼š

```python
# ========== æ™ºèƒ½è®°è´¦æœ¬ - å®Œæ•´ç‰ˆ ==========
import csv
import os
import pandas as pd
import matplotlib.pyplot as plt
from datetime import datetime

# é…ç½®æ–‡ä»¶
RECORD_FILE = "my_accounts.csv"
CATEGORY_RULES = {
    "é¤é¥®": ["åƒé¥­", "å¤–å–", "é¤å…", "å’–å•¡", "å¥¶èŒ¶", "å¿«é¤", "é£Ÿå ‚", "ç¾é£Ÿ"],
    "äº¤é€š": ["æ‰“è½¦", "åœ°é“", "å…¬äº¤", "æ»´æ»´", "åŠ æ²¹", "åœè½¦", "é«˜é“", "æœºç¥¨"],
    "è´­ç‰©": ["æ·˜å®", "äº¬ä¸œ", "æ‹¼å¤šå¤š", "è´­ç‰©", "è¡£æœ", "é‹å­", "åŒ…åŒ…", "åŒ–å¦†å“"],
    "å¨±ä¹": ["ç”µå½±", "æ¸¸æˆ", "KTV", "æ¼”å”±ä¼š", "æ—…æ¸¸", "é—¨ç¥¨", "å¥èº«", "ä¼šå‘˜"],
    "ç”Ÿæ´»ç¼´è´¹": ["æ°´ç”µè´¹", "ç”µè´¹", "æ°´è´¹", "ç‡ƒæ°”", "è¯è´¹", "ç½‘è´¹", "æˆ¿ç§Ÿ", "ç‰©ä¸š"],
    "äººæƒ…å¾€æ¥": ["çº¢åŒ…", "ç¤¼ç‰©", "ç¤¼é‡‘", "è¯·å®¢", "èšé¤", "éšç¤¼"],
    "åŒ»ç–—ä¿å¥": ["åŒ»é™¢", "è¯åº—", "çœ‹ç—…", "ä½“æ£€", "ä¹°è¯", "åŒ»ç–—"],
    "å­¦ä¹ æå‡": ["ä¹°ä¹¦", "è¯¾ç¨‹", "åŸ¹è®­", "å­¦ä¹ ", "è€ƒè¯•", "èµ„æ–™"],
    "å·¥èµ„æ”¶å…¥": ["å·¥èµ„", "è–ªæ°´", "è–ªèµ„", "å¥–é‡‘"],
    "å…¶ä»–æ”¶å…¥": ["çº¢åŒ…", "è½¬è´¦", "é€€æ¬¾", "å‰¯ä¸š"]
}

MONTHLY_BUDGET = {
    "é¤é¥®": 2000, "äº¤é€š": 800, "è´­ç‰©": 1500, "å¨±ä¹": 1000,
    "ç”Ÿæ´»ç¼´è´¹": 1500, "äººæƒ…å¾€æ¥": 800, "åŒ»ç–—ä¿å¥": 500,
    "å­¦ä¹ æå‡": 500, "å…¶ä»–æ”¯å‡º": 500
}

def init_file():
    if not os.path.exists(RECORD_FILE):
        with open(RECORD_FILE, 'w', newline='', encoding='utf-8') as f:
            csv.writer(f).writerow(['æ—¥æœŸ', 'ç±»å‹', 'åˆ†ç±»', 'é‡‘é¢', 'å¤‡æ³¨'])
        print("ğŸ“ åˆå§‹åŒ–è®°è´¦æ–‡ä»¶...")

def auto_category(note, trans_type):
    note = note.lower()
    if trans_type == "æ”¶å…¥":
        check_cats = {"å·¥èµ„æ”¶å…¥": CATEGORY_RULES["å·¥èµ„æ”¶å…¥"], 
                      "å…¶ä»–æ”¶å…¥": CATEGORY_RULES["å…¶ä»–æ”¶å…¥"]}
    else:
        check_cats = {k: v for k, v in CATEGORY_RULES.items() 
                      if "æ”¶å…¥" not in k}
    
    for cat, keywords in check_cats.items():
        for kw in keywords:
            if kw in note:
                return cat
    return "å…¶ä»–æ”¯å‡º" if trans_type == "æ”¯å‡º" else "å…¶ä»–æ”¶å…¥"

def add_record():
    print("\n" + "=" * 40)
    print("ğŸ“ æ·»åŠ æ–°è®°å½•")
    print("=" * 40)
    
    # ç±»å‹
    while True:
        t = input("ç±»å‹ï¼ˆ1-æ”¶å…¥ï¼Œ2-æ”¯å‡ºï¼‰: ").strip()
        if t in ["1", "2"]:
            trans_type = "æ”¶å…¥" if t == "1" else "æ”¯å‡º"
            break
        print("è¯·è¾“å…¥1æˆ–2ï¼")
    
    # é‡‘é¢
    while True:
        try:
            amount = float(input("é‡‘é¢: ").strip())
            if amount > 0:
                break
            print("é‡‘é¢å¿…é¡»å¤§äº0ï¼")
        except:
            print("è¯·è¾“å…¥æ•°å­—ï¼")
    
    # å¤‡æ³¨
    note = input("å¤‡æ³¨ï¼ˆå¦‚ï¼šåˆé¥­å¤–å–ï¼‰: ").strip()
    category = auto_category(note, trans_type)
    print(f"ğŸ“Œ è‡ªåŠ¨åˆ†ç±»: {category}")
    
    # ä¿å­˜
    with open(RECORD_FILE, 'a', newline='', encoding='utf-8') as f:
        csv.writer(f).writerow([
            datetime.now().strftime('%Y-%m-%d'),
            trans_type, category, amount, note
        ])
    print("âœ… ä¿å­˜æˆåŠŸï¼")
    
    # æ£€æŸ¥é¢„ç®—
    if trans_type == "æ”¯å‡º":
        input("\næŒ‰å›è½¦é”®æŸ¥çœ‹é¢„ç®—ä½¿ç”¨æƒ…å†µ...")
        check_budget()

def view_records():
    """æŸ¥çœ‹å†å²è®°å½•"""
    print("\n" + "=" * 40)
    print("ğŸ“‹ å†å²è®°å½•")
    print("=" * 40)
    
    try:
        df = pd.read_csv(RECORD_FILE, encoding='utf-8')
        df['æ—¥æœŸ'] = pd.to_datetime(df['æ—¥æœŸ'])
        df = df.sort_values('æ—¥æœŸ', ascending=False)
        
        print(f"\n{'æ—¥æœŸ':<12} {'ç±»å‹':<4} {'åˆ†ç±»':<8} {'é‡‘é¢':>8} {'å¤‡æ³¨'}")
        print("-" * 60)
        for _, r in df.iterrows():
            print(f"{r['æ—¥æœŸ'].strftime('%m-%d'):<12} {r['ç±»å‹']:<4} {r['åˆ†ç±»']:<8} Â¥{r['é‡‘é¢']:>7.2f} {r['å¤‡æ³¨']}")
    except:
        print("æš‚æ— è®°å½•ï¼")

def check_budget():
    """æ£€æŸ¥é¢„ç®—"""
    try:
        df = pd.read_csv(RECORD_FILE, encoding='utf-8')
        df['æ—¥æœŸ'] = pd.to_datetime(df['æ—¥æœŸ'])
        df_this_month = df[df['æ—¥æœŸ'].dt.strftime('%Y-%m') == datetime.now().strftime('%Y-%m')]
        df_expense = df_this_month[df_this_month['ç±»å‹'] == 'æ”¯å‡º']
        expense_by_cat = df_expense.groupby('åˆ†ç±»')['é‡‘é¢'].sum()
        
        print("\nğŸ’° æœ¬æœˆé¢„ç®—ä½¿ç”¨æƒ…å†µï¼š\n")
        for cat, budget in MONTHLY_BUDGET.items():
            spent = expense_by_cat.get(cat, 0)
            rate = (spent / budget * 100) if budget else 0
            bar = "â–ˆ" * int(min(rate, 100) / 5) + "â–‘" * (20 - int(min(rate, 100) / 5))
            print(f"{cat:>8}: [{bar}] {rate:>5.1f}% (Â¥{spent:.0f}/Â¥{budget:.0f})")
    
    except Exception as e:
        print(f"æ£€æŸ¥å¤±è´¥: {e}")

def report():
    """ç”ŸæˆæŠ¥è¡¨"""
    try:
        df = pd.read_csv(RECORD_FILE, encoding='utf-8')
        df['æ—¥æœŸ'] = pd.to_datetime(df['æ—¥æœŸ'])
        
        current_month = datetime.now().strftime('%Y-%m')
        df_this = df[df['æ—¥æœŸ'].dt.strftime('%Y-%m') == current_month]
        
        if df_this.empty:
            print("æœ¬æœˆæš‚æ— æ•°æ®ï¼")
            return
        
        # æ”¶æ”¯æ€»è§ˆ
        income = df_this[df_this['ç±»å‹'] == 'æ”¶å…¥']['é‡‘é¢'].sum()
        expense = df_this[df_this['ç±»å‹'] == 'æ”¯å‡º']['é‡‘é¢'].sum()
        balance = income - expense
        
        print("\n" + "=" * 40)
        print(f"ğŸ“Š {current_month} æ”¶æ”¯æ€»è§ˆ")
        print("=" * 40)
        print(f"æ€»æ”¶å…¥:  Â¥{income:10,.2f}")
        print(f"æ€»æ”¯å‡º:  Â¥{expense:10,.2f}")
        print(f"å‡€ç»“ä½™:  Â¥{balance:10,.2f}")
        
        # ç”Ÿæˆå›¾è¡¨
        expense_by_cat = df_this[df_this['ç±»å‹'] == 'æ”¯å‡º'].groupby('åˆ†ç±»')['é‡‘é¢'].sum()
        
        if not expense_by_cat.empty:
            plt.figure(figsize=(12, 5))
            
            # é¥¼å›¾
            plt.subplot(1, 2, 1)
            plt.pie(expense_by_cat.values, labels=expense_by_cat.index, autopct='%1.1f%%')
            plt.title('æ”¯å‡ºåˆ†ç±»')
            
            # è¶‹åŠ¿
            plt.subplot(1, 2, 2)
            daily = df_this[df_this['ç±»å‹'] == 'æ”¯å‡º'].groupby(df['æ—¥æœŸ'].dt.day)['é‡‘é¢'].sum()
            plt.plot(daily.index, daily.values, marker='o')
            plt.title('æ¯æ—¥æ”¯å‡ºè¶‹åŠ¿')
            plt.xlabel('æ—¥æœŸ')
            plt.ylabel('é‡‘é¢')
            plt.grid(True)
            
            plt.tight_layout()
            plt.savefig(f'{current_month}_report.png', dpi=150, bbox_inches='tight')
            print(f"\nâœ… å›¾è¡¨å·²ä¿å­˜: {current_month}_report.png")
            plt.show()
        
    except Exception as e:
        print(f"ç”ŸæˆæŠ¥è¡¨å¤±è´¥: {e}")

def main():
    """ä¸»èœå•"""
    init_file()
    
    while True:
        print("\n" + "=" * 50)
        print("æ™ºèƒ½è®°è´¦æœ¬")
        print("=" * 50)
        print("1. æ·»åŠ æ–°è®°å½•")
        print("2. æŸ¥çœ‹å†å²è®°å½•")
        print("3. é¢„ç®—ä½¿ç”¨æƒ…å†µ")
        print("4. ç”Ÿæˆæœ¬æœˆæŠ¥è¡¨")
        print("5. é€€å‡º")
        print("=" * 50)
        
        choice = input("è¯·é€‰æ‹©åŠŸèƒ½ï¼ˆ1-5ï¼‰: ").strip()
        
        if choice == "1":
            add_record()
        elif choice == "2":
            view_records()
        elif choice == "3":
            check_budget()
        elif choice == "4":
            report()
        elif choice == "5":
            print("ğŸ‘‹ æ„Ÿè°¢ä½¿ç”¨ï¼Œå†è§ï¼")
            break
        else:
            print("è¯·è¾“å…¥1-5ä¹‹é—´çš„æ•°å­—ï¼")

if __name__ == "__main__":
    main()
```

***

### å…­ã€ä½¿ç”¨æ–¹æ³•

ä¿å­˜ä¸º`smart_account_book.py`ï¼Œç„¶åè¿è¡Œï¼š`python smart_account_book.py`

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```
==================================================
æ™ºèƒ½è®°è´¦æœ¬
==================================================
1. æ·»åŠ æ–°è®°å½•
2. æŸ¥çœ‹å†å²è®°å½•
3. é¢„ç®—ä½¿ç”¨æƒ…å†µ
4. ç”Ÿæˆæœ¬æœˆæŠ¥è¡¨
5. é€€å‡º
==================================================
è¯·é€‰æ‹©åŠŸèƒ½ï¼ˆ1-5ï¼‰ï¼š1
```

ç„¶åæŒ‰ç…§æç¤ºæ“ä½œå³å¯ï¼Œæ‰€æœ‰æ•°æ®ä¼šè‡ªåŠ¨ä¿å­˜åˆ°`my_accounts.csv`ã€‚

***

### ä¸ƒã€çŸ¥è¯†ç‚¹åŠ æ²¹ç«™

#### 7.1 CSVæ–‡ä»¶æ“ä½œ

- `csv.writer()`ï¼šå†™å…¥æ•°æ®
- `pd.read_csv()`ï¼šè¯»å–ä¸ºDataFrame
- `encoding='utf-8'`ï¼šç¡®ä¿ä¸­æ–‡ä¸ä¹±ç 

#### 7.2 æ—¥æœŸå¤„ç†æŠ€å·§

```python
from datetime import datetime

# è·å–å½“å‰æ—¥æœŸ
datetime.now().strftime('%Y-%m-%d')  # 2026-01-26

# ä»DataFrameä¸­æå–æœˆä»½
df['æ—¥æœŸ'].dt.strftime('%Y-%m')  # æå–å¹´æœˆ
df['æ—¥æœŸ'].dt.day               # æå–æ—¥
```

#### 7.3 MatplotlibåŸºç¡€

- `plt.figure(figsize=(å®½, é«˜))`ï¼šåˆ›å»ºå›¾è¡¨
- `plt.subplot(è¡Œ, åˆ—, ç¬¬å‡ ä¸ª)`ï¼šå­å›¾
- `plt.savefig()`ï¼šä¿å­˜å›¾ç‰‡
- `plt.show()`ï¼šæ˜¾ç¤ºå›¾è¡¨

***

### å…«ã€æ€»ç»“

- âœ… è‡ªåŠ¨åˆ†ç±»çš„è®°è´¦ç³»ç»Ÿ
- âœ… é¢„ç®—è¶…æ”¯é¢„è­¦
- âœ… å¸¦å›¾è¡¨çš„æœˆåº¦æŠ¥è¡¨
- âœ… å®Œæ•´çš„äº¤äº’å¼ç¨‹åº

***

### ä¸‹ç¯‡é¢„å‘Š

ç¬¬15ç¯‡ã€ŠExcelæ‰¹é‡å¤„ç†å™¨ã€‹â€”â€”è§£æ”¾åŒæ‰‹ï¼Œè®©Pythonå¸®ä½ è‡ªåŠ¨åŒ–å¤„ç†å‡ åä¸ªExcelæ–‡ä»¶ï¼Œæ–‡ä»¶å¤„ç†çš„æ•ˆç‡ç¥å™¨ï¼

***

> ğŸ¤– Powered by Kimi K2 Thinking ğŸ’» å†…å®¹ç»è‘µè‘µğŸŒ»å®¡æ ¸ä¸ä¿®æ”¹

***

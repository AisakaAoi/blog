---
title: 论文阅读-ResNet论文精读-《Deep Residual Learning for Image Recognition》
categories:
  - 🌙进阶学习
  - ⭐论文阅读
  - 💫精读经典
abbrlink: da444d02
date: 2021-11-23 17:31:36
tags:
---

### 原文

{% pdf ./file/paper/2015-Deep-Residual-Learning-for-Image-Recognition.pdf %}

***

<!--more-->

### ResNet

#### 基本信息

**标题：**Deep Residual Learning for Image Recognition
**时间：**2015
**论文领域：**深度学习，计算机视觉
**论文链接：**<https://arxiv.org/abs/1512.03385>

***

### pass 1

论文标题中文意思是：深度残差学习的图像识别。论文标题指出了关键词：**Residual Learning**，残差是数理统计中常用到的一个词。

本篇论文作者全部为中国学者，这四个人现在都很有名了。一作也是 **CVPR 2009** 的最佳论文获得者，目前在Facebook AI Research任研究科学家；二作、三作当时是微软亚洲研究院的实习生，目前二作在旷视工作，三作在蔚来工作，通信作者目前是旷视研究院院长。

{% asset_img 1.png %}

下面是论文摘要，摘要总共11句话：
- 第1句话就提出了论文要解决的问题，**更深的神经网络很难训练**。
- 第2、3句介绍了论文使用的方法，提出了一个**残差学习框架**使深的神经网络更容易训练，网络中的层对层输入的残差函数进行学习。
- 4-7句为在**ImageNet**上的比赛结果，论文设计的152层网络取得了3.57%的错误率，获得了比赛第一名。
- 第8句，作者在**CIFAR-10**数据集上进行了100层和1000层网络的实验分析。
- 9-11句，其它比赛结果，在**ILSVRC**和**COCO 2015**比赛上获得了**ImageNet**检测任务，定位任务，**COCO**检测和分割任务的第一名。

{% asset_img 2.png %}

由于**CVPR2016**要求提交论文正文在8页以内，从摘要可以看出，作者做的实验是比较多的，因此本篇论文没有结论部分。

***

### pass 2

#### Introduction

总共9段。第一段介绍故事背景，第二段引出第一个问题：堆叠更多的层数以后网络是否学习效果更好？但是堆叠更多的层后往往会遇到**梯度爆炸、梯度消失**问题，会从一开始就阻止收敛。好在这个问题可以通过归一化初始化或中间层归一化来解决。第三段介绍了另一个问题：当网络开始收敛时，往往会出现**退化现象**。随着网络深度的增加，准确率趋近饱和，然后迅速下降。意外的是，这不是由于过拟合造成的，更深的模型反而会有更高的训练误差。

{% asset_img 3.png %}

第4-6段，为了解决深度学习的退化问题，作者提出了**深度残差学习框架**，让网络层去**拟合残差映射**。如果我们想要得到的映射为 H(x)，则我们让添加的非线性网络层去拟合**残差映射** F(x) = H(x) − x，则原始的映射就可以写成 F(x) + x。残差映射的实现可以通过图2所示的连接块实现，**跳跃连接**是一个恒等映射，没有引入额外的参数和计算复杂度，整个网络很容易实现（最初**ResNet**是使用**Caffe**库实现的）。

后面三段是本文设计的网络在**ImageNet**、**CIFAR-10**、**COCO**数据集上的实验结果，大量的实验结果表明作者设计的**残差学习框架**的通用性，一方面不仅使得网络更容易优化，另一方面随着网络深度的增加，网络复杂度并没有明显增加，准确率却会提高很多。

{% asset_img 4.png %}

***

#### Deep Residual Learning

这里要理解各种**ResNet**是如何形成的。网络设计原则为：（1）对于相同的输出特征图尺寸，卷积层具有相同数量的卷积核；（2）如果特征图尺寸减半，则卷积核数量加倍，以便保持每层的时间复杂度。通过步长为2的卷积层直接执行下采样。下面以**ResNet-34**为例进行介绍：
- 首先是**第一个卷积层**，卷积核大小为 7 × 7，卷积核个数为64，步长为2
- 然后是**第二个卷积层**，卷积核大小为 3 × 3，卷积核个数为64，步长为2
- 接着是**三个残差连接块**，每一个连接块由两层卷积网络组成，卷积核大小为 3 × 3，卷积核个数为64
- 然后是**四个残差连接块**，每一个连接块由两层卷积网络组成，卷积核大小为 3 × 3，卷积核个数为128
- 接着是**六个残差连接块**，每一个连接块由两层卷积网络组成，卷积核大小为 3 × 3，卷积核个数为256
- 然后是**三个残差连接块**，每一个连接块由两层卷积网络组成，卷积核大小为 3 × 3，卷积核个数为512

最后是全局平均池化层和具有softmax的1000维度的全连接层，这样整个网络包含 1 + 1 + (3 + 4 + 6 + 3) × 2 = 34 个卷积层。尽管网络深度相比**VGG-19**要深了许多，但是**FLOPs**只是**VGG-19**的18%左右。

{% asset_img 5.png %}

从表1可以看到，**ResNet-18**和**ResNet-34**具有相同的残差连接块，每个连接块包含两个卷积层。而**ResNet-50/101/152**的每个连接块包含3个卷积层。作者把这种连接块称为**bottleneck**，这里主要使用了1 × 1的卷积核，主要是用于匹配特征图维度以及从实践出发能够承担的起训练时间。（之前听过论文通信作者的一个报告，据说这个网络训练时间为一个月，具体一个月是指纯训练还是指训练+测试+调参就不太清楚了）。

{% asset_img 6.png %}

***

#### Implementation

作者是参考**AlexNet**和**VGG**来进行训练。首先对图像的短边进行尺度扩大，扩大到[256, 480]，然后和**AlexNet**一样，随机选择 224 × 224 大小的图案。作者在这里使用到了**batch normalization**(BN)技术；然后作者按照自己的另一篇文章来进行**初始化**并从零开始训练（如果对作者之前工作不了解的话还要再去看作者的文章了解如何对网络初始化，对第一次看到这篇文章的读者来说增加了阅读难度，不过作者可能也是因为受到篇幅影响，不想再过多介绍）。梯度下降使用了**SGD**，**mini-batch**大小为256，总共进行了 60 × 10^4 次迭代（目前很少有这样的写法了，都是介绍训练了多少个epochs）。为了得到最好的实验结果，作者在多个尺度上进行评估，然后取平均分。

{% asset_img 7.png %}

***

#### Experiments

从论文中可以看到作者做了大量实验。首先是**ImageNet Classification**，首先评估了**plain-18/34**两个网络，从表2可以看到，**plain-34**网络比**plain-18**有更高的错误率，从图4左图也可以看到，在训练过程中，出现了**退化现象**，随着网络深度的增加，训练误差反而变大。作者在论文中解释到：退化现象应该不是**梯度消失**引起的，因为整个训练使用了**BN**来训练，也查验了反向传播时梯度幅值也是正常的，作者怀疑**可能是因为更深的网络有着更低的收敛速度，影响着训练误差的减小，这个问题未来会进一步研究**。

接着是**ResNet-18/34**两个网络的评估，从表2和图4右图可以观察到三个现象：
- 网络越深，训练误差反而越小，**退化问题可以通过残差学习得到解决**
- 与**plain-34**网络相比，训练误差下降了3.5%，随着网络深度的不断增加，网络性能进一步提高
- 与**palin-18/34**网络相比，残差网络收敛速度更快

{% asset_img 8.png %}

然后是**恒等跳跃连接和投影跳跃连接**的对比，可以看到三种连接都有助于提高网络性能，但是为了不增加网络结构的复杂度，作者这里主要选择恒等跳跃连接进行后续的实验。

{% asset_img 9.png %}

下面是**ResNet-50/101/152**网络的评估，首先可以看到，尽管网络深度不断增加，但是复杂度依然低于**VGG-16/19**。随着网络深度的不断增加，错误率不断下降，同时在训练过程中也没有出现退化现象，在单个模型上取得了4.49%的错误率，在**ImageNet2015**比赛上，通过集成6个不同的模型，取得了3.57%的错误率（这是一个很了不起的结果，因为ImageNet数据集在人工标注时，可能就会有1%的错误率。）

{% asset_img 10.png %}

最后总结一下，**ResNet**解决了网络训练退化的问题，找到了可以训练更深网络的办法，目前已经成为了深度学习中最重要的一种模型。

***

#### 从梯度的角度对残差学习理论进行阐述

这里使用吴恩达老师的讲义来进一步补充。

{% asset_img 11.png %}

假设有一个很大的神经网络，其输入为X，输出为a[l]。为这个神经网络再添加残差块，输出为a[l+2]。假设整个网络中都选用 ReLU 作为激活函数，因此输出的**所有激活值都大于等于0**。a[l]与a[l+2]之间的函数关系为：

{% asset_img 12.png %}

当发生梯度消失时，即残差块网络没有学到有用信息，W[l+2] ≈ 0，b[l+2] ≈ 0，则有：

{% asset_img 13.png %}

因此，**残差块的使用不会降低网络性能**。而如果没有发生梯度消失时，训练得到的非线性关系会使得网络性能进一步提高。（关于残差网络的理论更深解释，也有很多相关的研究，感兴趣可以查阅对应文献。）

***

### 参考资料

> <https://www.bilibili.com/video/BV1P3411y7nn>

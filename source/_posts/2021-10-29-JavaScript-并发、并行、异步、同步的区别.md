---
title: JavaScript-并发、并行、异步、同步的区别
categories:
  - 🌙基础学习
  - ⭐JavaScript
abbrlink: 6a74f0a0
date: 2021-10-29 17:31:15
tags:
---

### 引言

并发、并行、异步、同步，这些属于之间到底有什么区别和联系，本文来解开这个谜题~

{% asset_img 1.webp %}

***

<!--more-->

### 并发

**并发**是一个比较宽泛的概念，它单纯代表计算机能够同时执行多项任务

{% asset_img 2.webp %}

至于计算机怎么做到“并发”则有许多不同的形式

{% asset_img 3.webp %}

比如对于一个单核处理器，计算机可以通过分配时间片的方式，让一个任务执行一段时间，然后切换到另外一个任务再运行一段时间。

不同的任务会这样交替往复的一直执行下去，这个过程也被称作是进程或者线程的上下文切换（context switching）

***

### 并行

当然对于多核处理器，情况就有所不同了

{% asset_img 4.webp %}

我们可以在不同的核心上真正并行地执行任务，而不用通过分配时间片的方式运行，这种情况也就是我们所说的并行（parallelism）

***

### 同步&异步

至于同步和异步则是两种不同的编程模型。

**同步（Synchronous）**代表需要等到必须前一个任务执行完毕之后，才能进行下一个任务

{% asset_img 5.webp %}

因此在同步中并没有并发或者并行的概念。

而**异步（Asynchronous）**则代表不同的任务之间并不会相互等待

{% asset_img 6.webp %}

也就是说，你在执行任务A的时候，也可以同时运行任务B

一个典型实现异步的方式则是通过多线程编程，你可以创建多个线程并且启动它们

{% asset_img 7.webp %}

在多核的环境下，每个线程就会被分配到独立的核心上运行，实现真正的“并行”

当然如果你使用的是多核心处理器，或者设置亲和力（Affinity）强制将线程绑定到某个核心上

{% asset_img 8.webp %}

操作系统则会通过分配时间片的方式来执行这些线程

{% asset_img 9.webp %}

不过这些线程依然是在“并发”地执行

当然像某些编程语言，比如JavaScript本身是没有多线程的概念。不过通过它的函数回调（function callback）机制，我们依然能够做到单线程的“并发”

{% asset_img 10.webp %}

比如你可以通过fetch()同时访问多个网络资源。我们在调用fetch()函数的时候，程序并不会等待，而会直接继续执行下去。当获取到网络资源后，回调函数才会被调起。

{% asset_img 11.webp %}

虽然主程序和回调函数看起来是同时进行的，但它们依然是运行在同一个线程中。因此通过这种异步编程方式，我们完全能够做到单线程的“并发”，而且这不是JavaScript的专利，很多语言也都提供了原生的异步编程方式，比如C#的async Task和await、Rust的async、C++20中的co_await、Python中的asyncio等等

***

### 多线程编程&（单线程）异步编程

那么多线程编程和这种单线程的异步编程，我们应当如何选择呢？

{% asset_img 12.webp %}

{% asset_img 13.webp %}

简而言之，对于I/O密集的应用程序，比如Web应用就会经常执行网络操作、数据库访问，这类应用就非常适合使用异步编程的方式。反之如果我们使用多线程的方式，则会浪费不少的系统资源，因为每个线程的绝大多数时间都是在等待这些I/O操作，而线程自身会占用额外的内存，线程的切换也会有额外的开销，更不用说线程之间的资源竞争问题。

{% asset_img 14.webp %}

而多线程编程则非常适合于计算量密集的应用，比如视频图像处理，科学计算等等，它能让每一个CPU核心发挥最大的功效，而不是消耗在空闲的等待上

***

### 参考与鸣谢

> <https://www.bilibili.com/video/BV17V411e7Ua>

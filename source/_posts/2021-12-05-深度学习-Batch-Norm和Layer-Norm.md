---
title: æ·±åº¦å­¦ä¹ -Batch Normå’ŒLayer Norm
categories:
  - ğŸŒ™è¿›é˜¶å­¦ä¹ 
  - â­äººå·¥æ™ºèƒ½
  - ğŸ’«æ·±åº¦å­¦ä¹ 
abbrlink: 5a7353d9
date: 2021-12-05 22:09:14
tags:
---

{% asset_img 4.png %}

å‰é˜µå­è¯»äº†Transformerçš„è®ºæ–‡ï¼Œå‘ç°è‡ªå·±å¯¹BNå’ŒLNå¹¶ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œæ•…åšä¼—å®¶æ‰€é•¿ä½œæ­¤æ–‡ã€‚

<!--more-->

***

### Normalization

ç”±äº ICS é—®é¢˜çš„å­˜åœ¨ï¼Œx çš„åˆ†å¸ƒå¯èƒ½ç›¸å·®å¾ˆå¤§ã€‚è¦è§£å†³ç‹¬ç«‹åŒåˆ†å¸ƒçš„é—®é¢˜ï¼Œâ€œç†è®ºæ­£ç¡®â€çš„æ–¹æ³•å°±æ˜¯å¯¹æ¯ä¸€å±‚çš„æ•°æ®éƒ½è¿›è¡Œ**ç™½åŒ–æ“ä½œ**ã€‚ç„¶è€Œæ ‡å‡†çš„ç™½åŒ–æ“ä½œä»£ä»·é«˜æ˜‚ï¼Œä¸”ä¸å¯å¾®ä¸åˆ©äºåå‘ä¼ æ’­æ›´æ–°æ¢¯åº¦ã€‚å› æ­¤ï¼Œä»¥ BN ä¸ºä»£è¡¨çš„ Normalization æ–¹æ³•é€€è€Œæ±‚å…¶æ¬¡ï¼Œè¿›è¡Œäº†ç®€åŒ–çš„ç™½åŒ–æ“ä½œã€‚

ï¼ˆç™½åŒ–æ˜¯ä¸€ä¸ªæ¯”PCAç¨å¾®é«˜çº§ä¸€ç‚¹çš„ç®—æ³•ï¼Œç›®çš„æ˜¯é™ä½è¾“å…¥çš„å†—ä½™æ€§ï¼Œè¾“å…¥æ•°æ®é›†Xï¼Œç»è¿‡ç™½åŒ–å¤„ç†åï¼Œæ–°çš„æ•°æ®X'æ»¡è¶³ä¸¤ä¸ªæ€§è´¨ï¼šç‰¹å¾ä¹‹é—´ç›¸å…³æ€§è¾ƒä½ï¼Œæ‰€æœ‰ç‰¹å¾å…·æœ‰ç›¸åŒçš„æ–¹å·®ï¼‰

åŸºæœ¬æ€æƒ³æ˜¯ï¼šåœ¨å°† x é€ç»™ç¥ç»å…ƒä¹‹å‰ï¼Œå…ˆå¯¹å…¶åšå¹³ç§»å’Œä¼¸ç¼©å˜æ¢ï¼Œ å°† x çš„åˆ†å¸ƒè§„èŒƒåŒ–æˆåœ¨å›ºå®šåŒºé—´èŒƒå›´çš„æ ‡å‡†åˆ†å¸ƒã€‚

***

### æ·±åº¦å­¦ä¹ ä¸­çš„ICSé—®é¢˜

covariate shift æ˜¯åˆ†å¸ƒä¸ä¸€è‡´å‡è®¾ä¹‹ä¸‹çš„ä¸€ä¸ªåˆ†æ”¯é—®é¢˜ï¼Œå®ƒæ˜¯æŒ‡æºç©ºé—´å’Œç›®æ ‡ç©ºé—´çš„æ¡ä»¶æ¦‚ç‡æ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯å…¶è¾¹ç¼˜æ¦‚ç‡ä¸åŒã€‚

è€Œç»Ÿè®¡æœºå™¨å­¦ä¹ ä¸­çš„ä¸€ä¸ªç»å…¸å‡è®¾æ˜¯ â€œæºç©ºé—´ï¼ˆsource domainï¼‰å’Œç›®æ ‡ç©ºé—´ï¼ˆtarget domainï¼‰çš„æ•°æ®åˆ†å¸ƒï¼ˆdistributionï¼‰æ˜¯ä¸€è‡´çš„â€ã€‚

#### å‰è¨€

åœ¨ä¸€ä¸ªç½‘ç»œä¸­, å¦‚æœè®­ç»ƒæ•°æ®çš„åˆ†å¸ƒåŒæµ‹è¯•æ•°æ®æ—¶, **è®­ç»ƒæœ€æœ‰æ•ˆç‡**, å› ä¸ºæ­¤æ—¶æ ¹æ®è®­ç»ƒæ•°æ®è®¡ç®—å‡ºçš„æ¢¯åº¦æœ€æ¥è¿‘çœŸå®çš„æ¢¯åº¦, å› æ­¤ä½¿ç”¨æ­¤æ¢¯åº¦å¯¹å‚æ•°è¿›è¡Œä¼˜åŒ–æœ€é«˜æ•ˆã€‚

#### æ¨ç†

ç¥ç»ç½‘ç»œçš„ç›®çš„å°±æ˜¯è¾“å…¥ä¸€æ‰¹æ•°æ®, æ ¹æ®è¿™æ‰¹æ•°æ®çš„åˆ†å¸ƒ, é¢„æµ‹çœŸå®æ•°æ®çš„åˆ†å¸ƒ, æˆ‘ä»¬ä¸€èˆ¬å°†è¿™é‡Œçš„æ•°æ®æ•°æ®ç§°ä¹‹ä¸ºè®­ç»ƒæ•°æ®ã€‚

å¦‚æœæŠŠç¬¬ä¸€å±‚, ä¹Ÿå°±æ˜¯æœ€åº•å±‚ç½‘ç»œå»æ‰, å‰©ä¸‹çš„ç½‘ç»œç§°ä¹‹ä¸º**å­ç½‘ç»œ**, é‚£ä¹ˆ**å­ç½‘ç»œ**çš„ç›®çš„ä¸åŸç½‘ç»œç›¸åŒ, åŒæ ·æ˜¯è¾“å…¥ä¸€æ‰¹æ•°æ®, æ ¹æ®è¿™æ‰¹æ•°æ®çš„åˆ†å¸ƒ, é¢„æµ‹çœŸå®æ•°æ®çš„åˆ†å¸ƒ, **è€Œè¿™é‡Œçš„è¾“å…¥æ•°æ®å°±æ˜¯è®­ç»ƒæ•°æ®ç»è¿‡ç¬¬ä¸€å±‚ç½‘ç»œåçš„è¾“å‡ºæ•°æ®**, æ­¤æ—¶ç›®çš„ä¸å˜, é‚£ä¹ˆåŒæ ·é€‚ç”¨ä¸Šé¢é‚£ä¸ªåŸåˆ™, å³è¾“å…¥æ•°æ®çš„åˆ†å¸ƒäºæµ‹è¯•æ•°æ®çš„åˆ†å¸ƒè¶Šæ¥è¿‘, é‚£ä¹ˆè¯¥ç½‘ç»œçš„ä¼˜åŒ–è¶Šé«˜æ•ˆ. ä¾æ­¤ç±»æ¨, è¿™ä¸ªç»“è®ºé€‚ç”¨äºä»»ä½•å±‚æ¬¡çš„å­ç½‘ç»œã€‚

#### ç»“è®º

å› æ­¤, æˆ‘ä»¬å°±åº”å½“è€ƒè™‘è¿™æ ·ä¸€ä¸ªé—®é¢˜, è¦å°½é‡ä¿è¯æ•°æ®åœ¨ç»è¿‡æ¯ä¸€å±‚ç½‘ç»œæ—¶, å…¶åˆ†å¸ƒä¿æŒä¸å˜, ä¹Ÿå°±æ˜¯æ•°æ®åœ¨è¾“å…¥æ¯ä¸€å±‚ç½‘ç»œä¹‹å‰, **å…¶åˆ†å¸ƒéƒ½ä¸æµ‹è¯•æ•°æ®æ¥è¿‘**, é‚£ä¹ˆå¯ä»¥ä½¿å¾—æ•´ä¸ªç½‘ç»œçš„è®­ç»ƒæ˜¯é«˜æ•ˆçš„ã€‚

ICSé—®é¢˜(internal covariate shift), å°±æ˜¯è¯´å¦‚æœè®­ç»ƒæ•°æ®åœ¨ç»è¿‡ç½‘ç»œçš„æ¯ä¸€å±‚åå…¶åˆ†å¸ƒéƒ½**å‘ç”Ÿäº†å˜åŒ–**, é€šè¿‡ä¸Šè¿°è®ºè¯å¯çŸ¥, æ­¤æ—¶å°±ä¸èƒ½ä¿è¯æ•´ä¸ªç½‘ç»œçš„ä¼˜åŒ–è¿‡ç¨‹æ˜¯é«˜æ•ˆçš„, ç”šè‡³è¯´ä¼šæå¤§åœ°é™ä½ç½‘ç»œçš„ä¼˜åŒ–æ•ˆç‡ã€‚

#### ICSå¯¼è‡´çš„é—®é¢˜

æ¯ä¸ªç¥ç»å…ƒçš„è¾“å…¥æ•°æ®ä¸å†æ˜¯ â€œç‹¬ç«‹åŒåˆ†å¸ƒâ€ã€‚
1. ä¸Šå±‚å‚æ•°éœ€è¦ä¸æ–­é€‚åº”æ–°çš„è¾“å…¥æ•°æ®åˆ†å¸ƒï¼Œé™ä½å­¦ä¹ é€Ÿåº¦ã€‚
2. ä¸‹å±‚è¾“å…¥çš„å˜åŒ–å¯èƒ½è¶‹å‘äºå˜å¤§æˆ–è€…å˜å°ï¼Œå¯¼è‡´ä¸Šå±‚è½å…¥é¥±å’ŒåŒºï¼Œä½¿å¾—å­¦ä¹ è¿‡æ—©åœæ­¢ã€‚
3. æ¯å±‚çš„æ›´æ–°éƒ½ä¼šå½±å“åˆ°å…¶å®ƒå±‚ï¼Œå› æ­¤æ¯å±‚çš„å‚æ•°æ›´æ–°ç­–ç•¥éœ€è¦å°½å¯èƒ½çš„è°¨æ…ã€‚

***

### é€šç”¨å˜æ¢æ¡†æ¶

{% asset_img 1.webp %}

æœ€ç»ˆå¾—åˆ°çš„æ•°æ®ç¬¦åˆå‡å€¼ä¸º b ã€æ–¹å·®ä¸º g^2 çš„åˆ†å¸ƒã€‚

#### ä¸ºä»€ä¹ˆè¦å†å¹³ç§»å†ç¼©æ”¾

ä¸ºäº†ä¿è¯æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ä¸å› ä¸ºè§„èŒƒåŒ–è€Œä¸‹é™ã€‚

ç¬¬ä¸€æ­¥çš„è§„èŒƒåŒ–ä¼šå°†å‡ ä¹æ‰€æœ‰æ•°æ®æ˜ å°„åˆ°æ¿€æ´»å‡½æ•°çš„éé¥±å’ŒåŒºï¼ˆçº¿æ€§åŒºï¼‰ï¼Œä»…åˆ©ç”¨åˆ°äº†çº¿æ€§å˜åŒ–èƒ½åŠ›ï¼Œä»è€Œé™ä½äº†ç¥ç»ç½‘ç»œçš„è¡¨è¾¾èƒ½åŠ›ã€‚è€Œè¿›è¡Œå†å˜æ¢ï¼Œåˆ™å¯ä»¥å°†æ•°æ®ä»çº¿æ€§åŒºå˜æ¢åˆ°éçº¿æ€§åŒºï¼Œæ¢å¤æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚

#### å¹³ç§»å‚æ•°å’Œå†å¹³ç§»å‚æ•°çš„åŒºåˆ«

å¹³ç§»å‚æ•°ï¼Œx çš„å‡å€¼å–å†³äºä¸‹å±‚ç¥ç»ç½‘ç»œçš„å¤æ‚å…³è”ã€‚

ä½†å†å¹³ç§»å‚æ•°ä¸­ï¼Œå»é™¤äº†ä¸ä¸‹å±‚è®¡ç®—çš„å¯†åˆ‡è€¦åˆã€‚æ–°å‚æ•°å¾ˆå®¹æ˜“é€šè¿‡æ¢¯åº¦ä¸‹é™æ¥å­¦ä¹ ï¼Œç®€åŒ–äº†ç¥ç»ç½‘ç»œçš„è®­ç»ƒã€‚

***

### Batch Norm

**æ¯ä¸€batchçš„æ ·æœ¬å…·æœ‰ç›¸åŒçš„å‡å€¼å’Œæ–¹å·®**

BNåœ¨batchç»´åº¦çš„å½’ä¸€åŒ–ï¼Œä¹Ÿå°±æ˜¯å¯¹äºæ¯ä¸ªbatchï¼Œè¯¥å±‚ç›¸åº”çš„outputä½ç½®å½’ä¸€åŒ–æ‰€ä½¿ç”¨çš„meanå’Œvarianceéƒ½æ˜¯ä¸€æ ·çš„ã€‚

BNçš„å­¦ä¹ å‚æ•°åŒ…å«rescaleå’Œshiftä¸¤ä¸ªå‚æ•°ã€‚
1. BNåœ¨å•ç‹¬çš„å±‚çº§ä¹‹é—´ä½¿ç”¨æ¯”è¾ƒæ–¹ä¾¿ï¼Œæ¯”å¦‚CNNã€‚å¾—åƒRNNè¿™æ ·å±‚æ•°ä¸å®šï¼Œç›´æ¥ç”¨BNä¸å¤ªæ–¹ä¾¿ï¼Œéœ€è¦å¯¹æ¯ä¸€å±‚ï¼ˆæ¯ä¸ªtime stepï¼‰åšBNï¼Œå¹¶ä¿ç•™æ¯ä¸€å±‚çš„meanå’Œvarianceã€‚ä¸è¿‡ç”±äºRNNè¾“å…¥ä¸å®šé•¿ï¼ˆtime stepé•¿åº¦ä¸å®šï¼‰ï¼Œå¯èƒ½ä¼šæœ‰validationæˆ–testçš„time stepæ¯”train seté‡Œé¢çš„ä»»ä½•æ•°æ®éƒ½é•¿ï¼Œå› æ­¤ä¼šé€ æˆmeanå’Œvarianceä¸å­˜åœ¨çš„æƒ…å†µã€‚
2. BNä¼šå¼•å…¥å™ªå£°ï¼ˆå› ä¸ºæ˜¯mini batchè€Œä¸æ˜¯æ•´ä¸ªtraining setï¼‰ï¼Œæ‰€ä»¥å¯¹äºå™ªå£°æ•æ„Ÿçš„æ–¹æ³•ï¼ˆå¦‚RLï¼‰ä¸å¤ªé€‚ç”¨ã€‚

æˆ‘ä»¬åœ¨å¯¹æ•°æ®è®­ç»ƒä¹‹å‰ä¼šå¯¹æ•°æ®é›†è¿›è¡Œå½’ä¸€åŒ–ï¼Œå½’ä¸€åŒ–çš„ç›®çš„å½’ä¸€åŒ–çš„ç›®çš„å°±æ˜¯ä½¿å¾—é¢„å¤„ç†çš„æ•°æ®è¢«é™å®šåœ¨ä¸€å®šçš„èŒƒå›´å†…ï¼ˆæ¯”å¦‚[0, 1]æˆ–è€…[-1, 1]ï¼‰ï¼Œä»è€Œæ¶ˆé™¤å¥‡å¼‚æ ·æœ¬æ•°æ®å¯¼è‡´çš„ä¸è‰¯å½±å“ã€‚**è™½ç„¶è¾“å…¥å±‚çš„æ•°æ®ï¼Œå·²ç»å½’ä¸€åŒ–ï¼Œåé¢ç½‘ç»œæ¯ä¸€å±‚çš„è¾“å…¥æ•°æ®çš„åˆ†å¸ƒä¸€ç›´åœ¨å‘ç”Ÿå˜åŒ–ï¼Œå‰é¢å±‚è®­ç»ƒå‚æ•°çš„æ›´æ–°å°†å¯¼è‡´åé¢å±‚è¾“å…¥æ•°æ®åˆ†å¸ƒçš„å˜åŒ–ï¼Œå¿…ç„¶ä¼šå¼•èµ·åé¢æ¯ä¸€å±‚è¾“å…¥æ•°æ®åˆ†å¸ƒçš„æ”¹å˜ã€‚è€Œä¸”ï¼Œç½‘ç»œå‰é¢å‡ å±‚å¾®å°çš„æ”¹å˜ï¼Œåé¢å‡ å±‚å°±ä¼šé€æ­¥æŠŠè¿™ç§æ”¹å˜ç´¯ç§¯æ”¾å¤§ã€‚**è®­ç»ƒè¿‡ç¨‹ä¸­ç½‘ç»œä¸­é—´å±‚æ•°æ®åˆ†å¸ƒçš„æ”¹å˜ç§°ä¹‹ä¸ºï¼šâ€œInternal Covariate Shiftâ€ï¼ˆICSï¼‰ã€‚

**BN**çš„æå‡ºï¼Œå°±æ˜¯è¦**è§£å†³åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¸­é—´å±‚æ•°æ®åˆ†å¸ƒå‘ç”Ÿæ”¹å˜çš„æƒ…å†µ**ã€‚æ‰€ä»¥å°±å¼•å…¥äº†BNçš„æ¦‚å¿µï¼Œæ¥æ¶ˆé™¤è¿™ç§å½±å“ã€‚æ‰€ä»¥åœ¨æ¯æ¬¡ä¼ å…¥ç½‘ç»œçš„æ•°æ®æ¯ä¸€å±‚çš„ç½‘ç»œéƒ½è¿›è¡Œä¸€æ¬¡BNï¼Œå°†æ•°æ®æ‹‰å›æ­£æ€åˆ†å¸ƒï¼Œè¿™æ ·åšä½¿å¾—æ•°æ®åˆ†å¸ƒä¸€è‡´ä¸”é¿å…äº†æ¢¯åº¦æ¶ˆå¤±ã€‚

æ­¤å¤–ï¼Œinternal corvariate shiftå’Œcovariate shiftæ˜¯ä¸¤å›äº‹ï¼Œå‰è€…æ˜¯ç½‘ç»œå†…éƒ¨ï¼Œåè€…æ˜¯é’ˆå¯¹è¾“å…¥æ•°æ®ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨è®­ç»ƒæ•°æ®å‰åšå½’ä¸€åŒ–ç­‰é¢„å¤„ç†æ“ä½œã€‚

éœ€è¦æ³¨æ„çš„æ˜¯**åœ¨ä½¿ç”¨å°batch-sizeæ—¶BNä¼šç ´åæ€§èƒ½**ï¼Œå½“å…·æœ‰åˆ†å¸ƒæä¸å¹³è¡¡äºŒåˆ†ç±»ä»»åŠ¡æ—¶ä¹Ÿä¼šå‡ºç°ä¸å¥½çš„ç»“æœã€‚å› ä¸ºå¦‚æœå°çš„batch-sizeå½’ä¸€åŒ–çš„åŸå› ï¼Œä½¿å¾—åŸæœ¬çš„æ•°æ®çš„å‡å€¼å’Œæ–¹å·®åç¦»åŸå§‹æ•°æ®ï¼Œå‡å€¼å’Œæ–¹å·®ä¸è¶³ä»¥ä»£æ›¿æ•´ä¸ªæ•°æ®åˆ†å¸ƒã€‚åˆ†å¸ƒä¸å‡çš„åˆ†ç±»ä»»åŠ¡ä¹Ÿä¼šå‡ºç°è¿™ç§æƒ…å†µï¼

BNå®é™…ä½¿ç”¨æ—¶éœ€è¦è®¡ç®—å¹¶ä¸”ä¿å­˜æŸä¸€å±‚ç¥ç»ç½‘ç»œbatchçš„å‡å€¼å’Œæ–¹å·®ç­‰ç»Ÿè®¡ä¿¡æ¯ï¼Œå¯¹äºå¯¹ä¸€ä¸ªå›ºå®šæ·±åº¦çš„å‰å‘ç¥ç»ç½‘ç»œï¼ˆDNNï¼ŒCNNï¼‰ä½¿ç”¨BNï¼Œå¾ˆæ–¹ä¾¿ï¼›ä½†å¯¹äºRNNæ¥è¯´ï¼Œsequenceçš„é•¿åº¦æ˜¯ä¸ä¸€è‡´çš„ï¼Œæ¢å¥è¯è¯´RNNçš„æ·±åº¦ä¸æ˜¯å›ºå®šçš„ï¼Œä¸åŒçš„time-stepéœ€è¦ä¿å­˜ä¸åŒçš„staticsç‰¹å¾ï¼Œå¯èƒ½å­˜åœ¨ä¸€ä¸ªç‰¹æ®Šsequenceæ¯”å…¶ä»–sequenceé•¿å¾ˆå¤šï¼Œè¿™æ ·trainingæ—¶ï¼Œè®¡ç®—å¾ˆéº»çƒ¦ã€‚

{% asset_img 5.png %}

{% asset_img 6.png %}

{% asset_img 7.png %}

***

### Layer Norm

**æ¯ä¸€ä¸ªç¥ç»å…ƒæœ‰ç›¸åŒçš„å‡å€¼å’Œæ–¹å·®ï¼Œæ¯ä¸ªæ ·æœ¬çš„å‡å€¼å’Œæ–¹å·®ä¸åŒ**

LayerNormå®é™…å°±æ˜¯å¯¹éšå«å±‚åšå±‚å½’ä¸€åŒ–ï¼Œå³å¯¹æŸä¸€å±‚çš„æ‰€æœ‰ç¥ç»å…ƒçš„è¾“å…¥è¿›è¡Œå½’ä¸€åŒ–ã€‚ï¼ˆæ¯hidden_sizeä¸ªæ•°æ±‚å¹³å‡/æ–¹å·®ï¼‰

1. å®ƒåœ¨trainingå’Œinferenceæ—¶æ²¡æœ‰åŒºåˆ«ï¼Œåªéœ€è¦å¯¹å½“å‰éšè—å±‚è®¡ç®—mean and varianceå°±è¡Œã€‚ä¸éœ€è¦ä¿å­˜æ¯å±‚çš„moving average mean and varianceã€‚
2. ä¸å—batch sizeçš„é™åˆ¶ï¼Œå¯ä»¥é€šè¿‡online learningçš„æ–¹å¼ä¸€æ¡ä¸€æ¡çš„è¾“å…¥è®­ç»ƒæ•°æ®ã€‚
3. LNå¯ä»¥æ–¹ä¾¿çš„åœ¨RNNä¸­ä½¿ç”¨ã€‚
4. LNå¢åŠ äº†gainå’Œbiasä½œä¸ºå­¦ä¹ çš„å‚æ•°ã€‚

ä¸BNä¸åŒçš„æ˜¯ï¼ŒLNå¯¹æ¯ä¸€å±‚çš„æ‰€æœ‰ç¥ç»å…ƒè¿›è¡Œå½’ä¸€åŒ–ï¼Œä¸BNä¸åŒçš„æ˜¯ï¼š
1. LN ä¸­åŒå±‚ç¥ç»å…ƒè¾“å…¥æ‹¥æœ‰ç›¸åŒçš„å‡å€¼å’Œæ–¹å·®ï¼Œä¸åŒçš„è¾“å…¥æ ·æœ¬æœ‰ä¸åŒçš„å‡å€¼å’Œæ–¹å·®ï¼›
2. BN ä¸­åˆ™é’ˆå¯¹ä¸åŒç¥ç»å…ƒè¾“å…¥è®¡ç®—å‡å€¼å’Œæ–¹å·®ï¼ŒåŒä¸€ä¸ªbatchä¸­çš„è¾“å…¥æ‹¥æœ‰ç›¸åŒçš„å‡å€¼å’Œæ–¹å·®ã€‚
3. LNä¸ä¾èµ–äºbatchçš„å¤§å°å’Œè¾“å…¥sequenceçš„æ·±åº¦ï¼Œå› æ­¤å¯ä»¥ç”¨äºbatchsizeä¸º1å’ŒRNNä¸­å¯¹è¾¹é•¿çš„è¾“å…¥sequenceçš„normalizeæ“ä½œã€‚

ä¸€èˆ¬æƒ…å†µï¼ŒLNå¸¸å¸¸ç”¨äºRNNç½‘ç»œï¼æŠŠä¸€ä¸ª batch çš„ feature ç±»æ¯”ä¸ºä¸€æ‘ä¹¦ï¼ŒLN æ±‚å‡å€¼æ—¶ï¼Œç›¸å½“äºæŠŠæ¯ä¸€æœ¬ä¹¦çš„æ‰€æœ‰å­—åŠ èµ·æ¥ï¼Œå†é™¤ä»¥è¿™æœ¬ä¹¦çš„å­—ç¬¦æ€»æ•°ï¼šCÃ—HÃ—Wï¼Œå³æ±‚æ•´æœ¬ä¹¦çš„â€œå¹³å‡å­—â€ï¼Œæ±‚æ ‡å‡†å·®æ—¶ä¹Ÿæ˜¯åŒç†ã€‚

Layer Norm
{% asset_img 2.webp %}

Layer Normæ±‚å‡å€¼æ–¹å·®
{% asset_img 3.webp %}

Bert layer normå®ç°ä»£ç 

``` python
class LayerNorm(nn.Module):
    "Construct a layernorm module (See citation for details)."
    def __init__(self, features, eps=1e-6):
        super(LayerNorm, self).__init__()
        self.a_2 = nn.Parameter(torch.ones(features))
        self.b_2 = nn.Parameter(torch.zeros(features))
        self.eps = eps

    def forward(self, x):
        # mean(-1) è¡¨ç¤º mean(len(x)), è¿™é‡Œçš„-1å°±æ˜¯æœ€åä¸€ä¸ªç»´åº¦ï¼Œä¹Ÿå°±æ˜¯hidden_sizeç»´
        mean = x.mean(-1, keepdim=True)
        std = x.std(-1, keepdim=True)
        return self.a_2 * (x - mean) / (std + self.eps) + self.b_2
```

***

### æ€»ç»“

Batch Normalization çš„å¤„ç†å¯¹è±¡æ˜¯å¯¹ä¸€æ‰¹æ ·æœ¬ï¼Œ Layer Normalization çš„å¤„ç†å¯¹è±¡æ˜¯å•ä¸ªæ ·æœ¬ã€‚Batch Normalization æ˜¯å¯¹è¿™æ‰¹æ ·æœ¬çš„åŒä¸€ç»´åº¦ç‰¹å¾åšå½’ä¸€åŒ–ï¼Œ Layer Normalization æ˜¯å¯¹è¿™å•ä¸ªæ ·æœ¬çš„æ‰€æœ‰ç»´åº¦ç‰¹å¾åšå½’ä¸€åŒ–ã€‚

{% asset_img 8.jpg %}

BNã€LNå¯ä»¥çœ‹ä½œæ¨ªå‘å’Œçºµå‘çš„åŒºåˆ«ã€‚

ç»è¿‡å½’ä¸€åŒ–å†è¾“å…¥æ¿€æ´»å‡½æ•°ï¼Œå¾—åˆ°çš„å€¼å¤§éƒ¨åˆ†ä¼šè½å…¥éçº¿æ€§å‡½æ•°çš„çº¿æ€§åŒºï¼Œå¯¼æ•°è¿œç¦»å¯¼æ•°é¥±å’ŒåŒºï¼Œé¿å…äº†æ¢¯åº¦æ¶ˆå¤±ï¼Œè¿™æ ·æ¥åŠ é€Ÿè®­ç»ƒæ”¶æ•›è¿‡ç¨‹ã€‚BatchNormè¿™ç±»å½’ä¸€åŒ–æŠ€æœ¯ï¼Œç›®çš„å°±æ˜¯è®©æ¯ä¸€å±‚çš„åˆ†å¸ƒç¨³å®šä¸‹æ¥ï¼Œè®©åé¢çš„å±‚å¯ä»¥åœ¨å‰é¢å±‚çš„åŸºç¡€ä¸Šå®‰å¿ƒå­¦ä¹ çŸ¥è¯†ã€‚

BatchNormå°±æ˜¯é€šè¿‡å¯¹batch sizeè¿™ä¸ªç»´åº¦å½’ä¸€åŒ–æ¥è®©åˆ†å¸ƒç¨³å®šä¸‹æ¥ã€‚LayerNormåˆ™æ˜¯é€šè¿‡å¯¹Hidden sizeè¿™ä¸ªç»´åº¦å½’ä¸€ã€‚

**ï¼ˆCVé¢†åŸŸï¼‰**ï¼Œå¦‚æœä½ çš„ç‰¹å¾ä¾èµ–äºä¸åŒæ ·æœ¬é—´çš„ç»Ÿè®¡å‚æ•°ï¼Œé‚£BNæ›´æœ‰æ•ˆã€‚å› ä¸ºå®ƒæŠ¹æ€äº†ä¸åŒç‰¹å¾ä¹‹é—´çš„å¤§å°å…³ç³»ï¼Œä½†æ˜¯ä¿ç•™äº†ä¸åŒæ ·æœ¬é—´çš„å¤§å°å…³ç³»ã€‚
**ï¼ˆNLPé¢†åŸŸï¼‰**ï¼ŒLNå°±æ›´åŠ åˆé€‚ã€‚å› ä¸ºå®ƒæŠ¹æ€äº†ä¸åŒæ ·æœ¬é—´çš„å¤§å°å…³ç³»ï¼Œä½†æ˜¯ä¿ç•™äº†ä¸€ä¸ªæ ·æœ¬å†…ä¸åŒç‰¹å¾ä¹‹é—´çš„å¤§å°å…³ç³»ã€‚å¯¹äºNLPæˆ–è€…åºåˆ—ä»»åŠ¡æ¥è¯´ï¼Œä¸€æ¡æ ·æœ¬çš„ä¸åŒç‰¹å¾ï¼Œå…¶å®å°±æ˜¯æ—¶åºä¸Šå­—ç¬¦å–å€¼çš„å˜åŒ–ï¼Œæ ·æœ¬å†…çš„ç‰¹å¾å…³ç³»æ˜¯éå¸¸ç´§å¯†çš„ã€‚

***

### å‚è€ƒèµ„æ–™

> <https://www.jianshu.com/p/cb8769fd0c41>
> <https://www.jianshu.com/p/91b54246b51c>
> <https://blog.csdn.net/MissingDi/article/details/106155394>
> <https://zhuanlan.zhihu.com/p/113233908>
> <https://zhuanlan.zhihu.com/p/428620330>

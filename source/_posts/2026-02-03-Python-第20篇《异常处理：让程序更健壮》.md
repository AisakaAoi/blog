---
title: Python-ç¬¬20ç¯‡ã€Šå¼‚å¸¸å¤„ç†ï¼šè®©ç¨‹åºæ›´å¥å£®ã€‹
categories:
  - ğŸŒ™é€¢å‚æ‚è°ˆä¸æ¬è¿
  - â­æœæœè¯¾ç¨‹
abbrlink: 43bb98e4
date: 2026-02-03 04:28:09
tags:
---

### å¯¼è¯­

â€œå®¹é”™â€çš„é‡è¦æ€§ï¼â€”â€”æŠ¥é”€å•å†™é”™é‡‘é¢è¦é€€å›é‡å¡«ï¼ŒæŠ¥è¡¨æ•°æ®å¼‚å¸¸è¦æ ‡çº¢æé†’ã€‚ç¨‹åºä¹Ÿä¸€æ ·ï¼Œç”¨æˆ·è¾“å…¥â€œabcâ€å½“å·¥èµ„ã€é™¤æ•°ä¸ºé›¶ã€æ–‡ä»¶æ‰¾ä¸åˆ°...å¦‚æœä¸ç®¡è¿™äº›ï¼Œç¨‹åºå°±ä¼šå´©æºƒç½¢å·¥ã€‚ä»Šå¤©å’±ä»¬ç»™ä»£ç è£…ä¸Šâ€œå®‰å…¨æ°”å›Šâ€ï¼Œè®©å®ƒé‡åˆ°é”™è¯¯èƒ½ä¼˜é›…å¤„ç†ï¼Œç»§ç»­è¿è¡Œã€‚æ¯•ç«Ÿï¼Œä¸€ä¸ªæˆç†Ÿçš„ç¨‹åºï¼Œåº”è¯¥å­¦ä¼šè‡ªå·±å¤„ç†å¼‚å¸¸ï¼

<!--more-->

***

### æœ¬ç¯‡ç›®æ ‡

- ç†è§£é”™è¯¯å’Œå¼‚å¸¸çš„åŒºåˆ«
- æŒæ¡`try/except`æ•è·é”™è¯¯
- å­¦ä¼šæ•°æ®éªŒè¯å’Œå®‰å…¨è¾“å…¥
- æ„å»ºèƒ½é˜²â€œæ‰‹æ»‘â€çš„è´¢åŠ¡è®¡ç®—å™¨
- è®©ç¨‹åºä»â€œä¸€é”™å°±æŒ‚â€åˆ°â€œç™¾æŠ˜ä¸æŒ â€

***

### ä¸€ã€å‡†å¤‡å·¥ä½œï¼šæ— éœ€å®‰è£…

å¼‚å¸¸å¤„ç†æ˜¯Pythonå†…ç½®åŠŸèƒ½ï¼Œä¸éœ€è¦é¢å¤–å®‰è£…åº“ï¼Œç›´æ¥å¼€å¹²ï¼š

```python
# çº¯Pythonï¼Œæ— éœ€å®‰è£…
import json
from datetime import datetime
import os
```

***

### äºŒã€é”™è¯¯ vs å¼‚å¸¸ï¼šå…ˆææ¸…æ¥šæ¦‚å¿µ

#### 2.1 è¯­æ³•é”™è¯¯ï¼ˆSyntax Errorï¼‰

å°±åƒæŠ¥é”€å•æ ¼å¼å†™é”™äº†ï¼Œç³»ç»Ÿç›´æ¥æ‹’æ”¶ã€‚

```python
# è¿™æ˜¯è¯­æ³•é”™è¯¯ï¼Œç¨‹åºæ ¹æœ¬è·‘ä¸èµ·æ¥
# print("hello"  # ç¼ºå°‘å³æ‹¬å·

# if a > b  # ç¼ºå°‘å†’å·
#     print("aæ›´å¤§")
```

**ç‰¹ç‚¹**ï¼šä»£ç å†™é”™äº†ï¼ŒPythonè§£é‡Šå™¨ç›´æ¥æŠ¥é”™ï¼Œç¨‹åºæ— æ³•è¿è¡Œã€‚

***

### 2.2 è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆExceptionï¼‰

å°±åƒæŠ¥é”€å•æ ¼å¼å¯¹äº†ï¼Œä½†é‡‘é¢å†™æˆäº†â€œä¸‰ä¸‡â€è€Œä¸æ˜¯æ•°å­—ï¼Œç³»ç»Ÿèƒ½è¯†åˆ«ä½†å¤„ç†ä¸äº†ã€‚

```python
# è¿™æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ï¼Œç¨‹åºè·‘åˆ°è¿™é‡Œæ‰å‡ºé—®é¢˜

# 1. é™¤é›¶é”™è¯¯
# result = 100 / 0  # ZeroDivisionError: division by zero

# 2. ç±»å‹é”™è¯¯
# "å·¥èµ„: " + 15000  # TypeError: can only concatenate str (not "int") to str

# 3. å€¼é”™è¯¯
# int("abc")  # ValueError: invalid literal for int() with base 10: 'abc'
```

**ç‰¹ç‚¹**ï¼šè¯­æ³•æ²¡é—®é¢˜ï¼Œä½†è¿è¡Œæ—¶é€»è¾‘å‡ºé”™ï¼Œç¨‹åºä¼šåœ¨è¿™é‡Œå´©æºƒã€‚

***

### ä¸‰ã€try/exceptï¼šç»™ä»£ç è£…ä¸Šâ€œå®‰å…¨æ°”å›Šâ€

#### 3.1 åŸºæœ¬ç”¨æ³•

```python
# ========== åŸºç¡€å¼‚å¸¸æ•è· ==========
def safe_divide(a, b):
    """
    å®‰å…¨çš„é™¤æ³•å‡½æ•°
    è´¢åŠ¡åœºæ™¯ï¼šè®¡ç®—äººå‡æŠ¥é”€é‡‘é¢
    """
    try:
        result = a / b
        print(f"âœ… è®¡ç®—æˆåŠŸï¼š{a} / {b} = {result}")
        return result
    except ZeroDivisionError:
        print("âŒ é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸ºé›¶ï¼äººå‡ä¸èƒ½æ˜¯0äºº")
        return 0
    except Exception as e:
        print(f"âŒ æœªçŸ¥é”™è¯¯: {e}")
        return None

# æµ‹è¯•
print("äººå‡æŠ¥é”€è®¡ç®—æµ‹è¯•ï¼š")
safe_divide(10000, 5)  # æ­£å¸¸æƒ…å†µ
safe_divide(10000, 0)  # é™¤é›¶é”™è¯¯
safe_divide(10000, "abc")  # ç±»å‹é”™è¯¯ï¼Œä¼šè§¦å‘æœªçŸ¥é”™è¯¯
```

***

#### 3.2 æ•è·å¤šä¸ªå¼‚å¸¸

```python
# ========== å¤šå¼‚å¸¸æ•è· ==========
def calculate_bonus(sales_amount: str, bonus_rate: str):
    """
    è®¡ç®—é”€å”®ææˆ
    èƒ½å¤„ç†å„ç§è¾“å…¥é”™è¯¯
    """
    try:
        # å°è¯•è½¬æ¢è¾“å…¥ä¸ºæ•°å­—
        sales = float(sales_amount)
        rate = float(bonus_rate)
        
        if sales < 0:
            raise ValueError("é”€å”®é¢ä¸èƒ½ä¸ºè´Ÿæ•°")  # ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸
        
        if rate < 0 or rate > 0.5:
            raise ValueError("ææˆæ¯”ä¾‹å¿…é¡»åœ¨0-50%ä¹‹é—´")
        
        bonus = sales * rate
        print(f"âœ… ææˆè®¡ç®—æˆåŠŸï¼šÂ¥{bonus:,.2f}")
        return bonus
    
    except ValueError as e:
        print(f"âŒ è¾“å…¥æ•°æ®é”™è¯¯: {e}")
        return 0
    except TypeError as e:
        print(f"âŒ ç±»å‹é”™è¯¯: {e}")
        return 0
    except Exception as e:
        print(f"âŒ æ„å¤–é”™è¯¯: {e}")
        return 0

# æµ‹è¯•
print("\nææˆè®¡ç®—æµ‹è¯•ï¼š")
calculate_bonus("50000", "0.08")  # æ­£å¸¸
calculate_bonus("-1000", "0.05")  # è´Ÿé”€å”®é¢
calculate_bonus("abc", "0.05")    # éæ•°å­—
calculate_bonus("50000", "0.8")   # ææˆæ¯”ä¾‹è¿‡é«˜
```

***

### å››ã€å®Œæ•´å¼‚å¸¸ç»“æ„ï¼štry/except/else/finally

```python
# ========== å®Œæ•´å¼‚å¸¸å¤„ç†ç»“æ„ ==========
def process_salary_file(filepath):
    """
    å¤„ç†å·¥èµ„æ–‡ä»¶ï¼šè¯»å–ã€è®¡ç®—ã€ä¿å­˜
    å®Œæ•´å±•ç¤ºtryç»“æ„
    """
    print(f"\nğŸ“‚ å¼€å§‹å¤„ç†æ–‡ä»¶: {filepath}")
    
    try:
        # 1. tryå—ï¼šå¯èƒ½å‡ºé”™çš„ä»£ç 
        with open(filepath, 'r', encoding='utf-8') as f:
            data = json.load(f)
        
        # 2. æ•°æ®å¤„ç†ï¼ˆå¦‚æœä¸Šé¢æ²¡å‡ºé”™æ‰ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼‰
        total_salary = sum([emp['salary'] for emp in data['employees']])
        print(f"âœ… æ•°æ®åŠ è½½æˆåŠŸï¼Œå‘˜å·¥æ•°: {len(data['employees'])}")
        
    except FileNotFoundError:
        # 3. exceptï¼šæ•è·ç‰¹å®šé”™è¯¯
        print("âŒ é”™è¯¯ï¼šæ–‡ä»¶ä¸å­˜åœ¨ï¼è¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„")
        return False
    
    except json.JSONDecodeError:
        # JSONæ ¼å¼é”™è¯¯
        print("âŒ é”™è¯¯ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯ï¼ä¸æ˜¯æœ‰æ•ˆçš„JSONæ–‡ä»¶")
        return False
    
    except KeyError as e:
        # ç¼ºå°‘å¿…è¦å­—æ®µ
        print(f"âŒ é”™è¯¯ï¼šæ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œç¼ºå°‘å­—æ®µ {e}")
        return False
    
    except Exception as e:
        # å…¶ä»–æ‰€æœ‰é”™è¯¯
        print(f"âŒ æœªçŸ¥é”™è¯¯: {e}")
        return False
    
    else:
        # 4. elseï¼štryå—æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸æ—¶æ‰§è¡Œ
        print(f"ğŸ‰ æ•°æ®å¤„ç†æˆåŠŸï¼å·¥èµ„æ€»é¢: Â¥{total_salary:,.2f}")
        return True
    
    finally:
        # 5. finallyï¼šæ— è®ºæ˜¯å¦å‡ºé”™éƒ½ä¼šæ‰§è¡Œï¼ˆæ¸…ç†å·¥ä½œï¼‰
        print(f"â° å¤„ç†å®Œæˆæ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")

# æµ‹è¯•å®Œæ•´ç»“æ„
# åˆ›å»ºæµ‹è¯•æ–‡ä»¶
test_data = {
    "employees": [
        {"name": "å¼ ä¸‰", "salary": 15000},
        {"name": "æå››", "salary": 12000}
    ]
}

with open('å·¥èµ„æ•°æ®.json', 'w', encoding='utf-8') as f:
    json.dump(test_data, f, ensure_ascii=False, indent=2)

# æ­£å¸¸å¤„ç†
process_salary_file('å·¥èµ„æ•°æ®.json')

# é”™è¯¯æƒ…å†µ
process_salary_file('ä¸å­˜åœ¨çš„æ–‡ä»¶.json')
process_salary_file('å·¥èµ„æ•°æ®.json.bak')  # åˆ›å»ºä¸ªé”™è¯¯æ–‡ä»¶æµ‹è¯•
```

***

### äº”ã€æ•°æ®éªŒè¯ï¼šæå‰é¢„é˜²é”™è¯¯

```python
# ========== è´¢åŠ¡æ•°æ®éªŒè¯å™¨ ==========
class FinanceValidator:
    """è´¢åŠ¡æ•°æ®éªŒè¯å·¥å…·"""
    
    @staticmethod
    def validate_amount(amount_str: str, min_value: float = 0, max_value: float = 1000000) -> float:
        """
        éªŒè¯é‡‘é¢è¾“å…¥
        è¿”å›ï¼šéªŒè¯é€šè¿‡è¿”å›é‡‘é¢ï¼Œä¸é€šè¿‡æŠ›å‡ºå¼‚å¸¸
        """
        try:
            amount = float(amount_str)
        except ValueError:
            raise ValueError(f"âŒ é‡‘é¢å¿…é¡»æ˜¯æ•°å­—ï¼Œä¸èƒ½æ˜¯'{amount_str}'")
        
        if amount < min_value:
            raise ValueError(f"âŒ é‡‘é¢ä¸èƒ½å°äº{min_value}ï¼Œå½“å‰å€¼: {amount}")
        
        if amount > max_value:
            raise ValueError(f"âŒ é‡‘é¢ä¸èƒ½è¶…è¿‡{max_value}ï¼Œå½“å‰å€¼: {amount}")
        
        # æ£€æŸ¥å°æ•°ä½æ•°ï¼ˆè´¢åŠ¡é€šå¸¸æœ€å¤š2ä½ï¼‰
        if round(amount, 2) != amount:
            raise ValueError(f"âŒ é‡‘é¢æœ€å¤šä¿ç•™2ä½å°æ•°ï¼Œå½“å‰å€¼: {amount}")
        
        return amount
    
    @staticmethod
    def validate_date(date_str: str) -> str:
        """éªŒè¯æ—¥æœŸæ ¼å¼"""
        try:
            datetime.strptime(date_str, '%Y-%m-%d')
            return date_str
        except ValueError:
            raise ValueError(f"âŒ æ—¥æœŸæ ¼å¼é”™è¯¯ï¼Œåº”ä¸ºYYYY-MM-DDï¼Œä¸èƒ½æ˜¯'{date_str}'")
    
    @staticmethod
    def validate_rate(rate_str: str) -> float:
        """éªŒè¯æ¯”ç‡ï¼ˆå¦‚ç¨ç‡ã€ææˆï¼‰"""
        try:
            rate = float(rate_str)
        except ValueError:
            raise ValueError(f"âŒ æ¯”ç‡å¿…é¡»æ˜¯æ•°å­—ï¼Œä¸èƒ½æ˜¯'{rate_str}'")
        
        if rate < 0 or rate > 1:
            raise ValueError(f"âŒ æ¯”ç‡å¿…é¡»åœ¨0-1ä¹‹é—´ï¼ˆ0%åˆ°100%ï¼‰ï¼Œå½“å‰å€¼: {rate}")
        
        return rate
    
    @staticmethod
    def validate_employee_id(emp_id: str) -> str:
        """éªŒè¯å‘˜å·¥å·¥å·æ ¼å¼"""
        emp_id = emp_id.strip()
        
        if not emp_id:
            raise ValueError("âŒ å·¥å·ä¸èƒ½ä¸ºç©º")
        
        if len(emp_id) > 10:
            raise ValueError(f"âŒ å·¥å·ä¸èƒ½è¶…è¿‡10ä½ï¼Œå½“å‰é•¿åº¦: {len(emp_id)}")
        
        if not emp_id[0].isalpha():
            raise ValueError(f"âŒ å·¥å·é¦–ä½å¿…é¡»æ˜¯å­—æ¯ï¼Œå½“å‰å€¼: {emp_id}")
        
        return emp_id

# æµ‹è¯•éªŒè¯å™¨
print("\nè´¢åŠ¡æ•°æ®éªŒè¯æµ‹è¯•ï¼š")
validator = FinanceValidator()

try:
    validator.validate_amount("15000.55")  # æ­£å¸¸
    print("âœ… é‡‘é¢éªŒè¯é€šè¿‡")
except Exception as e:
    print(e)

try:
    validator.validate_amount("-500")  # è´Ÿæ•°
except Exception as e:
    print(e)

try:
    validator.validate_rate("0.15")  # æ­£å¸¸15%
    print("âœ… æ¯”ç‡éªŒè¯é€šè¿‡")
except Exception as e:
    print(e)

try:
    validator.validate_rate("150%")  # æ ¼å¼é”™è¯¯
except Exception as e:
    print(e)
```

***

### å…­ã€å®æˆ˜ï¼šå®‰å…¨çš„è´¢åŠ¡è®¡ç®—å™¨

#### 6.1 è®¾è®¡æ€è·¯

```python
# ========== å®‰å…¨è´¢åŠ¡è®¡ç®—å™¨è®¾è®¡ ==========
"""
åŠŸèƒ½éœ€æ±‚ï¼š
1. è®¡ç®—ç¨åå·¥èµ„ï¼ˆå®¹é”™ï¼šè´Ÿæ•°ã€éæ•°å­—ã€è¶…å‡ºèŒƒå›´ï¼‰
2. è®¡ç®—æŠ¥é”€æ€»é¢ï¼ˆå®¹é”™ï¼šæ–‡ä»¶ä¸å­˜åœ¨ã€æ ¼å¼é”™è¯¯ï¼‰
3. è®¡ç®—é¡¹ç›®ROIï¼ˆå®¹é”™ï¼šé™¤é›¶ã€æ•°æ®ç¼ºå¤±ï¼‰
4. æ‰€æœ‰æ“ä½œè®°å½•æ—¥å¿—ï¼Œä¾¿äºå®¡è®¡

å®‰å…¨ç­–ç•¥ï¼š
- è¾“å…¥éªŒè¯ï¼šæå‰æ‹¦æˆªéæ³•æ•°æ®
- å¼‚å¸¸æ•è·ï¼šè¿è¡Œæ—¶é”™è¯¯ä¸å´©æºƒ
- æ—¥å¿—è®°å½•ï¼šæ‰€æœ‰æ“ä½œå¯è¿½æº¯
- é»˜è®¤å€¼ï¼šé”™è¯¯æ—¶è¿”å›å®‰å…¨å€¼ï¼ˆ0ï¼‰
"""
```

***

#### 6.2 å®Œæ•´å®ç°

```python
# ========== å®‰å…¨è´¢åŠ¡è®¡ç®—å™¨ - å®Œæ•´ç‰ˆ ==========
import json
import os
from datetime import datetime
from typing import List, Dict

class SafeFinanceCalculator:
    """å®‰å…¨çš„è´¢åŠ¡è®¡ç®—å™¨"""
    
    def __init__(self, log_file="finance_calc.log"):
        self.log_file = log_file
        self.validator = FinanceValidator()
    
    def log(self, operation: str, details: str, status: str = "SUCCESS"):
        """è®°å½•æ“ä½œæ—¥å¿—"""
        timestamp = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        log_entry = f"[{timestamp}] [{status}] {operation}: {details}\n"
        
        try:
            with open(self.log_file, 'a', encoding='utf-8') as f:
                f.write(log_entry)
        except Exception as e:
            # æ—¥å¿—å†™å…¥å¤±è´¥ä¹Ÿä¸å½±å“ä¸»åŠŸèƒ½
            print(f"âš ï¸ æ—¥å¿—å†™å…¥å¤±è´¥: {e}")
    
    def calculate_tax_salary(self, gross_salary: str, insurance_str: str = "0") -> float:
        """
        è®¡ç®—ç¨åå·¥èµ„ï¼ˆå®‰å…¨ç‰ˆï¼‰
        è¿”å›ï¼šç¨åå·¥èµ„ï¼ˆå‡ºé”™è¿”å›0ï¼‰
        """
        try:
            # 1. éªŒè¯è¾“å…¥
            salary = self.validator.validate_amount(gross_salary, min_value=0, max_value=100000)
            insurance = self.validator.validate_amount(insurance_str, min_value=0, max_value=50000)
            
            # 2. è®¡ç®—ç¨åå·¥èµ„
            taxable = salary - insurance - 5000
            
            if taxable <= 0:
                tax = 0
            elif taxable <= 36000:
                tax = taxable * 0.03
            else:
                tax = taxable * 0.10 - 2520
            
            net_salary = salary - insurance - tax
            
            # 3. è®°å½•æˆåŠŸæ—¥å¿—
            self.log("å·¥èµ„è®¡ç®—", f"ç¨å‰{salary}ï¼Œäº”é™©ä¸€é‡‘{insurance}ï¼Œç¨å{net_salary:.2f}")
            
            return round(net_salary, 2)
        
        except Exception as e:
            # 4. é”™è¯¯å¤„ç† + è®°å½•æ—¥å¿—
            error_msg = str(e)
            self.log("å·¥èµ„è®¡ç®—", f"è¾“å…¥-gross:{gross_salary},insurance:{insurance_str},é”™è¯¯:{error_msg}", "ERROR")
            print(f"âŒ è®¡ç®—å¤±è´¥: {error_msg}ï¼Œå·²è¿”å›é»˜è®¤å€¼0")
            return 0
    
    def reimburse_from_file(self, filepath: str) -> float:
        """
        ä»æ–‡ä»¶è¯»å–æŠ¥é”€æ˜ç»†å¹¶è®¡ç®—æ€»é¢
        è¿”å›ï¼šæŠ¥é”€æ€»é¢ï¼ˆå‡ºé”™è¿”å›0ï¼‰
        """
        try:
            # 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
            if not os.path.exists(filepath):
                raise FileNotFoundError(f"æ–‡ä»¶'{filepath}'ä¸å­˜åœ¨")
            
            # 2. è¯»å–å¹¶è§£æ
            try:
                with open(filepath, 'r', encoding='utf-8') as f:
                    reimburse_data = json.load(f)
            except json.JSONDecodeError:
                raise ValueError(f"æ–‡ä»¶'{filepath}'ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼")
            
            # 3. éªŒè¯æ•°æ®ç»“æ„
            if 'reimbursements' not in reimburse_data:
                raise KeyError("ç¼ºå°‘'reimbursements'å­—æ®µ")
            
            reimbursements = reimburse_data['reimbursements']
            
            if not isinstance(reimbursements, list):
                raise TypeError("'reimbursements'å¿…é¡»æ˜¯åˆ—è¡¨")
            
            # 4. è®¡ç®—æ€»é¢
            total = 0
            errors = []
            
            for i, item in enumerate(reimbursements, 1):
                try:
                    # éªŒè¯æ¯æ¡è®°å½•
                    if 'amount' not in item:
                        raise KeyError(f"ç¬¬{i}æ¡è®°å½•ç¼ºå°‘'amount'å­—æ®µ")
                    
                    amount = self.validator.validate_amount(
                        str(item['amount']), 
                        min_value=0, 
                        max_value=50000
                    )
                    
                    # éªŒè¯å®¡æ‰¹çŠ¶æ€
                    status = item.get('status', 'pending')
                    if status != 'approved':
                        print(f"âš ï¸ ç¬¬{i}æ¡è®°å½•çŠ¶æ€ä¸º'{status}'ï¼Œè·³è¿‡è®¡ç®—")
                        continue
                    
                    total += amount
                    
                except Exception as e:
                    errors.append(f"ç¬¬{i}æ¡: {e}")
                    continue
            
            # 5. è®°å½•æ—¥å¿—
            if errors:
                self.log("æŠ¥é”€æ€»é¢è®¡ç®—", f"æˆåŠŸ{len(reimbursements)-len(errors)}æ¡ï¼Œå¤±è´¥{len(errors)}æ¡", "WARNING")
                for err in errors:
                    self.log("æŠ¥é”€æ˜ç»†é”™è¯¯", err, "ERROR")
            else:
                self.log("æŠ¥é”€æ€»é¢è®¡ç®—", f"æ–‡ä»¶{filepath}ï¼Œæ€»é¢{total:.2f},è®°å½•æ•°{len(reimbursements)}")
            
            return round(total, 2)
        
        except Exception as e:
            # é¡¶å±‚å¼‚å¸¸æ•è·
            self.log("æŠ¥é”€æ€»é¢è®¡ç®—", f"æ–‡ä»¶{filepath},é”™è¯¯:{str(e)}", "ERROR")
            print(f"âŒ è®¡ç®—å¤±è´¥: {e}")
            return 0
    
    def calculate_roi(self, investment: str, profit: str) -> float:
        """
        è®¡ç®—ROIæŠ•èµ„å›æŠ¥ç‡
        ROI = (æ”¶ç›Š - æˆæœ¬) / æˆæœ¬ * 100%
        è¿”å›ï¼šROIç™¾åˆ†æ¯”ï¼ˆå‡ºé”™è¿”å›0ï¼‰
        """
        try:
            invest = self.validator.validate_amount(investment, min_value=0.01, max_value=10000000)
            prof = self.validator.validate_amount(profit, min_value=0, max_value=10000000)
            
            # è®¡ç®—ROI
            roi = (prof - invest) / invest * 100
            
            # è®°å½•æ—¥å¿—
            self.log("ROIè®¡ç®—", f"æŠ•èµ„{invest},æ”¶ç›Š{prof},ROI:{roi:.2f}%")
            
            return round(roi, 2)
        
        except Exception as e:
            self.log("ROIè®¡ç®—", f"è¾“å…¥-inv:{investment},profit:{profit},é”™è¯¯:{str(e)}", "ERROR")
            print(f"âŒ è®¡ç®—å¤±è´¥: {e}")
            return 0
    
    def show_log(self, lines: int = 10):
        """æŸ¥çœ‹æœ€è¿‘çš„æ“ä½œæ—¥å¿—"""
        try:
            if not os.path.exists(self.log_file):
                print("ğŸ“­ æš‚æ— æ—¥å¿—")
                return
            
            print(f"\nğŸ“‹ æœ€è¿‘ {lines} æ¡æ“ä½œæ—¥å¿—:")
            print("=" * 70)
            
            with open(self.log_file, 'r', encoding='utf-8') as f:
                all_logs = f.readlines()
            
            # æ˜¾ç¤ºæœ€åå‡ è¡Œ
            for log in all_logs[-lines:]:
                print(log.strip())
        
        except Exception as e:
            print(f"âŒ è¯»å–æ—¥å¿—å¤±è´¥: {e}")

def main():
    """ä¸»èœå•"""
    calculator = SafeFinanceCalculator()
    
    print("=" * 55)
    print("å®‰å…¨è´¢åŠ¡è®¡ç®—å™¨ v1.0")
    print("æ‰€æœ‰æ“ä½œå‡æœ‰æ—¥å¿—è®°å½•ï¼Œé”™è¯¯è‡ªåŠ¨å¤„ç†")
    print("=" * 55)
    
    while True:
        print("\n" + "=" * 50)
        print("åŠŸèƒ½èœå•")
        print("=" * 50)
        print("1. è®¡ç®—ç¨åå·¥èµ„")
        print("2. è®¡ç®—æŠ¥é”€æ€»é¢ï¼ˆä»æ–‡ä»¶ï¼‰")
        print("3. è®¡ç®—é¡¹ç›®ROI")
        print("4. æŸ¥çœ‹æ“ä½œæ—¥å¿—")
        print("5. é€€å‡º")
        print("=" * 50)
        
        choice = input("è¯·é€‰æ‹©: ").strip()
        
        if choice == "1":
            salary = input("ç¨å‰å·¥èµ„: ").strip()
            insurance = input("äº”é™©ä¸€é‡‘ï¼ˆå›è½¦é»˜è®¤ä¸º0ï¼‰: ").strip() or "0"
            result = calculator.calculate_tax_salary(salary, insurance)
            if result > 0:
                print(f"âœ… ç¨åå·¥èµ„: Â¥{result:,.2f}")
            else:
                print("âš ï¸ è®¡ç®—å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥")
        
        elif choice == "2":
            filepath = input("æŠ¥é”€æ–‡ä»¶è·¯å¾„: ").strip()
            if not filepath:
                filepath = "reimbursements.json"
            
            # å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºç¤ºä¾‹æ–‡ä»¶
            if not os.path.exists(filepath):
                print("âš ï¸ æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºç¤ºä¾‹æ–‡ä»¶...")
                sample_data = {
                    "reimbursements": [
                        {"amount": 500, "status": "approved", "category": "äº¤é€šè´¹"},
                        {"amount": 1200, "status": "approved", "category": "é¤é¥®è´¹"},
                        {"amount": 800, "status": "pending", "category": "åŠå…¬ç”¨å“"}
                    ]
                }
                with open(filepath, 'w', encoding='utf-8') as f:
                    json.dump(sample_data, f, ensure_ascii=False, indent=2)
                print(f"âœ… ç¤ºä¾‹æ–‡ä»¶'{filepath}'å·²åˆ›å»º")
            
            result = calculator.reimburse_from_file(filepath)
            if result > 0:
                print(f"âœ… å¯æŠ¥é”€æ€»é¢: Â¥{result:,.2f}")
            else:
                print("âš ï¸ è®¡ç®—å¤±è´¥æˆ–æ— å¯æŠ¥é”€é¡¹ç›®")
        
        elif choice == "3":
            investment = input("é¡¹ç›®æŠ•èµ„æˆæœ¬: ").strip()
            profit = input("é¡¹ç›®æ”¶ç›Š: ").strip()
            result = calculator.calculate_roi(investment, profit)
            if result > 0:
                print(f"âœ… æŠ•èµ„å›æŠ¥ç‡: {result:.2f}%")
            else:
                print(f"â„¹ï¸ æŠ•èµ„å›æŠ¥ç‡: {result:.2f}%")
        
        elif choice == "4":
            lines = input("æ˜¾ç¤ºæœ€è¿‘å¤šå°‘æ¡æ—¥å¿—ï¼ˆé»˜è®¤10ï¼‰: ").strip() or "10"
            try:
                calculator.show_log(int(lines))
            except:
                calculator.show_log()
        
        elif choice == "5":
            print("ğŸ‘‹ æ„Ÿè°¢ä½¿ç”¨ï¼Œæ—¥å¿—å·²ä¿å­˜è‡³ finance_calc.log")
            break
        
        else:
            print("è¯·è¾“å…¥1-5ä¹‹é—´çš„æ•°å­—ï¼")

if __name__ == "__main__":
    main()
```

***

### ä¸ƒã€çŸ¥è¯†ç‚¹åŠ æ²¹ç«™

#### 7.1 å¸¸è§å¼‚å¸¸ç±»å‹é€ŸæŸ¥

```python
"""
å¸¸è§å¼‚å¸¸ç±»å‹ï¼š

FileNotFoundError       æ–‡ä»¶ä¸å­˜åœ¨
PermissionError         æ— æƒé™è®¿é—®
IOError                è¾“å…¥è¾“å‡ºé”™è¯¯

ValueError             å€¼é”™è¯¯ï¼ˆç±»å‹å¯¹ä½†å€¼ä¸å¯¹ï¼‰
TypeError              ç±»å‹é”™è¯¯ï¼ˆå­—ç¬¦ä¸²+æ•°å­—ï¼‰
ZeroDivisionError      é™¤é›¶é”™è¯¯

KeyError               å­—å…¸é”®ä¸å­˜åœ¨
IndexError             åˆ—è¡¨ç´¢å¼•è¶Šç•Œ
AttributeError         å¯¹è±¡æ²¡æœ‰è¯¥å±æ€§

json.JSONDecodeError   JSONè§£æå¤±è´¥
ImportError            å¯¼å…¥æ¨¡å—å¤±è´¥
NameError              å˜é‡æœªå®šä¹‰

ä¸‡èƒ½æ•è·ï¼š
except Exception as e:  # æ•è·æ‰€æœ‰å¼‚å¸¸
"""
```

***

#### 7.2 try/exceptæœ€ä½³å®è·µ

```python
# âŒ ä¸å¥½çš„åšæ³•
try:
    result = a / b
except:  # æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œä½†ä¸å¤„ç†
    pass  # é™é»˜å¿½ç•¥ï¼Œé—®é¢˜è¢«éšè—

# âœ… å¥½çš„åšæ³•
try:
    result = a / b
except ZeroDivisionError:
    print("é™¤æ•°ä¸ºé›¶")
    result = 0
except Exception as e:
    print(f"æœªçŸ¥é”™è¯¯: {e}")
    result = 0
```

***

#### 7.3 ä½•æ—¶ä½¿ç”¨å¼‚å¸¸å¤„ç†

| åœºæ™¯      | å¤„ç†æ–¹å¼           | ç¤ºä¾‹                             |
| ------- | -------------- | ------------------------------ |
| ç”¨æˆ·è¾“å…¥    | **å¿…é¡»** éªŒè¯+å¼‚å¸¸å¤„ç† | è¾“å…¥é‡‘é¢ã€æ—¥æœŸ                        |
| æ–‡ä»¶æ“ä½œ    | **å¿…é¡»** å¼‚å¸¸å¤„ç†    | è¯»å–/å†™å…¥æ–‡ä»¶                        |
| ç½‘ç»œè¯·æ±‚    | **å¿…é¡»** å¼‚å¸¸å¤„ç†    | APIè°ƒç”¨ã€ç½‘é¡µæŠ“å–                     |
| æ•°æ®è½¬æ¢    | **å¿…é¡»** å¼‚å¸¸å¤„ç†    | å­—ç¬¦ä¸²è½¬æ•°å­—                         |
| å†…éƒ¨è®¡ç®—    | å¯é€‰ éªŒè¯+å¼‚å¸¸å¤„ç†     | é™¤æ³•è¿ç®—                           |
| ç¡®å®šå®‰å…¨çš„æ“ä½œ | ä¸éœ€è¦            | `len(list)`ã€`for i in range()` |

***

### å…«ã€æ€»ç»“

- âœ… ç†è§£é”™è¯¯å’Œå¼‚å¸¸çš„åŒºåˆ«
- âœ… try/exceptæ•è·å’Œå¤„ç†å¼‚å¸¸
- âœ… else/finallyå®Œæ•´ç»“æ„
- âœ… æ•°æ®éªŒè¯çš„é˜²å¾¡æ€§ç¼–ç¨‹
- âœ… æ„å»ºå¸¦æ—¥å¿—çš„å®‰å…¨è®¡ç®—å™¨

***

### ä¸‹ç¯‡é¢„å‘Š

ç¬¬21ç¯‡ã€Šæ­£åˆ™è¡¨è¾¾å¼ï¼šæ–‡æœ¬å¤„ç†åˆ©å™¨ã€‹â€”â€”å¿«é€Ÿä»æ··ä¹±æ–‡æœ¬ä¸­æå–é‡‘é¢ã€æ—¥æœŸã€è´¦å·ï¼Œè´¢åŠ¡æ•°æ®æ¸…æ´—å¿…å¤‡ç¥å™¨ï¼

***

> ğŸ¤– Powered by Kimi K2 Thinking ğŸ’» å†…å®¹ç»è‘µè‘µğŸŒ»å®¡æ ¸ä¸ä¿®æ”¹

***

---
title: æ·±åº¦å­¦ä¹ -MoCo v1ã€V2å’ŒV3å¯¹æ¯”
categories:
  - ğŸŒ™è¿›é˜¶å­¦ä¹ 
  - â­äººå·¥æ™ºèƒ½ Artificial Intelligence
  - ğŸ’«ç½‘ç»œæ¨¡å‹ Networks Model
abbrlink: 561b83dd
date: 2023-06-27 05:15:30
tags:
---

### MoCoV1

**Momentum Contrast for Unsupervised Visual Representation Learning**

ï¼ˆç‰¹å¾ç›¸ä¼¼æ€§æ–¹å¼è®¡ç®—ï¼šå½“å‰batchä¸å½“å‰batchä¸ºæ­£æ ·æœ¬ï¼Œä¸ç‰¹å¾åº“ä¸­çš„æ‰€æœ‰æ ·æœ¬ä¸ºè´Ÿæ ·æœ¬ï¼‰

å¦‚æœæ²¡æœ‰labelçº¦æŸï¼Œæ¯epochç½‘ç»œå‚æ•°ä¸åŒï¼ŒåŒä¸€ä¸ªæ ·æœ¬æå–çš„ç‰¹å¾åˆ†å¸ƒæœ‰å·®å¼‚ï¼Œä¼šå‡ºç°é€€åŒ–è§£ç°è±¡ï¼Œä½œè€…ä½¿ç”¨EMAé˜²æ­¢è¯¥é—®é¢˜ï¼Œä½¿ç”¨å†…å­˜å­˜å‚¨ï¼ˆä½œè€…çº¦æŸç‰¹å¾åº“æœ€å¤§å­˜å‚¨65536ä¸ªæ ·æœ¬ï¼‰key-valueå½¢å¼ä¿è¯æ­£æ ·æœ¬å¯¹ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œæ­£è´Ÿæ ·æœ¬ä¹‹é—´çš„å·®å¼‚ã€‚

æ¯batch ç‰¹å¾åº“ä»¥é˜Ÿåˆ—çš„å½¢å¼å‡ºé˜Ÿå’Œå…¥é˜Ÿï¼Œå°†ä¿å­˜æœ€ä¹…çš„batchç‰¹å¾å‡ºé˜Ÿï¼Œå½“å‰batchï¼ˆæœ€æ–°ï¼‰çš„ç‰¹å¾å…¥é˜Ÿã€‚å°†å½“å‰batchçš„ä¸¤ä¸ªä¸åŒæ•°æ®å¢å¼ºæ–¹å¼ä½œä¸ºæ­£æ ·æœ¬å¯¹ï¼Œå…¶ä¸­ä¸€ä¸ªæ­£æ ·æœ¬batchä¸æ›´æ–°å‰çš„ç‰¹å¾åº“concatã€‚å…·ä½“ï¼š

æ¯ä¸ªå›¾ç‰‡ä¸¤ç§ä¸åŒæ•°æ®å¢å¼ºæ–¹å¼ä½œä¸ºkey-value å¯¹ï¼Œç”¨å¯bpçš„ç¼–ç å™¨ï¼ˆstudentï¼‰æå–valueçš„ç‰¹å¾qï¼ŒåŒæ—¶ç”¨teacherï¼ˆç”±student emaæ‰€å¾—ï¼‰æå–keyçš„ç‰¹å¾kï¼›

**å°†ç‰¹å¾q(N * C)ä¸ç‰¹å¾k(N * C)è¿›è¡ŒçŸ©é˜µæ±‚å’Œå¾—åˆ°N * 1ï¼Œå°†ç‰¹å¾q(N * C)ä¸ç‰¹å¾åº“(C * K)çŸ©é˜µä¹˜æ³•å¾—åˆ°N * Kç‰¹å¾ï¼ˆå¾—åˆ°å½“å‰æ ·æœ¬ä¸ç‰¹å¾åº“æ‰€æœ‰æ ·æœ¬ç‰¹å¾çš„ç›¸ä¼¼æ€§ï¼‰ã€‚å°†N * 1å’ŒN * Kç‰¹å¾è¿›è¡Œconcatï¼ˆä»¥æœ€åä¸€ä¸ªç»´åº¦è¿›è¡Œèåˆï¼‰ä¸ºN * ï¼ˆ1+Kï¼‰ä½œä¸ºpredictionã€‚**

=> æ­¤æ—¶ï¼ŒNä¸ªtargetéƒ½ä¸º0ï¼Œå³ä¸ºå½“å‰batchæ ·æœ¬çš„æœ€æ–°ç‰¹å¾ã€‚

{% asset_img 1.webp %}
<p style="text-align:center">moco-v1</p>

EMAé˜²æ­¢é€€åŒ–è§£ã€‚

<!--more-->

***

### MoCoV2

**Improved Baselines with Momentum Contrastive Learning**

å‚è€ƒå¯¹æ¯”å­¦ä¹ ä¾èµ–æ•°æ®å¢å¼ºï¼Œä½œè€…æ–°å¢äº†é«˜æ–¯æ¨¡ç³Š+MLP+cos lr è°ƒæ•´ç­–ç•¥ã€‚

noteï¼šä½œè€…è¯´æ˜**ä»…ä»…åœ¨éç›‘ç£é¢„è®­ç»ƒæ—¶ï¼ŒMLPæ›¿æ¢FCæ•ˆæœä¼šæå‡ã€‚è€Œåœ¨åˆ†ç±»ä»»åŠ¡æˆ–è€…è¿ç§»å­¦ä¹ ä¸Šè¿›è¡Œfine-tuneæ—¶ï¼Œæ²¡æœ‰ä½¿ç”¨MLPã€‚**

***

### MoCoV3

**An Empirical Study of Training Self-Supervised Visual Transformers**

vitä¸ç¨³å®šçš„è®­ç»ƒä¸å½±å“æ¨¡å‹æ˜¯å¦workï¼Œæ•ˆæœåªä¼šæœ‰1-3%çš„é™ä½ï¼›

ç§»é™¤ ViT ä¸­çš„ä½ç½®åµŒå…¥åªä¼šä½¿å‡†ç¡®æ€§é™ä½ä¸€å°éƒ¨åˆ†ã€‚ è¿™è¡¨æ˜è‡ªç›‘ç£çš„ ViT å¯ä»¥åœ¨æ²¡æœ‰ä½ç½®å½’çº³åå·®çš„æƒ…å†µä¸‹å­¦ä¹ å¼ºç‰¹å¾ï¼Œä½†è¿™ä¹Ÿæ„å‘³ç€è¯¥ä½ç½®æ²¡æœ‰è¢«å……åˆ†åˆ©ç”¨ã€‚

**ViTä¸ç¨³å®šè®­ç»ƒè¯´æ˜ï¼š**

ä½œè€…åœ¨è¿›è¡ŒViTè®­ç»ƒæ—¶å‘ç°ï¼Œbatchä¸º1kã€2kæ—¶è®­ç»ƒè¾ƒä¸ºç¨³å®šï¼Œä¸”é€å¢åŠ ï¼Œbatchåœ¨4kç”šè‡³6kæ—¶ï¼Œè®­ç»ƒä¸ç¨³å®šï¼Œå¯çœ‹æˆæ˜¯è·³å‡ºå±€éƒ¨æœ€ä¼˜è§£ï¼Œå…¨å±€æœ€ä¼˜è§£å–å†³äºå½“å‰accï¼Œå¦‚æœå½“å‰accä¸ä½³ï¼Œæœ€åæœ€ä½³accå¯èƒ½ä¹Ÿä¸å¥½ï¼›

blrè¶Šå°è¶Šç¨³å®šï¼Œä½†æ•ˆæœè¶Šå·®ã€‚blrè¿‡å¤§ä¹Ÿä¼šå¯¼è‡´è¿‡äºæŒ¯è¡å¯¼è‡´æœ€åæ•ˆæœä¸ä½³ã€‚

MLPï¼š

è‡ªç›‘ç£é¢„è®­ç»ƒæ—¶ï¼Œåœ¨ç‰¹å¾æå–åä½¿ç”¨ï¼Œä¸¤ä¸ªç¼–ç å™¨ï¼ˆAå’ŒBï¼‰å¹¶è¡Œä½¿ç”¨ï¼ŒB=mB+(1-m)Aæ›´æ–°ï¼Œm=0.99æ—¶æ•ˆæœæœ€ä½³ï¼›=ã€‹ï¼ˆè¿™é‡Œä¸åŒäºMoCo V1ï¼ŒV2ä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œä½œè€…ç›´æ¥ä½¿ç”¨batchæ¥åšæ­£è´Ÿæ ·æœ¬ï¼ŒåŒä¸€ä¸ªæ ·æœ¬ä¸åŒå¢å¼ºä¸ºæ­£æ ·æœ¬å¯¹ï¼Œä¸å…¶ä½™æ ·æœ¬äº’ä¸ºè´Ÿæ ·æœ¬å¯¹ï¼‰

fine-tuneæ—¶ï¼Œå°†æå–ç‰¹å¾çš„ç½‘ç»œfrozenï¼Œåªfine-tuneåˆ†ç±»å™¨å¤´ã€‚=> linear probe

{% asset_img 2.webp %}
<p style="text-align:center">MoCo V3 æ•´ä¸ªè®­ç»ƒé€»è¾‘å›¾</p>

**ä¸Šå›¾ä¸ºMoCo V3 è‡ªç›‘ç£é¢„è®­ç»ƒé€»è¾‘æµç¨‹ï¼Œåœ¨fine-tuneæ—¶ï¼Œåªä½¿ç”¨Encoder A+headï¼Œä¸”Encoder Aä¸­çš„grad=Falseï¼Œå³ä¸è¿›è¡Œæ¢¯åº¦æ›´æ–°ï¼Œåªfine-tuneheadã€‚**

***

### MoCo V1ã€V2ã€V3å¯¹æ¯”

#### æ€æƒ³

V1ä¸V2å‡ä½¿ç”¨å†…å­˜å­˜å‚¨å½¢å¼ï¼Œå­˜å‚¨å›ºå®šæ•°é‡æ ·æœ¬çš„ç‰¹å¾ï¼ŒV3ä½¿ç”¨å¤§batchå®ç°ã€‚

V1ä¸V2 lossè®¡ç®—æ—¶è¾“å…¥ç»´åº¦ä¸ºN*ï¼ˆ1+Kï¼‰ï¼ŒNä¸ºæ¯ä¸ªæ ·æœ¬ç‰¹å¾å‘é‡çš„é•¿åº¦ï¼Œ1+Kä¸ºå†…å­˜ä¸­æ‰€æœ‰æ ·æœ¬æ•°é‡ï¼ˆ1+65535ï¼‰ï¼Œæ¯ä¸ªç‰¹å¾åº“ä¸­ç¬¬ä¸€ä¸ªæ ·æœ¬ä¸ºæ­£æ ·æœ¬ï¼Œå…¶ä½™ä¸ºè´Ÿæ ·æœ¬ï¼ŒV3ç›´æ¥å¯¹batchçš„ç‰¹å¾å‘é‡è¿›è¡Œå½’ä¸€åŒ–åï¼ŒçŸ©é˜µä¹˜æ³•åç»´åº¦ä¸ºB*Bï¼Œtargetåˆ†åˆ«ä¸ºæ¯ä¸ªæ ·æœ¬å½“å‰æ‰€åœ¨ç´¢å¼•ä½ç½®ã€‚

#### ç½‘ç»œç»“æ„

V1ã€V2ä¸V3ä¸­é¢„è®­ç»ƒæ—¶ï¼ŒEncoder Bç”±Encoder Aè¿›è¡ŒåŠ¨é‡è®¡ç®—æ‰€å¾—ï¼Œv1 headä¸ºfcï¼ŒV2 ä¸V3headä¸ºmlpã€‚

V1ã€V2ä¸­encoderçš„backboneä¸ºresnetï¼ŒV3ä¸ºViTã€‚

noteï¼š

V3ä¸­å‘ç°ViTè®­ç»ƒä¸ç¨³å®šå¹¶ä¸ä»£è¡¨ViTç”¨äºå›¾ç‰‡ä¸èƒ½workï¼Œä¸ç¨³å®šåªæ˜¯æ•ˆæœä¸Šä¼šæœ‰1-3%çš„å·®å¼‚ï¼›

ViTè®­ç»ƒä¸ç¨³å®šä¸lrã€batchä»¥åŠå±‚æœ‰å…³ï¼Œç¬¬ä¸€æ¬¡å°±å‡ºç°äº†dipç°è±¡ï¼Œä½œè€…å°±çŒœæƒ³åç»­æ¯å±‚éƒ½ä¼šå‡ºç°æ­¤ç±»ç°è±¡ã€‚batchä¸º1kã€2kè®­ç»ƒç¨³å®šï¼Œå†å¤§å°±ä¼šå‡ºç°ä¸ç¨³å®šã€‚

lrå¤ªå°ï¼Œè™½ç„¶vitè®­ç»ƒç¨³å®šä½†æ•ˆæœå·®1-2%ï¼Œlrå¤ªå¤§ï¼Œvitè®­ç»ƒä¸ç¨³å®šè¶Šæ˜æ˜¾ã€‚blr=1e-4æœ€ä½³ï¼Œlr=blr*batch/256

é‡ç‚¹ï¼šè§£å†³ä¸ç¨³å®šé—®é¢˜ï¼Œä½œè€…ç›´æ¥å¯¹ç¬¬ä¸€å±‚éšæœºåˆå§‹åŒ–ç”¨å›ºå®šå‚æ•°ï¼Œä¸å‚ä¸å‚æ•°æ›´æ–°ã€‚å¯¹å…¶å®ƒç½‘ç»œéƒ½é€‚ç”¨

#### è®­ç»ƒtrick

v1ç®€å•ä½¿ç”¨è£å‰ªã€ç¿»è½¬ï¼Œv2ã€v3åœ¨v1åŸºç¡€ä¸Šæ–°å¢é«˜æ–¯æ¨¡ç³Šï¼›

v2ã€v3ä½¿ç”¨å­¦ä¹ ç‡è°ƒæ•´ç­–ç•¥è®­ç»ƒã€‚

***

### å‚è€ƒèµ„æ–™

> <https://zhuanlan.zhihu.com/p/540707764>

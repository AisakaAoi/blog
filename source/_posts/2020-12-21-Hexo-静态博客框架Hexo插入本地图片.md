---
title: Hexo-é™æ€åšå®¢æ¡†æ¶Hexoæ’å…¥æœ¬åœ°å›¾ç‰‡
categories:
  - ğŸŒ™é€¢å‚æ‚è°ˆä¸æ¬è¿
  - â­ä¸€äº›æŠ€æœ¯
abbrlink: bc3be9b8
date: 2020-12-21 13:34:30
---

åœ¨Hexoæ’å…¥æœ¬åœ°å›¾ç‰‡ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ¯”è°ƒç”¨å¤–éƒ¨é“¾æ¥èŠ‚çœä¸€ä¸¢ä¸¢æµé‡ï¼Œä¹Ÿæ–¹ä¾¿ä¸€äº›ï¼Œé¿å…å›¾åºŠå¤±æ•ˆå¯¼è‡´å¤±å»å›¾ç‰‡ç­‰é—®é¢˜ã€‚

***

### å®‰è£…æ’ä»¶ï¼Œåœ¨hexoé¡¹ç›®æ ¹ç›®å½•æ‰“å¼€Git Bashæˆ–cmd

```Git
npm install --save hexo-asset-image
```

***

### æ‰“å¼€hexoçš„é…ç½®æ–‡ä»¶_config.yml

- æ‰¾åˆ° post_asset_folderï¼ŒæŠŠè¿™ä¸ªé€‰é¡¹ä»falseæ”¹æˆtrue

***

<!--more-->

### ä¿®æ”¹hexo-asset-imageæ’ä»¶

- æ‰“å¼€/node_modules/hexo-asset-image/index.js

- å°†å†…å®¹æ›´æ¢ä¸ºä¸‹é¢çš„ä»£ç ï¼ˆåœ¨æ­¤æ„Ÿè°¢Ericam_ å¤§ç¥ï¼š<https://blog.csdn.net/xjm850552586>ï¼‰

```javascript
'use strict';
var cheerio = require('cheerio');

// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string
function getPosition(str, m, i) {
  return str.split(m, i).join(m).length;
}

var version = String(hexo.version).split('.');
hexo.extend.filter.register('after_post_render', function(data){
  var config = hexo.config;
  if(config.post_asset_folder){
        var link = data.permalink;
    if(version.length > 0 && Number(version[0]) == 3)
       var beginPos = getPosition(link, '/', 1) + 1;
    else
       var beginPos = getPosition(link, '/', 3) + 1;
    // In hexo 3.1.1, the permalink of "about" page is like ".../about/index.html".
    var endPos = link.lastIndexOf('/') + 1;
    link = link.substring(beginPos, endPos);

    var toprocess = ['excerpt', 'more', 'content'];
    for(var i = 0; i < toprocess.length; i++){
      var key = toprocess[i];
 
      var $ = cheerio.load(data[key], {
        ignoreWhitespace: false,
        xmlMode: false,
        lowerCaseTags: false,
        decodeEntities: false
      });

      $('img').each(function(){
        if ($(this).attr('src')){
            // For windows style path, we replace '\' to '/'.
            var src = $(this).attr('src').replace('\\', '/');
            if(!/http[s]*.*|\/\/.*/.test(src) &&
               !/^\s*\//.test(src)) {
              // For "about" page, the first part of "src" can't be removed.
              // In addition, to support multi-level local directory.
              var linkArray = link.split('/').filter(function(elem){
                return elem != '';
              });
              var srcArray = src.split('/').filter(function(elem){
                return elem != '' && elem != '.';
              });
              if(srcArray.length > 1)
                srcArray.shift();
              src = srcArray.join('/');
              $(this).attr('src', config.root + link + src);
              console.info&&console.info("update link as:-->"+config.root + link + src);
            }
        }else{
            console.info&&console.info("no src attr, skipped...");
            console.info&&console.info($(this));
        }
      });
      data[key] = $.html();
    }
  }
});
```

***

### å·²ç»å¯ä»¥æ’å…¥å›¾ç‰‡äº†

- ä¾‹å¦‚ hexo n "test" åœ¨ source/_posts ç”Ÿæˆ test.md æ–‡ä»¶å’Œ test æ–‡ä»¶å¤¹  
   å°±åœ¨ test.md æ–‡ä»¶é‡Œé¢æŒ‰ markdown çš„æ ‡å‡†å†™(æˆ‘çš„æ–‡ä»¶åæ˜¯test.jpg)

```markdown
// ç¬¬ä¸€ç§æ–¹å¼ .mdå¯é¢„è§ˆ ä½†åœ¨æŸäº›ä¸»é¢˜ä¸æ˜¾ç¤º ä¾‹å¦‚diaspora
![è¿™æ˜¯ä»£æ›¿å›¾ç‰‡çš„æ–‡å­—ï¼Œéšä¾¿å†™](test.jpg)

// ç¬¬äºŒç§æ–¹å¼ .mdä¸å¯é¢„è§ˆ ä½†ä»€ä¹ˆä¸»é¢˜éƒ½å¯ä½¿ç”¨
{% asset_img example.jpg This is an example image %}
or
{% asset_img example.jpg %}
```

***

### ç»“è¯­

- ä»¥å hexo n ååœ¨ source/_posts çš„ .md æ–‡ä»¶çš„åŒåæ–‡ä»¶å¤¹é‡Œï¼Œç›´æ¥æ”¾å…¥å›¾ç‰‡è°ƒç”¨å›¾ç‰‡åå³å¯

***

#### å‚è€ƒèµ„æ–™

> <https://blog.csdn.net/xjm850552586/article/details/84101345>
> <https://blog.csdn.net/qq_38148394/article/details/79997971>
> <https://www.jianshu.com/p/f72aaad7b852>
> <https://blog.csdn.net/xjm850552586/article/details/84101345>

---
title: 学习报告：一种基于元学习的跨被试小样本脑电睡眠分期网络ProSleepNet
categories:
  - 🌙进阶学习
  - ⭐脑机接口与混合智能研究团队（BCI团队）
  - 💫学习报告
abbrlink: 6977cd02
date: 2022-08-06 03:58:03
tags:
---

### 摘要

本篇学习报告总结了近期的一项研究进展，提出了一种基于原型网络的跨被试小样本脑电睡眠分期网络，称为ProSleepNet，用于基于单通道脑电图的自动睡眠分期。我们的实验在fpz-cz和pz-oz两个通道上进行，采用美国睡眠医学学会(AASM)标准，分为五个时期，分别是 W 期（清醒期）、N1 期睡眠（非快速眼动 1 期 NREM1）、 N2 期睡眠（非快速眼动 2 期 NREM2）、N3 期（非快速眼动 3 期 NREM3）、 R 期睡眠（快速眼动期 REM）。我们利用元学习的原型网络方法，使用跨被试的小样本学习，有效解决了以往深度学习网络费时费力的问题，也提高了睡眠分期的精度。我们的关键思想在于学习一部分被试的感知原型，能够捕获陌生患者的睡眠特征，优势在于利用跨被试识别，能有效解决医生面对陌生患者时，能快速利用原先网络，实现迁移学习，从而实现高效的睡眠分期。这对于以往医生采用手工标注睡眠时期，可以大大节约医生的时间。结果显示，ProSleepNet与最先进的神经网络相比，我们的实验在5way10shot时，精度相较于MetaSleepLearner的72.1%和DeepSleepNet的82%提高至83.3%。而单个被试的平均F1评分相较于MetaSleepLearner的64.8和DeepSleepNet的76.9提升至最高的89.9。

关键词：元学习、原型网络、跨被试、脑电、睡眠分期

<!--more-->

***

### 引言

本段介绍项目研究背景及其相关的研究现状。当前，随着与日俱增的工作压力、生活压力、行业压力，越来越多的人陷入了睡眠障碍的困扰当中。根据调查，在中国 14 亿人口中，有超过三亿的人患有睡眠障碍，睡眠困扰着从幼儿、青年、中年、老年等各个阶段不同年龄的群体，成为中国最易且最容易被忽视的疾病之一。睡眠是人类这一生最重要的行为之一，它对人类健康起着非常重要的作用，睡眠质量的好坏决定了一个人是否能够健康且正常的生活，它还间接影响且诱发其他疾病的产生。有医学研究表明，睡眠不足或睡眠质量差可能诱发癫痫的发作，加重发病次数。睡眠是一种最为常见的生理活动，每天都在进行着,因此，拥有优质的睡眠质量对 我们的日常生活尤为重要。 脑机接口(Brain-computer Interface, BCI)技术，打破了传统意义上人与外界交互要依靠肌肉组织进行信号传导的局限，实现了人脑与外界的直接交互[1]。脑电图（electroencephalogram, EEG）是一种人脑信号检测手段，它用附着在头皮上的小电极检测大脑的电活动，通过监测睡眠脑电图，可以判断睡眠质量的好坏。在信息技术发展的今天，如何监测睡眠质量，分析睡眠活动、睡眠脑电波也成为了可能。近年来，无创的非侵入式脑机接口应用于脑电信号采集，取得非凡的成果，脑机接口应用于睡眠信号采集、疾病诊断、情绪分析、机器人控制等诸多领域，应用前景广泛，脑电图应用于睡眠质量的监测也是必不可少的。大脑思维活动产生的 EEG，通过合适的解析算法进行分析处理，进而转换成相应的命令控制计算机或者电子设备。其中 EEG 解析过程可以分为：预处理、特征提取和特征分类[2]。

睡眠分期可以监测一个人睡眠各个时期的质量情况，判断一个人 的睡眠质量的好坏。在一些睡眠相关疾病的辅助诊断中，如癫痫、睡眠呼吸暂停等疾病，睡眠分期对我们的疾病诊断有着重要的作用，他能帮助我们提高对此类相关疾病的分析能力。识别睡眠阶段对诊断睡眠障碍至关重要，其中阻塞性睡眠呼吸暂停(OSA)是最普遍的疾病之一[5]。

睡眠分期（Sleep Staging）是睡眠领域热门的研究方向，睡眠 分期能够监测人们的睡眠状况，对医学研究和实践有重大影响[4]。根据美国睡眠医学学会(AASM)标准，成年人的脑电睡眠分期主要分为以下 5 个时期，及 W 期（清醒期）、N1 期睡眠（非快速眼动 1 期 NREM1）、 N2 期睡眠（非快速眼动 2 期 NREM2）、N3 期（非快速眼动 3 期 NREM3）、R 期睡眠（快速眼动期 REM）。传统的脑电睡眠分期包括医生手动进行分期标注，但是这种分期方式过于耗费医生的时间，因为标注过程需要从整夜的睡眠信号中分析出睡眠阶段的各个过程，费时且费力。 然而，在近几年深度学习几乎火热的情况下，利用深度学习、机器学习、元学习算法应用于脑电睡眠分期的案例涌现，且脑电睡眠分期效果及精度显著，这大大节省了医生手动进行标注的时间，通过深度学习、机器学习框架，可以对睡眠监测者的脑电信号进行训练学习，自动分析和学习脑电睡眠数据，对睡眠脑电信号进行机器分割，减少人力物力，应用前景广泛。 深 度 学 习 (DL, Deep Learning) 是 机 器 学 习 (ML, MachineLearning)领域中一个新的研究方向，它被引入机器学习使其更接近于最初的目标——人工智能(AI, Artificial Intelligence)。深度学习是学习样本数据的内在规律和表示层次，这些学习过程中获得的信息对诸如文字，图像和声音等数据的解释有很大的帮助。它的最终目标是让机器能够像人一样具有分析学习能力，能够识别文字、图像和声音等数据。 深度学习是一个复杂的机器学习算法，在语音和图像识别方面取得的效果，在脑电信号处理方面也有着出色的表现。但是传统的脑电睡眠分期的算法包括使用深度学习算法（DeepLearning）[6]。或使用端到端训练深度学习的包括卷积神经网络(CNN)或循环神经网络(RNN)算法[7]，涉及最先进的睡眠分期网络，DeepSleepNet [4]和 SeqSleepNet [9]。

尽管深度学习模型能够获得较高的精度，但由于训练需要大量的数据，该方法仍然不够实用，当我们出现一个从未遇见过的人时，我们如果采用深度学习算法，将必须重新计算，会大量耗费我们计算机的运算时间和运算成本。此外，由于脑电图通道的数量和位置、采样频率、实验范式和被试等许多原因的变化，数据来源于另一个队列，在一个队列中训练的模型并不能直接适用于另一个队列，限制其在临床环境中的适用性。典型的基于深度学习的脑电睡眠分期包括 Akara Supratak、郝东等提出的基于原始单通道脑电图的睡眠阶段自动评分模型——DeepSleepNet[4]，它利用卷积神经网络提取时域特征，并利用双向长期短期记忆从脑电图时期自动学习睡眠阶段之间的过渡规则，实现了一个两步训练算法来有效地训练模型。Sajad Mousavi 等人提出的自动睡眠阶段评分与序列之间的序列深度学习方法——SleepEEGNet[10],它提出了一种利用单通道 脑 电 图 信 号 的 自 动 睡 眠 阶 段 标 注 方 法 ， 即 SleepeEEGNet ，SleepEEGNet 由深度卷积神经网络(CNNs)组成，用于提取时域特征、频率信息和训练序列到序列模型，以捕捉睡眠时期和分数之间的复杂和长期短期上下文依赖关系。贾子钰等人提出了一种睡眠分期模型，针对现阶段数据和特征决定睡眠分期模型的分类精度上限的问题，提出深度卷积神经网络模型,在模型主体构建方面，并行卷积网络可以 自动学习原始信号的时域特征和频域特征，特征融合网络通过空洞卷积和残差连接进行多特征融合，分类网络基于融合后的特征进行睡眠分期。 利用生成少数类过采样技术（SMOTE）减少类别不平衡对分类 效果的影响，结合两步训练法对模型进行优化。实验使用 Sleep-EDF数据集的原始单导脑电信号（Fpz-Cz 通道）对模型进行 20 折交叉验证，得到总体精度为 86.73% 。提出的深度卷积模型在没有任何先验知识的情况下，对脑电信号进行端到端的学习，分类准确率优于传统的深度学习模型[11]。

Siddharth Biswal 等人提出了 SleepNet（睡眠脑电图神经网络），这是一种用于睡眠分期的部署注释工具。SleepNet 使用了一个深度循环神经网络，根据迄今为止最大的睡眠生理学数据库进行训练，由来自马萨诸塞州总医院(MGH)睡眠实验室的 1 万多名患者的 psg 组成。Dmeepnet 在 1000 个 eeg 的独立测试集上实现了人类级的注释性能，平均准确率为 85.76%，与 IRA 相当[12]。由于深度学习能够从原始信号中提取有用的特征，它已经成为自动睡眠阶段评分的流行方法。大多数现有的模型都被过度设计成包含多层模型，或者在处理管道中引入了额外的步骤，例如将信号转换为基于光谱图的图像。它们需要在一个大的数据集上进行训练，以防止过拟合问题（但大多数睡眠数据集包含有限数量的类不平衡数据），而且很难应用（因为在管道中有许多超参数需要配置）。 在 TinySleepNet 中 ， Akara 提 出 了 一 种 高 效 的 深 度 学 习 模 型 TinySleepeNet，以及一种有效地端到端训练基于原始单通道脑电图自动睡眠阶段评分的新技术。与现有模型相比，模型需训练的模型参数较少，需要的训练数据和计算资源较少。他们的训练技术结合了数据增强，这可以使我们的模型沿时间轴的移动更稳健，并可以防止模型记住睡眠阶段的序列[13]。正确识别睡眠阶段对于诊断和治疗睡眠障碍很重要，Huy Phan 等人提出了一种基于卷积神经网络(CNNs)的联合分类与预测框架来进行自动睡眠分期，并随后引入了一种简单而有效的 CNN 架构来为框架提供动力[14]。

本文提出了一种基于原型网络的跨被试小样本脑电睡眠分期网络，称为ProSleepNet，用于基于单通道脑电图的自动睡眠分期。我们的实验在fpz-cz和pz-oz两个通道上进行，采用美国睡眠医学学会(AASM)标准，分为五个时期。我们开发了一种跨被试的原型网络，实验采用我们开发的EAPNet深度神经网络，使用三层卷积神经网络，编码器结构参考了EEGNet模型，该编码器可以有效地提取脑电信号时间和通道间的特征信息。结果显示，与最先进的神经网络相比，我们的实验精度相较于MetaSleepNet的72.1%和DeepSleepNet的82%提高至83.3%。而单个被试的平均F1评分相较于MetaSleepNet的64.8和DeepSleepNet的76.9提升至最高的89.9。

***

### 实验数据及预处理

本段介绍实验数据的采用及预处理环节，实验采用睡眠多导图数据集Sleep-EDF，该数据集包括健康受试者SC以及食用替马西洋安定药的受试者ST的睡眠脑电图，以*PSG.edf为后缀的文件是包含EEG（来自Fpz-Cz和Pz-Oz电极位置），*Hypnogram.edf文件包含与PSG对应的睡眠模式的注释。所有脑电图的采样率均为100Hz。

睡眠专家根据R&K标准[2]，将这些记录手动分为八类(W、N1、N2、N3、N4、REM、运动、未知)，这些模式（催眠图）包括睡眠阶段W，N1、N2、N3、N4，REM，M（身体移动时间）和？（未评分时间）。我们将N3和N4阶段合并为一个单一的阶段N3，以保持美国睡眠医学学会(AASM)标准。在每次录音的开始和结束时，都有很长时间的清醒或W阶段，其中受试者没有睡觉，我们将其切割掉。我们只包括了在睡眠时间之前和之后的30分钟的时间，并且删除了M（身体移动时间）和？（未评分时间）。

***

### 预训练神经网络

本段介绍实验的预训练神经网络提取脑电数据特征。我们使用的数据集是Sleep-EDF公开数据集，我们将 20 个健康受试者（SC）的睡眠脑电分为训练集、测试集及验证集，（其中训练和验证时，将其中的19个被试作为我们的支持集support set，将另外1个被试作为我们的查询集query set），构造一个5way10shot和5way20shot的原型网络架构。取 30s 的时间窗截取睡眠样本作为一个 epoch，通道分别为 FpzCz、PzOz 两个通道，分别从 W、N1、N2、N3、R 期中各随机挑选出 10 个、20个 epoch，将睡眠分期的五个阶段进行数据预处理，使用encoderX作为我们的预训练神经网络。（如图一和图二）

{% asset_img 1.webp %}
<div align='center'>图一：预训练流程图及卷积神经网络 encoder X，用于提取特征</div>

{% asset_img 2.webp %}
<div align='center'>图二：神经网络 encoder X</div>

***

### 实验模型及流程图

本段提出实验模型及其整体的流程图。JakeSnell提出的元学习的原型网络被开发应用于手写语言图片数据集（Omniglot）及动物图片数据集（miniImagenet），实现了跨类别的小样本图像分类。原型网络与聚类联系起来，将类均值作为原型，将距离最相近的归为同一个类（如图三）。基于Jake Snell提出的基于少样本学习的原型网络，我们提出一种可以应用于脑电睡眠分期的跨被试小样本原型网络ProSleepNet（如图四）。

{% asset_img 3.webp %}
<div align='center'>图三：Jake Snell等人提出的基于少样本学习的原型网络（Prototypical Networks）</div>

{% asset_img 4.webp %}
<div align='center'>图四：我们提出的跨被试小样本原型网络ProSleepNet（图中为5way5shot的情景）</div>

元训练（如图五）时，从训练集中随机抽取一个受试者，然后从该受试者中随机抽取5类睡眠期间的数据各10个样本，1到5个类分别作为支持集（support set），从训练集中随机抽取一个受试者，从该受试者中随机抽取5类数据各10个样本，每类5个作为查询集（query set），构造5-way、10-shot实验。其中，我们用预训练的神经网络提取特征向量，取平均值，进行归一化处理（如图一所示），使用softmax做预测分析。多次构造任务进行实验，然后取平均的loss进行梯度下降进行微调。

{% asset_img 5.webp %}
<div align='center'>图五：元训练阶段</div>

元测试（如图六）时，从测试集中随机抽取一个受试者，然后从该受试者中随机抽取5类睡眠期间的数据各10个样本，每类1、5个作为支持集（support set），从测试集中随机抽取一个跟支持集（support set）抽取时不重复的受试者，从该受试者中随机抽取5类数据各10个样本，每类5个作为查询集（query_set），多次构造任务进行测试，然后取平均准确率作为最终的测试结果精度。

{% asset_img 6.webp %}
<div align='center'>图六：元测试阶段</div>

{% asset_img 7.webp %}
<div align='center'>图七：具体流程图</div>

***

### 实验对比

{% asset_img 8.webp %}

***

### 参考文献

> [1]Sajad Mousavi, Fatemeh Afghah. SleepEEGNet Automated Sleep Stage Scoring with Se. arXiv:1903.02108v1 [eess.SP] 5 Mar 2019
> [2] A. Supratak and Y. Guo, “TinySleepNet: An Efficient Deep Learning Model for Sleep Stage Scoring based on Raw Single-Channel EEG,” in 2020 42nd Annual International Conference of the IEEE Engineering in Medicine & Biology Society (EMBC), Montreal, QC, Canada, Jul. 2020, pp. 641–644. doi: 10.1109/EMBC44109.2020.9176741.
> [3] J. Snell, K. Swersky, and R. S. Zemel, “Prototypical Networks for Few-shot Learning,” ArXiv170305175 Cs Stat, Jun. 2017, Accessed: Dec. 02, 2021.
> [4] N. Banluesombatkul et al., “MetaSleepLearner: A Pilot Study on Fast Adaptation of Bio-signals-Based Sleep Stage Classifier to New Individual Subject Using Meta-Learning,” IEEE J. Biomed. Health Inform., vol. 25, no. 6, pp. 1949–1963, Jun. 2021, doi: 10.1109/JBHI.2020.3037693.
> [5] H. Yao et al., “Graph Few-Shot Learning via Knowledge Transfer,” Proc. AAAI Conf. Artif. Intell., vol. 34, no. 04, pp. 6656–6663, Apr. 2020, doi: 10.1609/aaai.v34i04.6142.
> [6] A. Supratak, H. Dong, C. Wu, and Y. Guo, “DeepSleepNet: A Model for Automatic Sleep Stage Scoring Based on Raw Single-Channel EEG,” IEEE Trans. Neural Syst. Rehabil. Eng., vol. 25, no. 11, pp. 1998–2008, Nov. 2017, doi: 10.1109/TNSRE.2017.2721116.

***

### 原文链接

> <https://www.scholat.com/teamwork/showPostMessage.html?id=12088>

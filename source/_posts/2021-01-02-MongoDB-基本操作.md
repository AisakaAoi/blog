---
title: MongoDB-åŸºæœ¬æ“ä½œ
categories:
  - ğŸŒ™åŸºç¡€å­¦ä¹ 
  - â­MongoDB
abbrlink: 57e31a2c
date: 2021-01-02 17:05:07
tags:
---

## åŸºæœ¬æ“ä½œ

### **mongod**

- æ‰“å¼€æˆ–è€…æ–°å»ºä¸€ä¸ªæ•°æ®åº“dir

```shell
PS C:\Users\16218> mongod --install --dbpath=D:/mongodb-win32-x86_64-windows-4.4.2/data --logpath=D:/mongodb-win32-x86_64-windows-4.4.2/logs/mongodb.log
PS C:\Users\16218> net start mongodb

PS C:\Users\16218> mongod --config "D:\mongodb-win32-x86_64-windows-4.4.2\mongo.conf"
```

<!--more-->

- å‘¨è¾¹è¯­æ³•

```shell
PS C:\Users\16218> bin/mongod.exe --install --dbpath ç£ç›˜è·¯å¾„ --logpath æ—¥å¿—è·¯å¾„        // åˆ›å»ºæœåŠ¡
PS C:\Users\16218> bin/mongod.exe --remove      // åˆ é™¤æœåŠ¡
PS C:\Users\16218> net start mongodb            // å¯åŠ¨æœåŠ¡
PS C:\Users\16218> net stop mongodb             // å…³é—­æœåŠ¡
```

### **mongoimport**

- --db å¯¼å…¥åˆ°é‚£ä¸ªåº“

- --collection å¯¼å…¥åˆ°å“ªä¸ªé›†åˆ

- --drop åŠ ä¸Šå°±è¡¨ç¤ºæ¸…ç©ºåŸæœ‰æ–‡æ¡£

- --file è¦å¯¼å…¥çš„æ–‡ä»¶

```shell
PS C:\Users\16218> mongoimport --db test --collection user --drop --file dir
```

### **mongo**

#### **æ•°æ®åº“ï¼ˆæŸ¥çœ‹ã€åˆ›å»ºã€é€‰æ‹©ã€åˆ é™¤ï¼‰**

æŸ¥çœ‹ï¼šshow databases

åˆ›å»ºï¼šæœ‰å•ç‹¬çš„è¯­æ³• ä½†æ˜¯å¿½ç•¥ éšå¼åˆ›å»º

é€‰æ‹©ï¼šuse æ•°æ®åº“å

åˆ é™¤ï¼š1.é€šè¿‡useé€‰ä¸­æ•°æ®åº“ 2.é€šè¿‡db.dropDatabase()åˆ é™¤æ•°æ®åº“

#### **é›†åˆï¼ˆæŸ¥çœ‹ã€åˆ›å»ºã€åˆ é™¤ï¼‰**

æŸ¥çœ‹ï¼šshow collextions

åˆ›å»ºï¼šdb.createCollection('é›†åˆå')     å¤šå­¦ä¸€æ‹›ï¼šå¿½ç•¥ åæœŸæ’å…¥æ•°æ® éšå¼åˆ›å»ºé›†åˆ

åˆ é™¤ï¼šdb.é›†åˆå.drop()

#### **Cæ’å…¥æ–‡æ¡£**

è¯­æ³•ï¼šdb.é›†åˆå.insert(JSONæ•°æ®)

è¯´æ˜ï¼šé›†åˆå­˜åœ¨ åˆ™ç›´æ¥æ’å…¥æ•°æ® é›†åˆä¸å­˜åœ¨ åˆ™éšå¼åˆ›å»º

ç»ƒä¹ ï¼šåœ¨test2æ•°æ®åº“çš„c1é›†åˆä¸­æ’å…¥æ•°æ®ï¼ˆå§“åå«webopenfatherå¹´é¾„18å²ï¼‰

```mongodb
> use test2
> db.c1.insert({uname: "webopenfather", age: 18})

ç•™å¿ƒ1ï¼šæ•°æ®åº“å’Œé›†åˆä¸å­˜åœ¨éƒ½éšå¼åˆ›å»º
ç•™å¿ƒ2ï¼šå¯¹è±¡çš„é”®ç»Ÿä¸€ä¸åŠ å¼•å·æ–¹ä¾¿çœ‹ï¼Œä½†æ˜¯æŸ¥çœ‹é›†åˆæ•°æ®æ—¶ç³»ç»Ÿä¼šè‡ªåŠ¨åŠ 
```

æ€è€ƒ1ï¼šæ˜¯å¦å¯ä»¥è‡ªå®šä¹‰_idå€¼ï¼Ÿ

å›ç­”ï¼šå¯ä»¥ï¼Œåªéœ€è¦ç»™æ’å…¥çš„JSONæ•°æ®å¢åŠ _idé”®å³å¯è¦†ç›–ï¼ˆä½†å®æˆ˜å¼ºçƒˆä¸æ¨èï¼‰

```mongodb
> db.c1.insert({_id: 1, uname: "webopenfather", age: 18})
```

æ€è€ƒ2ï¼šå¦‚ä½•ä¸€æ¬¡æ€§æ’å…¥å¤šæ¡è®°å½•ï¼Ÿ

å›ç­”ï¼šä¼ é€’æ•°æ®ï¼Œæ•°ç»„ä¸­å†™ä¸€ä¸ªä¸ªJSONæ•°æ®å³å¯

```mongodb
> db.c1.insert([
    {uname: "a", age: 1}, 
    {uname: "b", age: 2}, 
    {uname: "c", age: 3}, 
])
```

æ€è€ƒ3ï¼šå¦‚ä½•å¿«é€Ÿæ’å…¥10æ¡æ•°æ®ï¼Ÿ

å›ç­”ï¼šmongodbåº•å±‚ä½¿ç”¨JSå¼•æ“å®ç°çš„ï¼Œæ‰€ä»¥æ”¯æŒéƒ¨åˆ†jsè¯­æ³•ï¼Œå› æ­¤å¯ä»¥å†™forå¾ªç¯

```mongodb
> use test2
> for (let i = 1; i <= 10; i++) {
    db.c2.insert({uname: "a"+i, age: i})
}
```

#### **RæŸ¥è¯¢æ–‡æ¡£**

è¯­æ³•ï¼šdb.é›†åˆå.find(æ¡ä»¶ [,æŸ¥è¯¢çš„åˆ—])

``` shell
æ¡ä»¶
    æŸ¥è¯¢æ‰€æœ‰æ•°æ®                {}æˆ–è€…ä¸å†™
    æŸ¥è¯¢age=6çš„æ•°æ®             {age: 6}
    æ—¢è¦age=6åˆè¦æ€§åˆ«=ç”·        {age: 6, sex: 'ç”·'}

æŸ¥è¯¢çš„åˆ—ï¼ˆå¯é€‰å‚æ•°ï¼‰
    ä¸å†™        åªæŸ¥è¯¢å…¨éƒ¨åˆ—ï¼ˆå­—æ®µï¼‰
    {age: 1}    åªæ˜¾ç¤ºageåˆ—ï¼ˆå­—æ®µï¼‰
    {age: 0}    é™¤äº†ageåˆ—ï¼ˆå­—æ®µéƒ½æ˜¾ç¤ºï¼‰
    ç•™å¿ƒï¼šä¸ç®¡æ€ä¹ˆå†™ ç³»ç»Ÿè‡ªå®šä¹‰çš„_idéƒ½ä¼šå­˜åœ¨
```

å‡çº§è¯­æ³•ï¼šdb.é›†åˆå.find({é”®: {è¿ç®—ç¬¦: å€¼}})

è¯´æ˜ï¼š
| è¿ç®—ç¬¦ | ä½œç”¨ |
| :------: | :----: |
| $gt | å¤§äº |
| $gte | å¤§äºç­‰äº |
| $lt | å°äº |
| $lte | å°äºç­‰äº |
| $ne | ä¸ç­‰äº |
| $in | in |
| $nin | not in |

ç»ƒä¹ 1ï¼šæŸ¥è¯¢æ‰€æœ‰æ•°æ®

```mongodb
> db.c1.find()
```

ç»ƒä¹ 2ï¼šæŸ¥è¯¢å¹´é¾„å¤§äº5å²çš„æ•°æ®

```mongodb
> db.c1.find({age: {$gt: 5}})
```

ç»ƒä¹ 3ï¼šæŸ¥è¯¢å¹´é¾„æ˜¯5å²ã€8å²ã€10å²çš„æ•°æ®

```mongodb
> db.c1.find({age: {$in: [5, 8, 10]}})
```

ç»ƒä¹ 4ï¼šåªçœ‹å¹´é¾„åˆ—ï¼Œæˆ–è€…å¹´é¾„ä»¥å¤–çš„åˆ—ï¼ˆ_idåˆ«ç®¡å®ƒï¼‰

```mongodb
> db.c1.find({}, {age: 1})
> db.c1.find({}, {age: 0})
```

#### **Uä¿®æ”¹æ–‡æ¡£**

è¯­æ³•ï¼šdb.é›†åˆå.update(æ¡ä»¶, æ–°æ•°æ® [,æ˜¯å¦æ–°å¢ï¼Œæ˜¯å¦ä¿®æ”¹å¤šæ¡])

``` shell
æ˜¯å¦æ–°å¢ï¼šæŒ‡æ¡ä»¶åŒ¹é…ä¸åˆ°æ•°æ®åˆ™æ’å…¥ trueæ’å…¥ falseä¸æ’å…¥ï¼ˆé»˜è®¤ï¼‰
æ˜¯å¦ä¿®æ”¹å¤šæ¡ï¼šæŒ‡å°†åŒ¹é…æˆåŠŸçš„æ•°æ®éƒ½ä¿®æ”¹ trueä¿®æ”¹å¤šæ¡ falseä¸ä¿®æ”¹å¤šæ¡ï¼ˆé»˜è®¤ï¼‰
```

å‡çº§è¯­æ³•ï¼šdb.é›†åˆå.update(æ¡ä»¶, {ä¿®æ”¹å™¨: {é”®: å€¼}})

è¯´æ˜ï¼š
| è¿ç®—ç¬¦ | ä½œç”¨ |
| :------: | :----: |
| $inc | é€’å¢ |
| $rename | é‡å‘½ååˆ— |
| $set | ä¿®æ”¹åˆ—å€¼ |
| $unset | åˆ é™¤åˆ— |

ç»ƒä¹ 1ï¼šå°†{uname: "zc1"}æ”¹ä¸º{uname: "zc2"}

```mongodb
> db.c3.update({uname: "zc1"}, {uname: "zc2"})              // è¿™æ˜¯æ›¿æ¢
> db.c3.update({uname: "zc1"}, {$set: {uname: "zc2"}})      // è¿™æ˜¯ä¿®æ”¹
```

ç»ƒä¹ 2ï¼šç»™{uname: "zc10"}çš„å¹´é¾„åŠ 2å²æˆ–å‡ä¸¤å²

```mongodb
> db.c3.update({uname: "zc1"}, {$inc: {age: 2}})
> db.c3.update({uname: "zc1"}, {$inc: {age: -2}})
```

ç»ƒä¹ 3ï¼šä¿®æ”¹å™¨ç»¼åˆç»ƒä¹ 

```mongodb
unameæ”¹æˆzc2
> db.c3.update({uname: "zc1"}, {$set: {uname: "zc2"}})
ageå¢åŠ 111
> db.c3.update({uname: "zc2"}, {$inc: {age: 111}})
whoæ”¹å­—æ®µsex
> db.c3.update({uname: "zc2"}, {$rename: {who: "sex"}})
otheråˆ é™¤
> db.c3.update({uname: "zc2"}, {$unset: {other: true}})
æˆ–è€…ä¸€èµ·å†™
db.c3.update({uname: "zc1"}, {
    $set: {uname: "zc2"}, 
    $inc: {age: 111}, 
    $rename: {who: "sex"}, 
    $unset: {other: true}, 
})
```

#### **Dåˆ é™¤æ–‡æ¡£**

è¯­æ³•ï¼šdb.é›†åˆå.remove(æ¡ä»¶, [,æ˜¯å¦åˆ é™¤ä¸€æ¡])

æ³¨æ„ï¼šæ˜¯å¦åˆ é™¤ä¸€æ¡ trueæ˜¯ falseå¦ï¼ˆé»˜è®¤ï¼‰

```mongodb
> db.c3.remove({}, true)
> db.c3.remove({})
```

#### **å°æ€»ç»“**

å¢Create

```mongodb
> db.é›†åˆå.insert(JSONæ•°æ®)
```

åˆ Delete

```mongodb
> db.é›†åˆå.remove(æ¡ä»¶, [,æ˜¯å¦åˆ é™¤ä¸€æ¡])
```

æ”¹Update

```mongodb
> db.é›†åˆå.update(æ¡ä»¶, æ–°æ•°æ® [,æ˜¯å¦æ–°å¢ï¼Œæ˜¯å¦ä¿®æ”¹å¤šæ¡])
> db.é›†åˆå.update(æ¡ä»¶, {ä¿®æ”¹å™¨: {é”®: å€¼}})
```

æŸ¥Read

```mongodb
> db.é›†åˆå.find(æ¡ä»¶ [,æŸ¥è¯¢çš„åˆ—])
```

#### **æ’åº**

è¯­æ³•ï¼šdb.é›†åˆå.find().sort(JSONæ•°æ®)

è¯´æ˜ï¼šé”® å°±æ˜¯è¦æ’åºçš„åˆ—/å­—æ®µ å€¼ 1å‡åº -1é™åº

ç»ƒä¹ 1ï¼šå¹´é¾„å‡åº&é™åº

```mongo
> db.c1.find().sort({age: 1})
> db.c1.find().sort({age: -1})
```

ç»ƒä¹ 2ï¼šæŒ‰ç…§k1æ¥æ’åº å¦‚æœk1çš„å€¼ç›¸åŒ æŒ‰ç…§k2æ¥æ’åº 1å‡åº -1é™åº

```mongo
> db.collectionName.find().sort({k1: 1}, {k2: -1})
```

#### **Limitä¸Skipæ–¹æ³•**

è¯­æ³•ï¼šdb.é›†åˆå.find().sort().skip(æ•°å­—).limit(æ•°å­—)

è¯´æ˜ï¼šskipè·³è¿‡æŒ‡å®šæ•°é‡ï¼ˆå¯é€‰ï¼‰ï¼Œlimité™åˆ¶æŸ¥è¯¢çš„æ•°é‡

ç»ƒä¹ 1ï¼šé™åºæŸ¥è¯¢2æ¡

```mongo
> db.c1.find().sort({age: -1}).skip(0).limit(2)
```

ç»ƒä¹ 2ï¼šé™åºè·³è¿‡2æ¡å¹¶æŸ¥è¯¢2æ¡

```mongo
> db.c1.find().sort({age: -1}).skip(2).limit(2)
```

å®æˆ˜åˆ†é¡µ

éœ€æ±‚ï¼šæ•°æ®åº“ 1 - 10 æ•°æ®ï¼Œæ¯é¡µæ˜¾ç¤º2æ¡ï¼ˆ5é¡µï¼‰

è¯­æ³•ï¼šdb.é›†åˆå.find().skip().limit(2)

skipè®¡ç®—å…¬å¼ï¼š(å½“å‰é¡µ - 1) * æ¯é¡µæ˜¾ç¤ºæ¡æ•°

#### **èšåˆæŸ¥è¯¢**

è¯­æ³•ï¼š

```mongo
> db.é›†åˆåç§°.aggregate([
    {ç®¡é“: {è¡¨è¾¾å¼}}
    ...
])
```

å¸¸ç”¨ç®¡é“ï¼š

```mongo
$group  å°†é›†åˆä¸­çš„æ–‡æ¡£åˆ†ç»„ï¼Œç”¨äºç»Ÿè®¡ç»“æœ
$match  è¿‡æ»¤æ•°æ®ï¼Œåªè¦è¾“å‡ºç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£
$sort   èšåˆæ•°æ®è¿›ä¸€æ­¥æ’åº
$skip   è·³è¿‡æŒ‡å®šæ–‡æ¡£æ•°
$limit  é™åˆ¶é›†åˆæ•°æ®è¿”å›æ–‡æ¡£æ•°
...
```

å¸¸ç”¨è¡¨è¾¾å¼ï¼š

```mongo
$sum    æ€»å’Œ $sum:1åŒcountè¡¨ç¤ºç»Ÿè®¡
$avg    å¹³å‡
$min    æœ€å°å€¼
$max    æœ€å¤§å€¼
...
```

ç»ƒä¹ 1ï¼šç»Ÿè®¡ç”·ç”Ÿã€å¥³ç”Ÿçš„æ€»å¹´é¾„

```mongo
> db.é›†åˆåç§°.aggregate([
    {
        $group: {
            _id: "$sex", 
            rs: {$sum: "$age"}
        }
    }
])
```

ç»ƒä¹ 2ï¼šç»Ÿè®¡ç”·ç”Ÿã€å¥³ç”Ÿçš„æ€»äººæ•°

```mongo
> db.é›†åˆåç§°.aggregate([
    {
        $group: {
            _id: "$sex", 
            rs: {$sum: 1}
        }
    }
])
```

ç»ƒä¹ 3ï¼šæ±‚å­¦ç”Ÿæ€»æ•°å’Œå¹³å‡å¹´é¾„

```mongo
> db.é›†åˆåç§°.aggregate([
    {
        $group: {
            _id: null, 
            total_num: {$sum: 1}, 
            total_avg: {$avg: "$age"}
        }
    }
])
```

ç»ƒä¹ 4ï¼šæŸ¥è¯¢ç”·ç”Ÿã€å¥³ç”Ÿäººæ•°ï¼ŒæŒ‰äººæ•°å‡åº

```mongo
> db.é›†åˆåç§°.aggregate([
    {
        $group: {
            _id: "$sex", 
            rs: {$sum: 1}
        }
    },
    {
        $sort: {rs: 1}
    }
])
```

## **Linuxç¯å¢ƒå®‰è£…MongoDB**

- ä¸‹è½½

```shell
[root@VM-8-3-centos ~]# wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.2.tgz
```

- è§£å‹

```shell
[root@VM-8-3-centos ~]# tar -zxvf mongodb-linux-x86_64-rhel70-4.4.2.tgz
```

- å°†è§£å‹åŒ…æ‹·è´åˆ°æŒ‡å®šç›®å½•

```shell
[root@VM-8-3-centos ~]# mv mongodb-linux-x86_64-rhel70-4.4.2/ /usr/local/mongodb
```

- åˆ›å»ºæ•°æ®å­˜æ”¾ç›®å½•ä¸æ—¥å¿—å­˜æ”¾ç›®å½•

```shell
[root@VM-8-3-centos ~]# mkdir -p /usr/local/mongodb/data /usr/local/mongodb/logs
```

- å¯åŠ¨MongoDBæœåŠ¡

```shell
[root@VM-8-3-centos ~]# /usr/local/mongodb/bin/mongod --dbpath=/usr/local/mongodb/data --logpath=/usr/local/mongodb/logs/mongodb.log --logappend --port=27017 --fork
```

- åæœŸç™»å½•å³å¯

```shell
[root@VM-8-3-centos ~]# /usr/local/mongodb/bin/mongo
```

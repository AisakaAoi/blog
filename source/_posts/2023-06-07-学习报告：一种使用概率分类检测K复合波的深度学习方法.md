---
title: 学习报告：一种使用概率分类检测K复合波的深度学习方法
categories:
  - 🌙进阶学习
  - ⭐脑机接口与混合智能研究团队（BCI团队）
  - 💫学习报告
abbrlink: 43c068b9
date: 2023-06-07 01:25:17
tags:
---

本篇学习报告的内容为：一种使用概率分类检测K复合波的深度学习方法，所参考的文献是《Beyond K-complex binary scoring during sleep: probabilistic classification using deep learning》。本文算法基于深度神经网络和高斯过程，使输入波形为K复合波的概率在0%到100%之间。概率分类方法对于系统化的K复合波检测来说适合且有效，有助于深入研究睡眠过程中K复合波与临床结果之间的潜在关系。

<!--more-->

***

### 研究背景

#### 研究现状

（1）多种临床情况（睡眠相关疾病）会对K复合波的出现和特征产生影响。（K复合波可以作为生物标志物）

（2）之前的研究受到小样本量（数据量）的限制，当前的算法应用存在局限性。

（3）基于量化人工定义特征的K复合波检测算法有基于任意预定义阈值的清晰的二元（二分类）输出，然而定义清晰的阈值并非易事。

（4）DL算法的实验数据集仅为MASS，限制了算法的普适性。通过贝叶斯统计的**概率评分**，可以**量化**与训练数据选择和标签准确性相关的**不确定性**。

（5）N3阶段，K复合波和慢波的特征相似，难以区分K复合波。**N3阶段没有人工标注的K复合波，但该阶段的K复合波自动检测是有必要的。**

#### 研究目的

开发和验证一个性能良好的K复合波检测算法，该算法基于概率分类，相比目前的方法更适合在睡眠研究和医学中广泛应用。该方法的输出包括EEG记录的整体质量以及个体内部和个体之间K复合波形态差异的信息。本文还通过比较原始和手动修改输入对算法输出概率的影响，研究了算法的决策过程。

***

### 研究方法

#### 实验数据

（1）训练数据：50万个合成的K复合波，来自MASS数据集中的N2期。

（2）测试数据：克利夫兰家族研究（the Cleveland Family Study，CFS）的700份独立记录，N2以及N3期的数据。

#### 算法工作流程

包括三个步骤：数据预处理、数据平衡和使用深度学习方法进行数据分类。

{% asset_img 1.webp %}
<div align='center'>图1 K复合波检测算法的流程</div>

（1）数据预处理

a. 选择振幅大于15μV的峰作为潜在的KC（K复合波）

b. 在每个选定的峰值前后保留d=3s的数据段

c. 使用带有Symlet 3小波的离散小波变换（DWT）**对**数量为N的2*d长的**KCs和nKCs（非K复合波）样本进行分解**。小波分解向DL网络输入，返回128个系数c，它们表示0~1、1~2、2~4、4~8和8~16 Hz频段内的能量。

※ 离散小波变换的核心：

用不同频率的滤波器分析不同频率的信号，主要是高通滤波器和低通滤波器。

（2）数据平衡

平衡KCs和nKCs小波系数，因为EEG记录高度不平衡，KCs比nKC波形少得多，95%的EEG数据不含KC。因此，本文合成了KC，而不是随机选择大小相等的KC和nKC数据集，因为KC数量较少，所以数据集会很小。

※ 实现方法：

通过在现有KCs上添加高斯噪声（μ=0和σ=0.4）来创建新的KCs。平衡数据集只在包含约500000 KCs和500000nKCs的训练阶段使用。

※ 高斯噪声：

指概率密度函数服从高斯分布（即正态分布）的一类噪声。

作用：

①数据集增强的一种手段，本质是一种正则化；

②提高鲁棒性，增强模型泛化能力；

③更好地适应真实场景的应用。

（3）使用深度学习方法进行数据分类

**DKL（深度核学习）=DNN+高斯过程**（概率分类的体现）

DNN由五层组成，具有最大范数约束，包括全连接线性层、批标准化、整流线性单元、drop out层。

输入层-隐藏层-全连接层-drop out层-输出层

1000-1000-500-256-b（高斯过程的输入）

在b的每个维度上用径向基函数（RBF）核拟合高斯过程。由于非高斯似然，高斯过程训练采用随机变分推理（SVI）逼近。SVI是一种通过在M=1000的数据子集上执行训练，利用归纳点方法的近似。采用带有Nesterov动量的随机梯度下降（SGD）对模型进行优化。

#### 超参数调节和训练

（1）5折交叉验证

（2）待调整的超参数：学习率、b、drop-out率、动量

（3）训练、验证和测试集：10、5、4

（4）最有效的超参数组合由验证集上的最佳平均性能指标确定，使用测试集测试该组合。

{% asset_img 2.webp %}
<div align='center'>表1 超参数的选择范围</div>

※ 最有效的超参数组合：0.1/16/0.7/0.95

#### 模型评价和指标

召回率TPR=TP/(TP+FN)

精确度PPV=TP/(TP+FP)

F1-score=2*TPR*PPV/(TPR+PPV) （调和平均值）

#### 对算法的进一步评估

（1）KCs的大小随着年龄的增长而变化，在青春期达到最大值，然后随着年龄的增长而不断衰减。因此，本文使用CFS数据集（N=599）研究了KCs的中值得分概率随年龄变化的差异，期望年长的个体会表现出更小的中值KC概率和更小的KC峰间振幅。

（2）比较不同睡眠阶段（W/N1/N2/N3/R）的平均KCs密度。

（3）为了区分慢波和KCs，计算了N2和N3阶段中所有评分KCs上状态和下状态（N550）的比值。假设下态和上态的振幅相同，慢波上下态的比值预计在100%左右，而KCs的比值预计更小。

（4）为了进一步验证算法在慢波睡眠中的性能，从CFS数据集中被试的慢波睡眠期间随机选择500 KCs和500 nKCs，并进行人工审查。使用F1-score计算评分者间一致性和算法/评分者间一致性。

***

### 实验结果

#### 整体性能

{% asset_img 3.webp %}
<div align='center'>表2 不同算法性能指标的比较</div>

通过增加概率阈值提升PPV，然而TPR降低，F1不变。**说明概率阈值的改变并不一定会提高算法的整体性能。**

{% asset_img 4.webp %}
<div align='center'>表3 不同概率阈值对应的性能指标</div>

#### 概率评估

{% asset_img 5.webp %}
<div align='center'>图2 MASS数据集的一名受试者在N2睡眠期间的不同KC概率</div>

KCs从上到下按得分概率递增的顺序排列，其中红色表示80μV左右的正电压峰值（P900），蓝色表示-80μV左右的负电压峰值（N550）。x轴上的时间值与N550峰值对齐（t=0s）。

KC得分概率与特征峰N550和P900的幅度明显相关。这意味着较小的KCs，或存在显著噪声的KC，得分概率将低于较大且定义良好的KC。

#### 输入扰动

通过手动修改算法的输入，可以深入了解决策过程。

{% asset_img 6.webp %}
<div align='center'>表4 DNN输入频段扰动对算法性能的影响</div>

DNN输入中个别DWT频带系数的缺失会对整体算法性能产生显著影响。

#### KC概率和年龄

{% asset_img 7.webp %}
<div align='center'>图3 不同年龄段的KC中位数概率</div>

18-33岁人群的中位数概率为92.5%（图3A），然后以每10年1.2%的速率下降（线性回归控制了性别和BMI，p<0.001），随着年龄的增长，KC的峰间振幅下降（图3B）。

#### N3期的KC评分

{% asset_img 8.webp %}
<div align='center'>图4 N2与N3阶段的KC概率比较</div>

N3阶段的KCs评分非常好，这表明在N550峰之前没有一个大的正up-state峰值，这增加了评分波形是真正的KCs而不是δ波（delta波）的可信度。

{% asset_img 9.webp %}
<div align='center'>图5 N2与N3阶段的up-state/N550比率分布</div>

计算了被试所有KCs（上状态/下状态）的比值，在每个睡眠阶段取平均值。图5显示N2和N3阶段的平均值均远低于100%，意味着大多数评分波形是KCs。

#### 临床相关性和进一步的工作

{% asset_img 10.webp %}
<div align='center'>图6 不同个体的不同睡眠阶段及KC密度变化</div>

K复合波的密度能为临床诊断和睡眠监测提供更多有价值的信息。

***

### 讨论

1、本文的方法适用于个体之间和个体内部之间具有可变振幅和波形特征的K复合波，有助于探索K复合波和临床结果之间的关系。

2、K复合波似乎在前额叶皮层最强，在头皮后部和外侧区域相对较弱。所提出的算法可以通过比较不同通道的得分概率来验证这一假设，在这种情况下，从额叶到顶叶位置的概率会下降（例如，C3/C4）。值得注意的是，由于K复合波可以在局部产生，并且由于MASS仅在C3通道上提供K复合波评分，因此将本文的算法评分与C4和F4等其他通道进行有意义的比较是有问题的。未来需要对多通道的手动和自动K复合波评分进行研究，理想情况下结合高密度EEG记录，以更好地确定K复合波源定位和手动评分的关系。

3、较高的up-state/N550比值可能是由于老年人在N3期睡眠中较低的信噪比。尽管如此，本文算法在N3期中表现仍然良好。

4、评分者间的一致性（本文算法与专家评分的F1-score为0.51）

应用于更大的数据集，由多名专家对K复合波进行评分，将有助于更好地调整算法，以适应K复合波形状更大的可变性，并减少评分者之间的分歧对算法性能的影响，而不是目前算法仅有19个健康个体的数据。尽管如此，本文的概率评分能够量化这两种不确定性，将较低的概率归因于噪声较大的K复合波，将较高的概率归因于定义良好的K复合波和评分者间达成一致的K复合波。

***

### 结论

本文提出了一种基于DNN和高斯过程的K复合波检测算法。该方法的主要优点包括**概率输出和可靠的自动K复合波检测**，这对于支持系统的大规模分析是必不可少的，而传统的人工评分难以实现。**概率方法还有助于研究EEG记录的整体质量，并检查和处理样本人群中潜在的EEG差异**；对于大规模系统研究K复合波及其与临床结果的关系，关键特征可能是必要的。最后，算法在N3中的性能与之前发表的研究结果一致，说明K复合波在N3中存在并能够通过适当的方法检测到。

虽然CFS包含一些患有睡眠呼吸暂停和/或心血管疾病的被试，但**需要进一步在临床数据集中系统地测试算法结果**。已知酒精中毒、神经系统疾病和/或不安腿综合征与K复合波形状和密度的差异有关，因此值得进一步研究。

***

### 原文链接

> <https://www.scholat.com/teamwork/showPostMessage.html?id=13832>

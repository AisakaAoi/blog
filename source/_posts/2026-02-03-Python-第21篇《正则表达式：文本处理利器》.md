---
title: Python-ç¬¬21ç¯‡ã€Šæ­£åˆ™è¡¨è¾¾å¼ï¼šæ–‡æœ¬å¤„ç†åˆ©å™¨ã€‹
categories:
  - ğŸŒ™é€¢å‚æ‚è°ˆä¸æ¬è¿
  - â­æœæœè¯¾ç¨‹
abbrlink: 86b1dcdb
date: 2026-02-03 04:40:43
tags:
---

### å¯¼è¯­

æ¯å¤©é¢å¯¹æµ·é‡æ–‡æœ¬â€”â€”å‘ç¥¨å·ç ã€é“¶è¡Œè´¦å·ã€åˆåŒæ—¥æœŸã€é‡‘é¢æ•°å­—...æ‰‹åŠ¨ä¸€ä¸ªä¸ªå¤åˆ¶ç²˜è´´ï¼Ÿçœ¼ç›éƒ½çœ‹èŠ±äº†ï¼æ­£åˆ™è¡¨è¾¾å¼å°±æ˜¯ä½ çš„â€œæ–‡æœ¬æ‰«æä»ªâ€ï¼Œåªè¦å‘Šè¯‰å®ƒâ€œæ‰¾æ•°å­—â€â€œæ‰¾æ—¥æœŸâ€è¿™äº›æ¨¡å¼ï¼Œå®ƒèƒ½åœ¨1ç§’å†…ä»å‡ ç™¾é¡µPDFé‡Œç²¾å‡†æå–æ‰€æœ‰ä¿¡æ¯ã€‚ä»Šå¤©å’±ä»¬æŒæ¡è¿™é—¨â€œæ•°æ®æå–é­”æ³•â€ï¼Œä»æ­¤å‘Šåˆ«æœºæ¢°é‡å¤çš„å¤åˆ¶ç²˜è´´ï¼

<!--more-->

***

### æœ¬ç¯‡ç›®æ ‡

- ç†è§£æ­£åˆ™è¡¨è¾¾å¼çš„â€œæ¨¡å¼â€æ¦‚å¿µ
- æŒæ¡å¸¸ç”¨è´¢åŠ¡æ•°æ®åŒ¹é…è§„åˆ™ï¼ˆé‡‘é¢ã€æ—¥æœŸã€å‘ç¥¨å·ï¼‰
- å­¦ä¼šä»æ··ä¹±æ–‡æœ¬ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯
- å®æˆ˜ï¼šè‡ªåŠ¨è§£æè´¢åŠ¡æŠ¥è¡¨å¹¶ç”ŸæˆExcel
- è·å¾—æ­£åˆ™è¡¨è¾¾å¼â€œå°æŠ„â€ï¼Œéšæ—¶æŸ¥é˜…

***

### ä¸€ã€å‡†å¤‡å·¥ä½œï¼šæ— éœ€å®‰è£…ï¼Œå¼€ç®±å³ç”¨

æ­£åˆ™è¡¨è¾¾å¼æ˜¯Pythonå†…ç½®çš„reæ¨¡å—ï¼Œæ— éœ€å®‰è£…ï¼š

```python
import re  # ç›´æ¥å¯¼å…¥å°±èƒ½ç”¨

# æµ‹è¯•ä¸€ä¸‹
text = "å‘ç¥¨å·ï¼šINV20250012345ï¼Œé‡‘é¢ï¼šÂ¥15,800.50"
print("âœ… æ­£åˆ™è¡¨è¾¾å¼æ¨¡å—åŠ è½½æˆåŠŸï¼")
```

***

### äºŒã€ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Ÿ

**æ­£åˆ™è¡¨è¾¾å¼ = ç»™æ–‡æœ¬å®šçš„â€œæœç´¢æ¨¡æ¿â€**

å°±åƒè´¢åŠ¡æŸ¥è´¦ï¼š
- æ‰¾å‘ç¥¨å· â†’ æ¨¡å¼ï¼šå­—æ¯å¼€å¤´+å¹´ä»½+æµæ°´å·
- æ‰¾é‡‘é¢ â†’ æ¨¡å¼ï¼šÂ¥ç¬¦å·+æ•°å­—+å¯èƒ½æœ‰çš„é€—å·+å°æ•°ç‚¹

```python
# ========== ç¬¬ä¸€ä¸ªæ­£åˆ™ï¼šæ‰¾æ•°å­— ==========
# åœºæ™¯ï¼šä»"æŠ¥é”€é‡‘é¢Â¥3,250.50å…ƒ"ä¸­æå–æ•°å­—

text = "æŠ¥é”€é‡‘é¢Â¥3,250.50å…ƒï¼Œå®æŠ¥Â¥3,000.00"

# æ¨¡å¼ï¼š\d+ åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—
numbers = re.findall(r'\d+', text)  # rè¡¨ç¤ºåŸå§‹å­—ç¬¦ä¸²ï¼Œé¿å…è½¬ä¹‰é—®é¢˜
print(f"æ‰¾åˆ°çš„æ•°å­—ï¼š{numbers}")
# è¾“å‡ºï¼š['3', '250', '50', '3', '000', '00']

# æ”¹è¿›ï¼šåŒ¹é…å¸¦é€—å·å’Œå°æ•°çš„å®Œæ•´é‡‘é¢
amounts = re.findall(r'\d[\d,]*\.?\d*', text)
print(f"æ‰¾åˆ°çš„é‡‘é¢ï¼š{amounts}")
# è¾“å‡ºï¼š['3,250.50', '3,000.00']

# ç»§ç»­æ”¹è¿›ï¼šåŒ¹é…å¸¦è´§å¸ç¬¦å·çš„é‡‘é¢
full_amounts = re.findall(r'Â¥\d[\d,]*\.?\d*', text)
print(f"å¸¦ç¬¦å·çš„é‡‘é¢ï¼š{full_amounts}")
# è¾“å‡ºï¼š['Â¥3,250.50', 'Â¥3,000.00']
```

***

### ä¸‰ã€è´¢åŠ¡æ•°æ®åŒ¹é…æ¨¡å¼è¯¦è§£

#### 3.1 åŒ¹é…é‡‘é¢ï¼ˆæœ€å¸¸ç”¨ï¼‰

```python
# ========== é‡‘é¢åŒ¹é…ä¸‡èƒ½å…¬å¼ ==========
def extract_money(text: str) -> list:
    """
    ä»æ–‡æœ¬ä¸­æå–æ‰€æœ‰é‡‘é¢
    æ”¯æŒæ ¼å¼ï¼šÂ¥1,234.56 æˆ– 1234.56å…ƒ æˆ– 1234.56
    """
    # æ¨¡å¼è§£é‡Šï¼š
    # Â¥?        â†’ Â¥ç¬¦å·å¯é€‰ï¼ˆ?è¡¨ç¤º0æˆ–1ä¸ªï¼‰
    # \d+       â†’ è‡³å°‘ä¸€ä½æ•°å­—
    # (,\d{3})* â†’ é€—å·åŠ ä¸‰ä½æ•°å­—ï¼Œé‡å¤0æ¬¡æˆ–å¤šæ¬¡ï¼ˆåŒ¹é…åƒåˆ†ä½ï¼‰
    # \.?\d*    â†’ å°æ•°ç‚¹å’Œæ•°å­—å¯é€‰ï¼ˆåŒ¹é…å°æ•°éƒ¨åˆ†ï¼‰
    # å…ƒ?        â†’ "å…ƒ"å­—å¯é€‰
    
    pattern = r'Â¥?\d+(,\d{3})*\.?\d*\s*å…ƒ?'
    
    matches = re.findall(pattern, text)
    
    # æ¸…ç†ç»“æœï¼ˆå»æ‰é€—å·å’Œ"å…ƒ"ï¼‰
    clean_amounts = []
    for match in matches:
        # éœ€è¦å®Œæ•´åŒ¹é…ï¼Œä¸Šé¢findallè¿”å›çš„æ˜¯å…ƒç»„ï¼Œè¿™é‡Œä¿®æ­£
        pass
    
    # ä¿®æ­£åçš„æ¨¡å¼
    pattern = r'Â¥?(\d+(?:,\d{3})*\.?\d*)\s*å…ƒ?'
    matches = re.findall(pattern, text)
    
    # è½¬æ¢ä¸ºæµ®ç‚¹æ•°
    amounts = []
    for amount_str in matches:
        try:
            clean_amount = amount_str.replace(',', '')
            amount = float(clean_amount)
            if amount > 0:  # åªä¿ç•™æ­£æ•°
                amounts.append(amount)
        except:
            continue
    
    return amounts

# æµ‹è¯•
text = """
æœ¬æœˆè´¹ç”¨ï¼šåŠå…¬ç”¨å“Â¥1,250.00å…ƒï¼Œäº¤é€šè´¹800å…ƒï¼Œæ‹›å¾…è´¹Â¥2,580.50ã€‚
å€Ÿæ¬¾ï¼šå¤‡ç”¨é‡‘5,000.00å…ƒã€‚
"""
amounts = extract_money(text)
print(f"æå–åˆ°çš„é‡‘é¢ï¼š{amounts}")
# è¾“å‡ºï¼š[1250.0, 800.0, 2580.5, 5000.0]
```

***

#### 3.2 åŒ¹é…æ—¥æœŸ

```python
# ========== æ—¥æœŸåŒ¹é… ==========
def extract_dates(text: str) -> list:
    """
    æå–æ—¥æœŸï¼ˆæ”¯æŒYYYY-MM-DDã€YYYY/MM/DDã€YYYYå¹´MMæœˆDDæ—¥ï¼‰
    """
    # æ¨¡å¼ï¼šåŒ¹é…2025-01-26æˆ–2025/01/26æˆ–2025å¹´01æœˆ26æ—¥
    pattern = r'(\d{4})[-/å¹´](\d{1,2})[-/æœˆ](\d{1,2})æ—¥?'
    
    matches = re.findall(pattern, text)
    
    dates = []
    for year, month, day in matches:
        try:
            # éªŒè¯æ—¥æœŸåˆæ³•æ€§
            date_str = f"{year}-{month.zfill(2)}-{day.zfill(2)}"
            datetime.strptime(date_str, '%Y-%m-%d')
            dates.append(date_str)
        except:
            continue
    
    return dates

# æµ‹è¯•
text = "åˆåŒæ—¥æœŸï¼š2025-01-26ï¼Œä»˜æ¬¾æˆªæ­¢2025/02/15ï¼Œå‘ç¥¨æ—¥æœŸ2025å¹´03æœˆ01æ—¥"
dates = extract_dates(text)
print(f"æå–åˆ°çš„æ—¥æœŸï¼š{dates}")
# è¾“å‡ºï¼š['2025-01-26', '2025-02-15', '2025-03-01']
```

***

#### 3.3 åŒ¹é…å‘ç¥¨å·/é“¶è¡Œè´¦å·

```python
# ========== å‘ç¥¨å·/é“¶è¡Œè´¦å·åŒ¹é… ==========
def extract_invoice_numbers(text: str) -> list:
    """
    æå–å‘ç¥¨å·ï¼ˆæ¨¡å¼ï¼šå­—æ¯+æ•°å­—ï¼‰
    """
    # æ¨¡å¼ï¼š2-4ä½å¤§å†™å­—æ¯ + 8-12ä½æ•°å­—
    pattern = r'[A-Z]{2,4}\d{8,12}'
    
    return re.findall(pattern, text)

def extract_bank_accounts(text: str) -> list:
    """
    æå–é“¶è¡Œè´¦å·ï¼ˆ16-19ä½æ•°å­—ï¼‰
    """
    pattern = r'\d{16,19}'
    
    return re.findall(pattern, text)

# æµ‹è¯•
text = """
å‘ç¥¨å·ï¼šINV2025123456ï¼Œä»£ç ï¼šFP202500123456
è½¬è´¦è´¦å·ï¼š6222021234567890123ï¼Œå¤‡ç”¨é‡‘å¡ï¼š95588012345678
"""

invoices = extract_invoice_numbers(text)
accounts = extract_bank_accounts(text)

print(f"å‘ç¥¨å·ï¼š{invoices}")
print(f"é“¶è¡Œè´¦å·ï¼š{accounts}")
```

***

### å››ã€ä»æ··ä¹±æ–‡æœ¬ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯

```python
# ========== è´¢åŠ¡æŠ¥è¡¨æ–‡æœ¬è§£æå™¨ ==========
def parse_financial_report(text: str) -> dict:
    """
    è§£æè´¢åŠ¡æŠ¥å‘Šçš„æ··åˆæ–‡æœ¬ï¼Œæå–ç»“æ„åŒ–ä¿¡æ¯
    """
    result = {
        'æŠ¥å‘Šæ—¥æœŸ': None,
        'å…¬å¸åç§°': None,
        'æ€»è¥æ”¶': 0,
        'å‡€åˆ©æ¶¦': 0,
        'ä¸»è¦æ”¶å…¥é¡¹': [],
        'å‘ç¥¨åˆ—è¡¨': []
    }
    
    # 1. æå–æ—¥æœŸ
    dates = extract_dates(text)
    if dates:
        result['æŠ¥å‘Šæ—¥æœŸ'] = dates[0]
    
    # 2. æå–å…¬å¸åç§°ï¼ˆæ¨¡å¼ï¼šXXæœ‰é™å…¬å¸ï¼‰
    company_pattern = r'[\u4e00-\u9fa5]+æœ‰é™å…¬å¸'
    company_match = re.search(company_pattern, text)
    if company_match:
        result['å…¬å¸åç§°'] = company_match.group()
    
    # 3. æå–é‡‘é¢ï¼ˆè¥æ”¶å’Œå‡€åˆ©æ¶¦é€šå¸¸åœ¨ç‰¹å®šå…³é”®åï¼‰
    amounts = extract_money(text)
    
    # æ‰¾"è¥æ”¶"æˆ–"æ”¶å…¥"åçš„ç¬¬ä¸€ä¸ªå¤§æ•°å­—
    revenue_match = re.search(r'è¥æ”¶[^\d]*Â¥?(\d[,\d]*\.?\d*)', text)
    if revenue_match:
        try:
            revenue = float(revenue_match.group(1).replace(',', ''))
            result['æ€»è¥æ”¶'] = revenue
        except:
            pass
    
    # æ‰¾"å‡€åˆ©æ¶¦"åçš„æ•°å­—
    profit_match = re.search(r'å‡€åˆ©æ¶¦[^\d]*Â¥?(\d[,\d]*\.?\d*)', text)
    if profit_match:
        try:
            profit = float(profit_match.group(1).replace(',', ''))
            result['å‡€åˆ©æ¶¦'] = profit
        except:
            pass
    
    # 4. æå–æ‰€æœ‰æ”¶å…¥é¡¹ï¼ˆæ¨¡å¼ï¼šé¡¹ç›®åç§°+é‡‘é¢ï¼‰
    # ä¾‹å¦‚ï¼š"äº§å“é”€å”®æ”¶å…¥Â¥1,250,000.00"
    income_items = re.findall(r'([\u4e00-\u9fa5]+æ”¶å…¥)[^\d]*Â¥?(\d[,\d]*\.?\d*)', text)
    for name, amount in income_items:
        try:
            result['ä¸»è¦æ”¶å…¥é¡¹'].append({
                'åç§°': name,
                'é‡‘é¢': float(amount.replace(',', ''))
            })
        except:
            continue
    
    # 5. æå–å‘ç¥¨å·
    result['å‘ç¥¨åˆ—è¡¨'] = extract_invoice_numbers(text)
    
    return result

# æµ‹è¯•è§£æ
report_text = """
2025å¹´01æœˆè´¢åŠ¡æŠ¥å‘Š
æ™ºæ…§è´¢åŠ¡ç§‘æŠ€æœ‰é™å…¬å¸

ä¸€ã€æ€»ä½“æƒ…å†µ
æŠ¥å‘Šæ—¥æœŸï¼š2025-01-26
æœ¬æœˆæ€»è¥æ”¶Â¥2,580,000.00å…ƒï¼Œå‡€åˆ©æ¶¦Â¥450,000.00å…ƒã€‚

äºŒã€æ”¶å…¥æ˜ç»†
äº§å“é”€å”®æ”¶å…¥Â¥1,250,000.00
æŠ€æœ¯æœåŠ¡æ”¶å…¥Â¥800,000.00
å’¨è¯¢æ”¶å…¥Â¥530,000.00

ä¸‰ã€è´¹ç”¨æ˜ç»†
ç›¸å…³å‘ç¥¨ï¼šINV2025001234ã€INV2025005678
"""

result = parse_financial_report(report_text)
print("\nç»“æ„åŒ–æå–ç»“æœï¼š")
print(json.dumps(result, ensure_ascii=False, indent=2))
```

***

### äº”ã€å®æˆ˜ï¼šæ‰¹é‡è§£æè´¢åŠ¡æŠ¥è¡¨æ–‡ä»¶

#### 5.1 å¤„ç†å•ä¸ªPDF/PPTæ–‡æœ¬

```python
# ========== æ‰¹é‡è§£ææ–‡ä»¶å¤¹ä¸­çš„æŠ¥è¡¨ ==========
def batch_parse_reports(folder_path: str):
    """
    æ‰¹é‡è§£ææ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡æœ¬æ–‡ä»¶
    å‡è®¾æ–‡ä»¶å·²è½¬æ¢ä¸º.txtæ ¼å¼
    """
    import glob
    
    # æŸ¥æ‰¾æ‰€æœ‰txtæ–‡ä»¶
    files = glob.glob(os.path.join(folder_path, "*.txt"))
    
    if not files:
        print("âš ï¸ æœªæ‰¾åˆ°txtæ–‡ä»¶ï¼Œè¯·å…ˆè½¬æ¢PDF/PPTä¸ºæ–‡æœ¬")
        return
    
    all_results = []
    
    for filepath in files:
        try:
            print(f"\nğŸ“„ å¤„ç†: {os.path.basename(filepath)}")
            
            # è¯»å–æ–‡ä»¶å†…å®¹
            with open(filepath, 'r', encoding='utf-8') as f:
                text = f.read()
            
            # è§£æ
            result = parse_financial_report(text)
            result['æ–‡ä»¶'] = os.path.basename(filepath)
            result['å¤„ç†æ—¶é—´'] = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            
            all_results.append(result)
            
            print(f"âœ… æå–åˆ°è¥æ”¶: Â¥{result['æ€»è¥æ”¶']:,.2f}ï¼Œå‡€åˆ©æ¶¦: Â¥{result['å‡€åˆ©æ¶¦']:,.2f}")
            
        except Exception as e:
            print(f"âŒ å¤„ç†å¤±è´¥: {e}")
            continue
    
    # ä¿å­˜ç»“æœ
    if all_results:
        df = pd.DataFrame(all_results)
        output_file = f"è´¢åŠ¡æŠ¥è¡¨æ±‡æ€»_{datetime.now().strftime('%Y%m%d')}.xlsx"
        df.to_excel(output_file, index=False)
        print(f"\nğŸ‰ æ±‡æ€»å®Œæˆï¼Œä¿å­˜è‡³: {output_file}")
        
        return df
    
    return None

# åˆ›å»ºæµ‹è¯•æ–‡ä»¶
def create_test_files():
    """åˆ›å»ºæµ‹è¯•ç”¨çš„æŠ¥è¡¨æ–‡ä»¶"""
    os.makedirs("è´¢åŠ¡æŠ¥å‘Š", exist_ok=True)
    
    # æŠ¥å‘Š1
    report1 = """
    2025å¹´01æœˆè´¢åŠ¡æŠ¥å‘Š
    æ™ºæ…§è´¢åŠ¡ç§‘æŠ€æœ‰é™å…¬å¸
    æŠ¥å‘Šæ—¥æœŸï¼š2025-01-26
    æœ¬æœˆæ€»è¥æ”¶Â¥2,580,000.00å…ƒï¼Œå‡€åˆ©æ¶¦Â¥450,000.00å…ƒã€‚
    äº§å“é”€å”®æ”¶å…¥Â¥1,250,000.00
    æŠ€æœ¯æœåŠ¡æ”¶å…¥Â¥800,000.00
    å‘ç¥¨ï¼šINV2025001234
    """
    
    with open("è´¢åŠ¡æŠ¥å‘Š/2025å¹´01æœˆæŠ¥å‘Š.txt", 'w', encoding='utf-8') as f:
        f.write(report1)
    
    # æŠ¥å‘Š2
    report2 = """
    2025å¹´02æœˆè´¢åŠ¡æŠ¥å‘Š
    æ™ºæ…§è´¢åŠ¡ç§‘æŠ€æœ‰é™å…¬å¸
    æŠ¥å‘Šæ—¥æœŸï¼š2025-02-26
    æœ¬æœˆæ€»è¥æ”¶Â¥3,120,000.00å…ƒï¼Œå‡€åˆ©æ¶¦Â¥580,000.00å…ƒã€‚
    äº§å“é”€å”®æ”¶å…¥Â¥1,500,000.00
    å’¨è¯¢æ”¶å…¥Â¥620,000.00
    å‘ç¥¨ï¼šINV2025005678
    """
    
    with open("è´¢åŠ¡æŠ¥å‘Š/2025å¹´02æœˆæŠ¥å‘Š.txt", 'w', encoding='utf-8') as f:
        f.write(report2)
    
    print("âœ… æµ‹è¯•æ–‡ä»¶åˆ›å»ºå®Œæˆï¼Œåœ¨'è´¢åŠ¡æŠ¥å‘Š'æ–‡ä»¶å¤¹")

# æµ‹è¯•æ‰¹é‡å¤„ç†
# create_test_files()
# df = batch_parse_reports("è´¢åŠ¡æŠ¥å‘Š")
# if df is not None:
#     print("\næ±‡æ€»ç»“æœé¢„è§ˆï¼š")
#     print(df[['æ–‡ä»¶', 'æŠ¥å‘Šæ—¥æœŸ', 'æ€»è¥æ”¶', 'å‡€åˆ©æ¶¦']].to_string())
```

***

### å…­ã€å®Œæ•´é¡¹ç›®ï¼šè´¢åŠ¡æŠ¥è¡¨æ™ºèƒ½è§£æå™¨

```python
# ========== è´¢åŠ¡æŠ¥è¡¨æ™ºèƒ½è§£æå™¨ - å®Œæ•´ç‰ˆ ==========
import re
import os
import json
import pandas as pd
from datetime import datetime
import glob

class FinancialReportParser:
    """è´¢åŠ¡æŠ¥è¡¨è§£æå™¨"""
    
    def __init__(self):
        self.results = []
    
    def extract_money(self, text: str) -> list:
        """æå–é‡‘é¢"""
        pattern = r'Â¥?(\d+(?:,\d{3})*\.?\d*)\s*å…ƒ?'
        matches = re.findall(pattern, text)
        
        amounts = []
        for match in matches:
            try:
                clean = match.replace(',', '')
                amount = float(clean)
                if amount > 0:
                    amounts.append(amount)
            except:
                continue
        return amounts
    
    def extract_dates(self, text: str) -> list:
        """æå–æ—¥æœŸ"""
        pattern = r'(\d{4})[-/å¹´](\d{1,2})[-/æœˆ](\d{1,2})æ—¥?'
        matches = re.findall(pattern, text)
        
        dates = []
        for year, month, day in matches:
            try:
                date_str = f"{year}-{month.zfill(2)}-{day.zfill(2)}"
                datetime.strptime(date_str, '%Y-%m-%d')
                dates.append(date_str)
            except:
                continue
        return dates
    
    def extract_invoice_numbers(self, text: str) -> list:
        """æå–å‘ç¥¨å·"""
        pattern = r'[A-Z]{2,4}\d{8,12}'
        return re.findall(pattern, text)
    
    def parse_report(self, text: str, filename: str = "") -> dict:
        """
        è§£æå•ä»½è´¢åŠ¡æŠ¥å‘Š
        
        è¾“å‡ºç»“æ„ï¼š
        {
            'æ–‡ä»¶': 'æ–‡ä»¶å',
            'æŠ¥å‘Šæ—¥æœŸ': '2025-01-26',
            'å…¬å¸åç§°': 'XXXæœ‰é™å…¬å¸',
            'æ€»è¥æ”¶': 2580000.0,
            'å‡€åˆ©æ¶¦': 450000.0,
            'ä¸»è¦æ”¶å…¥é¡¹': [{'åç§°': 'XXæ”¶å…¥', 'é‡‘é¢': 1250000.0}, ...],
            'å‘ç¥¨åˆ—è¡¨': ['INV2025001234', ...]
        }
        """
        result = {
            'æ–‡ä»¶': filename,
            'æŠ¥å‘Šæ—¥æœŸ': None,
            'å…¬å¸åç§°': None,
            'æ€»è¥æ”¶': 0,
            'å‡€åˆ©æ¶¦': 0,
            'ä¸»è¦æ”¶å…¥é¡¹': [],
            'å‘ç¥¨åˆ—è¡¨': []
        }
        
        # æå–æ—¥æœŸ
        dates = self.extract_dates(text)
        if dates:
            result['æŠ¥å‘Šæ—¥æœŸ'] = dates[0]
        
        # æå–å…¬å¸åç§°
        company_pattern = r'[\u4e00-\u9fa5]+æœ‰é™å…¬å¸'
        company_match = re.search(company_pattern, text)
        if company_match:
            result['å…¬å¸åç§°'] = company_match.group()
        
        # æå–è¥æ”¶
        revenue_match = re.search(r'è¥æ”¶[^\d]*Â¥?(\d[,\d]*\.?\d*)', text)
        if revenue_match:
            try:
                result['æ€»è¥æ”¶'] = float(revenue_match.group(1).replace(',', ''))
            except:
                pass
        
        # æå–å‡€åˆ©æ¶¦
        profit_match = re.search(r'å‡€åˆ©æ¶¦[^\d]*Â¥?(\d[,\d]*\.?\d*)', text)
        if profit_match:
            try:
                result['å‡€åˆ©æ¶¦'] = float(profit_match.group(1).replace(',', ''))
            except:
                pass
        
        # æå–æ”¶å…¥é¡¹
        income_items = re.findall(r'([\u4e00-\u9fa5]+æ”¶å…¥)[^\d]*Â¥?(\d[,\d]*\.?\d*)', text)
        for name, amount in income_items:
            try:
                result['ä¸»è¦æ”¶å…¥é¡¹'].append({
                    'åç§°': name,
                    'é‡‘é¢': float(amount.replace(',', ''))
                })
            except:
                continue
        
        # æå–å‘ç¥¨å·
        result['å‘ç¥¨åˆ—è¡¨'] = self.extract_invoice_numbers(text)
        
        return result
    
    def parse_file(self, filepath: str) -> dict:
        """è§£æå•ä¸ªæ–‡ä»¶"""
        try:
            print(f"\nğŸ“„ å¤„ç†: {os.path.basename(filepath)}")
            
            # è¯»å–æ–‡ä»¶
            with open(filepath, 'r', encoding='utf-8') as f:
                text = f.read()
            
            # è§£æ
            result = self.parse_report(text, os.path.basename(filepath))
            result['å¤„ç†æ—¶é—´'] = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            
            return result
            
        except Exception as e:
            print(f"âŒ æ–‡ä»¶å¤„ç†å¤±è´¥: {e}")
            return None
    
    def parse_folder(self, folder_path: str) -> pd.DataFrame:
        """è§£ææ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶"""
        # æŸ¥æ‰¾æ–‡ä»¶
        files = glob.glob(os.path.join(folder_path, "*.txt"))
        
        if not files:
            print("âš ï¸ æœªæ‰¾åˆ°txtæ–‡ä»¶")
            return pd.DataFrame()
        
        self.results = []
        success = 0
        
        for filepath in files:
            result = self.parse_file(filepath)
            if result:
                self.results.append(result)
                success += 1
        
        print(f"\nâœ… æˆåŠŸå¤„ç† {success}/{len(files)} ä¸ªæ–‡ä»¶")
        
        # è½¬æ¢ä¸ºDataFrame
        if self.results:
            df = pd.DataFrame(self.results)
            
            # å±•å¹³æ”¶å…¥é¡¹
            df['æ”¶å…¥é¡¹æ•°é‡'] = df['ä¸»è¦æ”¶å…¥é¡¹'].apply(len)
            df['å‘ç¥¨æ•°é‡'] = df['å‘ç¥¨åˆ—è¡¨'].apply(len)
            
            return df
        
        return pd.DataFrame()
    
    def save_to_excel(self, df: pd.DataFrame, output_path: str = None):
        """ä¿å­˜ç»“æœåˆ°Excel"""
        if df.empty:
            print("âš ï¸ æ— æ•°æ®å¯ä¿å­˜")
            return
        
        if output_path is None:
            output_path = f"è´¢åŠ¡æŠ¥è¡¨æ±‡æ€»_{datetime.now().strftime('%Y%m%d')}.xlsx"
        
        try:
            # åˆ›å»ºExcelWriterä»¥æ”¯æŒå¤šä¸ªsheet
            with pd.ExcelWriter(output_path, engine='openpyxl') as writer:
                # æ±‡æ€»è¡¨
                summary_cols = ['æ–‡ä»¶', 'æŠ¥å‘Šæ—¥æœŸ', 'å…¬å¸åç§°', 'æ€»è¥æ”¶', 'å‡€åˆ©æ¶¦', 'æ”¶å…¥é¡¹æ•°é‡', 'å‘ç¥¨æ•°é‡']
                df[summary_cols].to_excel(writer, sheet_name='æ±‡æ€»', index=False)
                
                # è¯¦ç»†æ”¶å…¥è¡¨
                detail_rows = []
                for _, row in df.iterrows():
                    for item in row['ä¸»è¦æ”¶å…¥é¡¹']:
                        detail_rows.append({
                            'æ–‡ä»¶': row['æ–‡ä»¶'],
                            'æŠ¥å‘Šæ—¥æœŸ': row['æŠ¥å‘Šæ—¥æœŸ'],
                            'æ”¶å…¥åç§°': item['åç§°'],
                            'é‡‘é¢': item['é‡‘é¢']
                        })
                
                if detail_rows:
                    detail_df = pd.DataFrame(detail_rows)
                    detail_df.to_excel(writer, sheet_name='æ”¶å…¥æ˜ç»†', index=False)
                
                # å‘ç¥¨åˆ—è¡¨
                invoice_rows = []
                for _, row in df.iterrows():
                    for inv in row['å‘ç¥¨åˆ—è¡¨']:
                        invoice_rows.append({
                            'æ–‡ä»¶': row['æ–‡ä»¶'],
                            'æŠ¥å‘Šæ—¥æœŸ': row['æŠ¥å‘Šæ—¥æœŸ'],
                            'å‘ç¥¨å·': inv
                        })
                
                if invoice_rows:
                    inv_df = pd.DataFrame(invoice_rows)
                    inv_df.to_excel(writer, sheet_name='å‘ç¥¨æ¸…å•', index=False)
            
            print(f"âœ… ExcelæŠ¥å‘Šå·²ç”Ÿæˆ: {output_path}")
            
        except Exception as e:
            print(f"âŒ ä¿å­˜Excelå¤±è´¥: {e}")

def create_sample_data():
    """åˆ›å»ºç¤ºä¾‹æ–‡ä»¶"""
    os.makedirs("è´¢åŠ¡æŠ¥è¡¨", exist_ok=True)
    
    # åˆ›å»º3ä¸ªç¤ºä¾‹æŠ¥å‘Š
    reports = [
        {
            "filename": "2025-01-è´¢åŠ¡æŠ¥å‘Š.txt",
            "content": """
            æ™ºæ…§è´¢åŠ¡ç§‘æŠ€æœ‰é™å…¬å¸ 2025å¹´1æœˆè´¢åŠ¡æŠ¥å‘Š
            æŠ¥å‘Šæ—¥æœŸï¼š2025-01-26
            
            æœ¬æœˆå®ç°æ€»è¥æ”¶Â¥2,580,000.00å…ƒï¼Œå‡€åˆ©æ¶¦Â¥450,000.00å…ƒã€‚
            
            æ”¶å…¥æ„æˆï¼š
            äº§å“é”€å”®æ”¶å…¥Â¥1,250,000.00
            æŠ€æœ¯æœåŠ¡æ”¶å…¥Â¥800,000.00
            å’¨è¯¢æ”¶å…¥Â¥530,000.00
            
            ç›¸å…³å‘ç¥¨ï¼šINV2025001234ã€INV2025001235
            """
        },
        {
            "filename": "2025-02-è´¢åŠ¡æŠ¥å‘Š.txt",
            "content": """
            æ™ºæ…§è´¢åŠ¡ç§‘æŠ€æœ‰é™å…¬å¸ 2025å¹´2æœˆè´¢åŠ¡æŠ¥å‘Š
            æŠ¥å‘Šæ—¥æœŸï¼š2025-02-26
            
            æœ¬æœˆå®ç°æ€»è¥æ”¶Â¥3,120,000.00å…ƒï¼Œå‡€åˆ©æ¶¦Â¥580,000.00å…ƒã€‚
            
            æ”¶å…¥æ„æˆï¼š
            äº§å“é”€å”®æ”¶å…¥Â¥1,500,000.00
            æŠ€æœ¯æœåŠ¡æ”¶å…¥Â¥920,000.00
            åŸ¹è®­æ”¶å…¥Â¥700,000.00
            
            ç›¸å…³å‘ç¥¨ï¼šINV2025005678
            """
        },
        {
            "filename": "2025-03-è´¢åŠ¡æŠ¥å‘Š.txt",
            "content": """
            æ™ºæ…§è´¢åŠ¡ç§‘æŠ€æœ‰é™å…¬å¸ 2025å¹´3æœˆè´¢åŠ¡æŠ¥å‘Š
            æŠ¥å‘Šæ—¥æœŸï¼š2025-03-26
            
            æœ¬æœˆå®ç°æ€»è¥æ”¶Â¥2,950,000.00å…ƒï¼Œå‡€åˆ©æ¶¦Â¥520,000.00å…ƒã€‚
            
            æ”¶å…¥æ„æˆï¼š
            äº§å“é”€å”®æ”¶å…¥Â¥1,400,000.00
            æŠ€æœ¯æœåŠ¡æ”¶å…¥Â¥850,000.00
            å’¨è¯¢æ”¶å…¥Â¥700,000.00
            
            ç›¸å…³å‘ç¥¨ï¼šINV2025009012ã€INV2025009013ã€INV2025009014
            """
        }
    ]
    
    for report in reports:
        with open(f"è´¢åŠ¡æŠ¥è¡¨/{report['filename']}", 'w', encoding='utf-8') as f:
            f.write(report['content'])
    
    print("âœ… ç¤ºä¾‹æ•°æ®å·²åˆ›å»ºåœ¨'è´¢åŠ¡æŠ¥è¡¨'æ–‡ä»¶å¤¹")

def main():
    """ä¸»èœå•"""
    parser = FinancialReportParser()
    
    print("=" * 55)
    print("è´¢åŠ¡æŠ¥è¡¨æ™ºèƒ½è§£æå™¨")
    print("=" * 55)
    
    while True:
        print("\n" + "=" * 45)
        print("åŠŸèƒ½èœå•")
        print("=" * 45)
        print("1. åˆ›å»ºç¤ºä¾‹æ•°æ®")
        print("2. è§£æå•ä¸ªæ–‡ä»¶")
        print("3. è§£ææ•´ä¸ªæ–‡ä»¶å¤¹")
        print("4. é€€å‡º")
        print("=" * 45)
        
        choice = input("è¯·é€‰æ‹©: ").strip()
        
        if choice == "1":
            create_sample_data()
        
        elif choice == "2":
            filepath = input("æ–‡ä»¶è·¯å¾„: ").strip()
            if not os.path.exists(filepath):
                print("âŒ æ–‡ä»¶ä¸å­˜åœ¨")
                continue
            
            result = parser.parse_file(filepath)
            if result:
                print("\nè§£æç»“æœï¼š")
                print(json.dumps(result, ensure_ascii=False, indent=2))
        
        elif choice == "3":
            folder = input("æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆç›´æ¥å›è½¦ç”¨'è´¢åŠ¡æŠ¥è¡¨'ï¼‰: ").strip() or "è´¢åŠ¡æŠ¥è¡¨"
            if not os.path.exists(folder):
                print("âŒ æ–‡ä»¶å¤¹ä¸å­˜åœ¨")
                continue
            
            df = parser.parse_folder(folder)
            if not df.empty:
                print("\næ±‡æ€»é¢„è§ˆï¼š")
                print(df[['æ–‡ä»¶', 'æŠ¥å‘Šæ—¥æœŸ', 'æ€»è¥æ”¶', 'å‡€åˆ©æ¶¦']].to_string())
                
                save = input("\næ˜¯å¦ä¿å­˜ä¸ºExcelï¼Ÿ(y/n): ").strip()
                if save.lower() == 'y':
                    parser.save_to_excel(df)
            else:
                print("âš ï¸ æ²¡æœ‰è§£æåˆ°æœ‰æ•ˆæ•°æ®")
        
        elif choice == "4":
            print("ğŸ‘‹ å†è§ï¼")
            break
        
        else:
            print("è¯·è¾“å…¥1-4ï¼")

if __name__ == "__main__":
    main()
```

***

### ä¸ƒã€çŸ¥è¯†ç‚¹åŠ æ²¹ç«™

#### 7.1 æ­£åˆ™è¡¨è¾¾å¼â€œå°æŠ„â€

```python
"""
å¸¸ç”¨å…ƒå­—ç¬¦ï¼š
.       åŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆé™¤æ¢è¡Œç¬¦ï¼‰
\d      åŒ¹é…æ•°å­— [0-9]
\D      åŒ¹é…éæ•°å­—
\w      åŒ¹é…å­—æ¯/æ•°å­—/ä¸‹åˆ’çº¿
\W      åŒ¹é…éå­—æ¯/æ•°å­—/ä¸‹åˆ’çº¿
\s      åŒ¹é…ç©ºç™½ï¼ˆç©ºæ ¼/Tabï¼‰
\S      åŒ¹é…éç©ºç™½

é‡è¯ï¼š
*       0æ¬¡æˆ–å¤šæ¬¡
+       1æ¬¡æˆ–å¤šæ¬¡
?       0æ¬¡æˆ–1æ¬¡
{n}     æ°å¥½næ¬¡
{n,}    è‡³å°‘næ¬¡
{n,m}   nåˆ°mæ¬¡

è¾¹ç•Œï¼š
^       å­—ç¬¦ä¸²å¼€å¤´
$       å­—ç¬¦ä¸²ç»“å°¾
\b      å•è¯è¾¹ç•Œ

åˆ†ç»„ä¸é€‰æ‹©ï¼š
()      åˆ†ç»„ï¼Œå¯ç”¨äºæå–
[]      å­—ç¬¦é›†åˆ
|       æˆ–ï¼ˆabc|defï¼‰

è¿›é˜¶ï¼š
(?:...) éæ•è·ç»„ï¼ˆä¸ä¿å­˜åŒ¹é…ç»“æœï¼‰
(?P<name>...) å‘½ååˆ†ç»„

è´¢åŠ¡å¸¸ç”¨æ¨¡å¼ï¼š
é‡‘é¢ï¼šÂ¥?\d+(,\d{3})*\.?\d*
æ—¥æœŸï¼š(\d{4})[-/å¹´](\d{1,2})[-/æœˆ](\d{1,2})æ—¥?
å‘ç¥¨ï¼š[A-Z]{2,4}\d{8,12}
é“¶è¡Œè´¦å·ï¼š\d{16,19}
ç™¾åˆ†æ¯”ï¼š\d+\.?\d*%
"""
```

***

#### 7.2 æ­£åˆ™è°ƒè¯•æŠ€å·§

```python
"""
1. ä»ç®€å•å¼€å§‹ï¼Œé€æ­¥æ·»åŠ è§„åˆ™
   å…ˆå†™ \d+ï¼Œå†å†™ \d+\.?\d*ï¼Œæœ€åå†™ \d+(,\d{3})*\.?\d*

2. ä½¿ç”¨https://regex101.com/åœ¨çº¿è°ƒè¯•
   ç²˜è´´æ–‡æœ¬å’Œæ¨¡å¼ï¼Œå®æ—¶çœ‹åŒ¹é…ç»“æœ

3. ç”¨re.DEBUGæŸ¥çœ‹ç¼–è¯‘è¿‡ç¨‹
   re.compile(pattern, re.DEBUG)

4. åŸå§‹å­—ç¬¦ä¸²r'pattern'
   é¿å…è½¬ä¹‰é—®é¢˜ï¼Œæ¨èæ€»æ˜¯ä½¿ç”¨r''

5. è´ªå©ªä¸éè´ªå©ª
   \d+ è´ªå©ªï¼ˆåŒ¹é…å°½å¯èƒ½å¤šï¼‰
   \d+? éè´ªå©ªï¼ˆåŒ¹é…å°½å¯èƒ½å°‘ï¼‰
"""
```

***

### å…«ã€æ€»ç»“

- âœ… æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼åŒ¹é…åŸç†
- âœ… æå–é‡‘é¢ã€æ—¥æœŸã€å‘ç¥¨å·ç­‰è´¢åŠ¡æ•°æ®
- âœ… ä»æ··ä¹±æ–‡æœ¬ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯
- âœ… æ‰¹é‡è§£æè´¢åŠ¡æŠ¥è¡¨
- âœ… ç”ŸæˆExcelæ±‡æ€»æŠ¥å‘Š

***

### ä¸‹ç¯‡é¢„å‘Š

ç¬¬22ç¯‡ã€Šæ•°æ®åº“åŸºç¡€ï¼šSQLiteå…¥é—¨ã€‹â€”â€”æŠŠæå–çš„æ•°æ®å­˜åˆ°æ•°æ®åº“ï¼Œå®ç°é«˜æ•ˆæŸ¥è¯¢å’Œç®¡ç†ï¼

***

> ğŸ¤– Powered by Kimi K2 Thinking ğŸ’» å†…å®¹ç»è‘µè‘µğŸŒ»å®¡æ ¸ä¸ä¿®æ”¹

***

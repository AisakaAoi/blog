---
title: Android-éŸ³è§†é¢‘-è§†é¢‘å¼€å‘-ï¼ˆä¸‰ï¼‰è§†é¢‘æ’­æ”¾
categories:
  - ğŸŒ™åŸºç¡€å­¦ä¹ 
  - â­Android
abbrlink: 47f70dd6
date: 2021-10-19 15:38:41
tags:
---

### è§†é¢‘æ’­æ”¾å™¨çš„åŸç†

éŸ³è§†é¢‘æŠ€æœ¯ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ç‚¹ï¼šå°è£…æŠ€æœ¯ã€è§†é¢‘å‹ç¼©ç¼–ç æŠ€æœ¯ã€éŸ³é¢‘å‹ç¼©ç¼–ç æŠ€æœ¯ã€æµåª’ä½“åè®®æŠ€æœ¯ï¼ˆå¦‚æœè€ƒè™‘åˆ°ç½‘ç»œä¼ è¾“çš„è¯ï¼‰ã€‚

è§†é¢‘æ’­æ”¾å™¨æ’­æ”¾ä¸€ä¸ª**äº’è”ç½‘ä¸Šçš„è§†é¢‘æ–‡ä»¶**ï¼Œéœ€è¦ç»è¿‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š**è§£åè®®ï¼Œè§£å°è£…ï¼Œè§£ç éŸ³è§†é¢‘ï¼ŒéŸ³è§†é¢‘åŒæ­¥**ã€‚

æ’­æ”¾**æœ¬åœ°æ–‡ä»¶**åˆ™ä¸éœ€è¦è§£åè®®ï¼Œä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š**è§£å°è£…ï¼Œè§£ç éŸ³è§†é¢‘ï¼ŒéŸ³è§†é¢‘åŒæ­¥**ã€‚

{% asset_img 1.png %}

<!--more-->

**è§£åè®®**ï¼šå°†æµåª’ä½“åè®®çš„æ•°æ®ï¼Œè§£æä¸ºæ ‡å‡†çš„ç›¸åº”çš„å°è£…æ ¼å¼æ•°æ®ã€‚éŸ³è§†é¢‘åœ¨ç½‘ç»œä¸Šä¼ æ’­çš„æ—¶å€™ï¼Œå¸¸å¸¸é‡‡ç”¨å„ç§æµåª’ä½“åè®®ï¼Œä¾‹å¦‚HTTPã€RTMPã€MMSç­‰ç­‰ã€‚è¿™äº›åè®®åœ¨ä¼ è¾“éŸ³è§†é¢‘æ•°æ®çš„åŒæ—¶ï¼Œä¹Ÿä¼šä¼ è¾“ä¸€äº›ä¿¡ä»¤æ•°æ®ã€‚è¿™äº›ä¿¡ä»¤æ•°æ®åŒ…æ‹¬å¯¹æ’­æ”¾çš„æ§åˆ¶ï¼ˆæ’­æ”¾ï¼Œæš‚åœï¼Œåœæ­¢ï¼‰ï¼Œæˆ–è€…å¯¹ç½‘ç»œçŠ¶æ€çš„æè¿°ç­‰ã€‚è§£åè®®çš„è¿‡ç¨‹ä¸­ä¼šå»é™¤æ‰ä¿¡ä»¤æ•°æ®è€Œåªä¿ç•™éŸ³è§†é¢‘æ•°æ®ã€‚ä¾‹å¦‚ï¼Œé‡‡ç”¨RTMPåè®®ä¼ è¾“çš„æ•°æ®ï¼Œç»è¿‡è§£åè®®æ“ä½œåï¼Œè¾“å‡ºFLVæ ¼å¼çš„æ•°æ®ã€‚

**è§£å°è£…**ï¼šå°†è¾“å…¥çš„å°è£…æ ¼å¼çš„æ•°æ®ï¼Œåˆ†ç¦»æˆä¸ºéŸ³é¢‘æµå‹ç¼©ç¼–ç æ•°æ®å’Œè§†é¢‘æµå‹ç¼©ç¼–ç æ•°æ®ã€‚å°è£…æ ¼å¼ç§ç±»å¾ˆå¤šï¼Œä¾‹å¦‚MP4ã€MKVã€RMVBã€TSã€FLVã€AVIç­‰ç­‰ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å°†å·²ç»å‹ç¼©ç¼–ç çš„è§†é¢‘æ•°æ®å’ŒéŸ³é¢‘æ•°æ®æŒ‰ç…§ä¸€å®šçš„æ ¼å¼æ”¾åˆ°ä¸€èµ·ã€‚ä¾‹å¦‚ï¼ŒFLVæ ¼å¼çš„æ•°æ®ï¼Œç»è¿‡è§£å°è£…æ“ä½œåï¼Œè¾“å‡ºH.264ç¼–ç çš„è§†é¢‘ç æµå’ŒAACç¼–ç çš„éŸ³é¢‘ç æµã€‚

**è§£ç **ï¼šå°†è§†é¢‘/éŸ³é¢‘å‹ç¼©ç¼–ç æ•°æ®ï¼Œè§£ç æˆä¸ºéå‹ç¼©çš„è§†é¢‘/éŸ³é¢‘åŸå§‹æ•°æ®ã€‚éŸ³é¢‘çš„å‹ç¼©ç¼–ç æ ‡å‡†åŒ…å«AACã€MP3ã€AC-3ç­‰ç­‰ï¼Œè§†é¢‘çš„å‹ç¼©ç¼–ç æ ‡å‡†åˆ™åŒ…å«H.264ã€MPEG2ã€VC-1ç­‰ç­‰ã€‚è§£ç æ˜¯æ•´ä¸ªç³»ç»Ÿä¸­æœ€é‡è¦ä¹Ÿæ˜¯æœ€å¤æ‚çš„ä¸€ä¸ªç¯èŠ‚ã€‚é€šè¿‡è§£ç ï¼Œå‹ç¼©ç¼–ç çš„è§†é¢‘æ•°æ®è¾“å‡ºæˆä¸ºéå‹ç¼©çš„é¢œè‰²æ•°æ®ï¼Œä¾‹å¦‚YUV420Pã€RGBç­‰ç­‰ï¼›å‹ç¼©ç¼–ç çš„éŸ³é¢‘æ•°æ®è¾“å‡ºæˆä¸ºéå‹ç¼©çš„éŸ³é¢‘æŠ½æ ·æ•°æ®ï¼Œä¾‹å¦‚PCMæ•°æ®ã€‚

**éŸ³è§†é¢‘åŒæ­¥**ï¼šæ ¹æ®è§£å°è£…æ¨¡å—å¤„ç†è¿‡ç¨‹ä¸­è·å–åˆ°çš„å‚æ•°ä¿¡æ¯ï¼ŒåŒæ­¥è§£ç å‡ºæ¥çš„è§†é¢‘å’ŒéŸ³é¢‘æ•°æ®ï¼Œå¹¶å°†è§†é¢‘éŸ³é¢‘æ•°æ®é€è‡³ç³»ç»Ÿçš„æ˜¾å¡å’Œå£°å¡æ’­æ”¾å‡ºæ¥ã€‚

***

### MediaPlayer

{% asset_img 2.jpg %}

#### MediaPlayerç”Ÿå‘½å‘¨æœŸ

1. **Idleï¼ˆé—²ç½®ï¼‰çŠ¶æ€ä¸Endï¼ˆç»“æŸï¼‰çŠ¶æ€**

    MediaPlayer å¯¹è±¡å£°æ˜å‘¨æœŸ : ä» Idle åˆ° End çŠ¶æ€å°±æ˜¯ MediaPlayer æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ
    ç”Ÿå‘½å‘¨æœŸ**å¼€å§‹**: è¿›å…¥ Idle (é—²ç½®) çŠ¶æ€
    ç”Ÿå‘½å‘¨æœŸ**ç»“æŸ**: è¿›å…¥ End (ç»“æŸ) çŠ¶æ€

    **Idle å’Œ End çŠ¶æ€è½¬æ¢ï¼š**
    è¿›å…¥ Idle çŠ¶æ€ï¼šnew MediaPlayer() æˆ–è€… ä»»ä½•çŠ¶æ€è°ƒç”¨äº† reset() æ–¹æ³•ä¹‹åï¼Œè¿›å…¥ Idle (é—²ç½®) çŠ¶æ€
    è¿›å…¥ End çŠ¶æ€ï¼šåœ¨ Idle çŠ¶æ€è°ƒç”¨ release() æ–¹æ³•åï¼Œä¼šè¿›å…¥ End (ç»“æŸ) çŠ¶æ€ï¼ˆæ¶‰åŠåˆ°èµ„æºçš„é‡Šæ”¾ï¼‰ï¼Œä¸èƒ½è½¬æ¢ä¸ºå…¶ä»–çŠ¶æ€
    **æ³¨æ„ï¼šcreate()åˆå§‹åŒ–çš„MediaPlayerç›´æ¥è¿›å…¥PreparedçŠ¶æ€**

2. **Errorï¼ˆé”™è¯¯ï¼‰çŠ¶æ€**

    **ErrorçŠ¶æ€è½¬æ¢ï¼š**
    è¿›å…¥ErrorçŠ¶æ€ï¼šæ£€æµ‹åˆ°å¼‚å¸¸ï¼Œç³»ç»Ÿå›è°ƒonError()è¿›å…¥ErrorçŠ¶æ€
    ç¦»å¼€ErrorçŠ¶æ€ï¼šå¯ä»¥ä½¿ç”¨reset()å›åˆ°IdleçŠ¶æ€
    æ³¨å†Œç›‘å¬ï¼šæ³¨å†Œä¸€ä¸ª OnErrorListener ç›‘å¬å™¨é‡å†™OnError(), ç”¨äºè·å–æ’­æ”¾å™¨å¼•æ“å†…éƒ¨å‘ç”Ÿçš„é”™è¯¯
    æ³¨å†Œæ–¹æ³•ï¼šè°ƒç”¨ MediaPlayer.setOnErrorListener(OnErrorListener) æ–¹æ³•ï¼Œæ³¨å†Œ OnErrorListener

3. **Initialized(åˆå§‹åŒ–)çŠ¶æ€**

    **Initialized çŠ¶æ€è½¬æ¢ï¼š**
    åœ¨ Idle çŠ¶æ€è°ƒç”¨ setDataSource() æ–¹æ³•ï¼ŒMediaPlayer ä¼šè¿ç§»åˆ° Initialized çŠ¶æ€
    æ³¨æ„ï¼šåªèƒ½åœ¨ Idle çŠ¶æ€è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¦‚æœåœ¨å…¶å®ƒçŠ¶æ€è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä¼šæŠ¥å‡º IllegalStateException å¼‚å¸¸

4. **Prepared(å°±ç»ª)å’ŒPreparing(å‡†å¤‡ä¸­)çŠ¶æ€**

    **PreparedçŠ¶æ€è½¬ç§»(ä¸¤ç§æ–¹å¼)**
    InitializedçŠ¶æ€è°ƒç”¨ prepared() è¿›å…¥PreparedçŠ¶æ€ï¼ˆåŒæ­¥æ“ä½œï¼Œè‹¥æ•°æ®é‡è¾ƒå¤§åˆ™å®¹æ˜“é€ æˆä¸»çº¿ç¨‹é˜»å¡ç”šè‡³ANRï¼‰
    InitializedçŠ¶æ€è°ƒç”¨ prepareAsync() è¿›å…¥PreparingçŠ¶æ€ï¼Œæ³¨å†ŒOnPreparedListener.OnPrepared()ï¼Œåœ¨å°†å‡†å¤‡å°±ç»ªåçš„æ“ä½œæ”¾ç½®OnPrepared()ä¸­ï¼ˆå¼‚æ­¥æ“ä½œï¼Œä¾¿äºæ“çºµæ•°æ®é‡å¤§çš„æƒ…å†µï¼Œé¿å…ä¸»çº¿ç¨‹é˜»å¡ï¼‰

5. **Startedï¼ˆå¼€å§‹ï¼‰çŠ¶æ€**

    **StartedçŠ¶æ€è½¬ç§»ï¼š**
    PreparedçŠ¶æ€è°ƒç”¨start()è¿›å…¥StartedçŠ¶æ€
    åˆ¤æ–­MediaPlayeræ˜¯å¦åœ¨StartedçŠ¶æ€ï¼šisPlaying():boolean
    è·Ÿè¸ªç¼“å†²çŠ¶æ€ï¼šåœ¨ Started çŠ¶æ€ï¼Œè°ƒç”¨ OnBufferingUpdateListener.onBufferingUpdate() æ–¹æ³•ï¼Œå¯ä»¥è·å–è§†é¢‘éŸ³é¢‘æµçš„ç¼“å†²çŠ¶æ€

6. **Pausedï¼ˆæš‚åœï¼‰çŠ¶æ€**

    **PausedçŠ¶æ€è½¬ç§»ï¼š**
    StartedçŠ¶æ€è°ƒç”¨paused()è¿›å…¥PausedçŠ¶æ€
    PausedçŠ¶æ€è°ƒç”¨start()è¿›å…¥StartedçŠ¶æ€

7. **StopçŠ¶æ€**

    **StopçŠ¶æ€è½¬ç§»ï¼š**
    åœ¨ Preparedã€Startedã€Pausedã€PlaybackCompleted çŠ¶æ€ä¸‹ è°ƒç”¨ stop() æ–¹æ³•ï¼ŒMediaPlayer ä¼šè¿ç§»åˆ° Stopped çŠ¶æ€
    **æ³¨æ„StopçŠ¶æ€ä¸èƒ½ç›´æ¥start()ï¼Œè¦å›åˆ°preparedçŠ¶æ€ï¼ˆprepare()æˆ–prepareAsyn()ï¼‰ï¼Œæ‰èƒ½start**

8. **æ’­æ”¾ä½ç½®è°ƒæ•´seekTo()**

    è¯¥æ–¹æ³•å¼‚æ­¥ï¼Œè°ƒç”¨åæ’­æ”¾å™¨å¼•æ“è¿˜éœ€è¦è¿›è¡Œå…¶å®ƒæ“ä½œï¼Œè·³è½¬æ‰èƒ½å®Œæˆ
    è¿›è¡Œçš„æ“ä½œï¼šæ’­æ”¾å™¨å¼•æ“ä¼šå›è°ƒ OnSeekComplete.onSeekComplete()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šè¿‡ setOnSeekCompleteListener() æ–¹æ³•æ³¨å†Œ
    è·å–æ’­æ”¾ä½ç½®ï¼šè°ƒç”¨ getCurrentPosition() æ–¹æ³•ï¼Œå¯ä»¥è·å–å½“å‰æ’­æ”¾çš„ä½ç½®ï¼Œå¯ä»¥å¸®åŠ©æ’­æ”¾å™¨æ›´æ–°è¿›åº¦æ¡

9. **PlaybackCompleted (æ’­æ”¾å®Œæ¯•) çŠ¶æ€**

    **PlaybackCompleted çŠ¶æ€è½¬ç§»ï¼š**
    å¦‚æœè®¾ç½®äº†å¾ªç¯æ¨¡å¼SetLooping()ï¼Œé‚£ä¹ˆæ’­æ”¾å®Œæ¯•ä¹‹åä¼šé‡æ–°è¿›å…¥StartedçŠ¶æ€ï¼›è‹¥æ²¡è®¾ç½®å¾ªç¯ï¼Œåˆ™è°ƒç”¨ OnCompletion.onCompletion() å›è°ƒæ–¹æ³•ï¼ŒMediaPlayer ä¼šè¿›å…¥ PlaybackCompleted çŠ¶æ€
    ä¹Ÿå¯ä»¥åœ¨è¯¥çŠ¶æ€ç›´æ¥è°ƒç”¨start()è¿›å…¥StartedçŠ¶æ€

#### MediaPlayerå®ç°æ­¥éª¤æ—¶åºå›¾

{% asset_img 3.png %}

#### æ’­æ”¾è§†é¢‘

1. ç³»ç»Ÿè‡ªå¸¦çš„æ’­æ”¾å™¨

    é€šè¿‡intentçš„æ–¹å¼ï¼Œè°ƒç”¨ç³»ç»Ÿè‡ªå¸¦çš„æ’­æ”¾å™¨

    ``` java
    Uri uri = Uri.parse("/storage/emulated/0/DCIM/Camera/test.mp4"); 
    // è°ƒç”¨ç³»ç»Ÿè‡ªå¸¦çš„æ’­æ”¾å™¨
    Intent intent = new Intent(Intent.ACTION_VIEW);
    intent.setDataAndType(uri, "video/mp4");
    startActivity(intent);
    ```

2. VideoView+MediaController

    VideoViewç»§æ‰¿äº†SurfaceViewåŒæ—¶å®ç°äº†MediaPlayerControlæ¥å£ï¼ŒMediaControlleråˆ™æ˜¯å®‰å“å°è£…çš„è¾…åŠ©æ§åˆ¶å™¨ï¼Œå¸¦æœ‰æš‚åœï¼Œæ’­æ”¾ï¼Œåœæ­¢ï¼Œè¿›åº¦æ¡ç­‰æ§ä»¶ã€‚é€šè¿‡VideoView+MediaControllerå¯ä»¥å¾ˆè½»æ¾çš„å®ç°è§†é¢‘æ’­æ”¾ã€åœæ­¢ã€å¿«è¿›ã€å¿«é€€ç­‰åŠŸèƒ½ã€‚

    VideoViewæ˜¯åŒ…è£…è¿‡çš„MediaPlayerï¼Œæ‰€ä»¥ä½¿ç”¨èµ·æ¥å¾ˆç›¸ä¼¼
    1)è°ƒç”¨setVideoPath()å»è®¾ç½®è§†é¢‘æ–‡ä»¶è·¯å¾„ï¼ˆésetDataSourceï¼‰
    2)newä¸€ä¸ªMediaController
    3)videoView.setMediaController(mediaController)è®¾ç½®åª’ä½“æ§åˆ¶å™¨
    4)videoView.requestFocus()è¯·æ±‚ç„¦ç‚¹åstart()

    è¿˜å¯ä»¥è®¾ç½®videoView.setOnCompletionListenerã€videoView.setOnBufferingUpdateListenerç­‰å›è°ƒå‡½æ•°

3. SurfaceView+MediaPlayer+MediaController/è‡ªå®šä¹‰æ§åˆ¶å™¨

    1)åœ¨ç•Œé¢å¸ƒå±€æ–‡ä»¶ä¸­å®šä¹‰SurfaceViewç»„ä»¶ï¼Œå¹¶ä¸ºSurfaceViewçš„SurfaceHolderæ·»åŠ Callbackç›‘å¬å™¨
    2)åˆ›å»ºMediaPlayerå¯¹è±¡ï¼Œå¹¶setDataSource()è®©å®ƒåŠ è½½æŒ‡å®šçš„è§†é¢‘æ–‡ä»¶
    3)è°ƒç”¨MediaPlayerå¯¹è±¡çš„setDisplay(SurfaceHolder sh)å°†æ‰€æ’­æ”¾çš„è§†é¢‘å›¾åƒè¾“å‡ºåˆ°æŒ‡å®šçš„SurfaceViewç»„ä»¶
    4)è°ƒç”¨MediaPlayerå¯¹è±¡çš„prepareAsync()æˆ–prepare()æ–¹æ³•è£…è½½æµåª’ä½“æ–‡ä»¶
    5)è°ƒç”¨MediaPlayerå¯¹è±¡çš„start()ã€stop()å’Œpause()æ–¹æ³•æ¥æ§åˆ¶è§†é¢‘çš„æ’­æ”¾

    SurfaceViewä¾‹å­

    ``` java
    public class MyPlayer implements MediaPlayer.OnPreparedListener, MediaPlayer.OnErrorListener, MediaPlayer.OnCompletionListener {
        private MediaPlayer mPlayer;
        private boolean hasPrepared;
    
        private void initIfNecessary() {
            if (null == mPlayer) {
                mPlayer = new MediaPlayer();
                mPlayer.setOnErrorListener(this);
                mPlayer.setOnCompletionListener(this);
                mPlayer.setOnPreparedListener(this);
            }
        }
    
        public void play(Context context, Uri dataSource) {
            hasPrepared = false; // å¼€å§‹æ’­æ”¾å‰è®²Flagç½®ä¸ºä¸å¯æ“ä½œ
            initIfNecessary(); // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ’­æ”¾/playerå·²ç»é‡Šæ”¾äº†ï¼Œå°±ä¼šé‡æ–°åˆ›å»ºã€åˆå§‹åŒ–
            try {
                mPlayer.reset();
                mPlayer.setDataSource(context, dataSource); // è®¾ç½®æ›²ç›®èµ„æº
                mPlayer.prepareAsync(); // å¼‚æ­¥çš„å‡†å¤‡æ–¹æ³•
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    
        public void start() {
            // release()ä¼šé‡Šæ”¾playerã€å°†playerç½®ç©ºï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦åˆ¤æ–­ä¸€ä¸‹
            if (null != mPlayer && hasPrepared) {
                mPlayer.start();
            }
        }
    
        public void pause() {
            if (null != mPlayer && hasPrepared) {
                mPlayer.pause();
            }
        }
    
        public void seekTo(int position) {
            if (null != mPlayer && hasPrepared) {
                mPlayer.seekTo(position);
            }
        }
    
        // å¯¹äºæ’­æ”¾è§†é¢‘æ¥è¯´ï¼Œé€šè¿‡è®¾ç½®SurfaceHolderæ¥è®¾ç½®æ˜¾ç¤ºSurfaceã€‚è¿™ä¸ªæ–¹æ³•ä¸éœ€è¦åˆ¤æ–­çŠ¶æ€ã€ä¹Ÿä¸ä¼šæ”¹å˜playerçŠ¶æ€
        public void setDisplay(SurfaceHolder holder) {
            if (null != mPlayer) {
                mPlayer.setDisplay(holder);
            }
        }
        public void release() {
            hasPrepared = false;
            mPlayer.stop();
            mPlayer.release();
            mPlayer = null;
        }
    
        @Override
        public void onPrepared(MediaPlayer mp) {
            hasPrepared = true; // å‡†å¤‡å®Œæˆåå›è°ƒåˆ°è¿™é‡Œ
            start();
        }
    
        @Override
        public void onCompletion(MediaPlayer mp) {
            hasPrepared = false;
            // é€šçŸ¥è°ƒç”¨å¤„ï¼Œè°ƒç”¨play()æ–¹æ³•è¿›è¡Œä¸‹ä¸€ä¸ªæ›²ç›®çš„æ’­æ”¾
        }
    
        @Override
        public boolean onError(MediaPlayer mp, int what, int extra) {
            hasPrepared = false;
            return false;
        }
    }
    ```

4. TextureView+MediaPlayer+MediaController/è‡ªå®šä¹‰æ§åˆ¶å™¨

    å› ä¸ºSurfaceViewçš„å†…å®¹ä¸åœ¨åº”ç”¨çª—å£ä¸Šï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨å˜æ¢ï¼ˆå¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬ç­‰ï¼‰ã€‚ä¹Ÿéš¾ä»¥æ”¾åœ¨ListViewæˆ–è€…ScrollViewä¸­ï¼Œä¸èƒ½ä½¿ç”¨UIæ§ä»¶çš„ä¸€äº›ç‰¹æ€§æ¯”å¦‚View.setAlpha()ã€‚

    ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ Android 4.0ä¸­å¼•å…¥äº†TextureViewã€‚

    1)åœ¨ç•Œé¢å¸ƒå±€æ–‡ä»¶ä¸­å®šä¹‰TextureViewç»„ä»¶ï¼Œå¹¶ä¸ºTextureViewçš„æ·»åŠ å›è°ƒmTextureView.setSurfaceTextureListener
    2)åœ¨onSurfaceTextureAvailableå›è°ƒé‡Œå–å‡ºSurfaceTextureï¼šmSurface = new Surface(surface);
    3)åˆ›å»ºMediaPlayerå¯¹è±¡ï¼Œå¹¶setDataSource()è®©å®ƒåŠ è½½æŒ‡å®šçš„è§†é¢‘æ–‡ä»¶
    4)è°ƒç”¨MediaPlayerå¯¹è±¡çš„setSurface(mSurface)å°†æ‰€æ’­æ”¾çš„è§†é¢‘å›¾åƒè¾“å‡ºæŒ‡å®š
    5)è°ƒç”¨MediaPlayerå¯¹è±¡çš„prepareAsync()æˆ–prepare()æ–¹æ³•è£…è½½æµåª’ä½“æ–‡ä»¶
    6)è°ƒç”¨MediaPlayerå¯¹è±¡çš„start()ã€stop()å’Œpause()æ–¹æ³•æ¥æ§åˆ¶è§†é¢‘çš„æ’­æ”¾

    è¡¥å……ï¼šmMediaPlayer.setOnPreparedListenerã€mMediaPlayer.setOnCompletionListenerç­‰å›è°ƒå¯è‡ªå®šä¹‰æ·»åŠ 

***

### ExoPlayerï¼ˆä¸“æ³¨äºAndroidï¼‰

#### ç®€ä»‹

ExoPlayeræ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨çº§åª’ä½“æ’­æ”¾å™¨é¡¹ç›®ï¼Œæ„å»ºåœ¨Androidçš„ä½çº§åª’ä½“APIä¹‹ä¸Šï¼Œå®ƒæä¾›äº†Androidçš„MediaPlayer APIçš„æ›¿ä»£æ–¹æ³•ï¼Œç”¨äºåœ¨æœ¬åœ°å’Œé€šè¿‡Internetæ’­æ”¾éŸ³é¢‘å’Œè§†é¢‘ã€‚

ExoPlayeræ”¯æŒAndroidçš„MediaPlayer APIç›®å‰ä¸æ”¯æŒçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬DASHå’ŒSmoothStreamingè‡ªé€‚åº”æ’­æ”¾ã€‚ ä¸MediaPlayer APIä¸åŒï¼ŒExoPlayeræ˜“äºè‡ªå®šä¹‰å’Œæ‰©å±•ã€‚

ExoPlayeråº“çš„æ ¸å¿ƒæ˜¯Exoplayeræ¥å£ï¼ŒExoplayerå…¬å¼€äº†ä¼ ç»Ÿçš„é«˜çº§åª’ä½“æ’­æ”¾å™¨åŠŸèƒ½ï¼Œä¾‹å¦‚ç¼“å†²åª’ä½“ã€æ’­æ”¾ã€æš‚åœå’Œseekç­‰åŠŸèƒ½ï¼ŒExoPlayeré€šè¿‡ç»„ä»¶å®ç°å…¶å®ƒé«˜çº§åŠŸèƒ½ã€‚

MediaSourceï¼šå®šä¹‰å¤šåª’ä½“æ•°æ®æºï¼Œä»Uriä¸­è¯»å–æ•°æ®ï¼Œä¼ å…¥ExoPlayer
TrackSelectorï¼šè½¨é“æå–å™¨ï¼Œä»MediaSourceä¸­æå–å„ä¸ªè½¨é“çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œäº¤ç»™Renderæ¸²æŸ“
LoadControlï¼šå¯ä»¥æ§åˆ¶MediaSourceï¼Œæ¯”å¦‚ä»€ä¹ˆæ—¶å€™å¼€å§‹ç¼“å†²ï¼Œç¼“å†²å¤šå°‘ä¹‹åæš‚åœç¼“å†²

#### ä¼˜ç¼ºç‚¹

ä¸Androidå†…ç½®çš„MediaPlayerç›¸æ¯”ï¼ŒExoPlayerå…·æœ‰è®¸å¤šä¼˜ç‚¹ï¼š

1. æ”¯æŒé€šè¿‡HTTPï¼ˆDASHï¼‰å’ŒSmoothStreamingè¿›è¡ŒåŠ¨æ€è‡ªé€‚åº”æµï¼Œè¿™ä¸¤ç§éƒ½ä¸å—MediaPlayerçš„æ”¯æŒ

2. èƒ½å¤Ÿè‡ªå®šä¹‰å’Œæ‰©å±•æ’­æ”¾å™¨ï¼Œå¤§éƒ¨åˆ†ç»„ä»¶éƒ½å¯ä»¥è‡ªå·±æ›¿æ¢ä»¥é€‚åº”å„ç§ä¸åŒéœ€æ±‚ï¼Œè¿˜å¯ä»¥æ¥å…¥ffmpegç»„ä»¶

3. ä¸IJKPlayerå’ŒVitamioç›¸æ¯”ï¼ŒExoPlayerå¯¼å…¥é¡¹ç›®ä¹‹åAPKä½“ç§¯å¢åŠ å°

ç¼ºç‚¹ï¼š

1. æœ€ä½æ”¯æŒç‰ˆæœ¬4.4ä¸”å®ç°æ¯”è¾ƒå¤æ‚

2. çº¦å¢åŠ APPåŒ…ä½“å‡ ç™¾KBçš„å¤§å°

3. ç›¸æ¯”äºAndroidåŸç”Ÿçš„MediaPlayerï¼ŒExoPlayerå°†æ˜¾è‘—çš„æ¶ˆè€—æ›´å¤šçš„ç”µé‡

#### æ”¯æŒçš„æ ¼å¼

{% asset_img 4.jpg %}

#### æ”¯æŒè®¾å¤‡æƒ…å†µ

ExoPlayeræ”¯æŒå¤§éƒ¨åˆ†æµåª’ä½“æ ¼å¼ï¼Œå¹¶ä¸”å¯¹DRMçš„æ”¯æŒä¹Ÿæ¯”è¾ƒå‹å¥½ï¼Œæ¯”å¦‚ä¸‹æ–¹å°±æ˜¯å®˜æ–¹æä¾›çš„æ”¯æŒçš„è®¾å¤‡æƒ…å†µï¼š

{% asset_img 5.jpg %}

#### æ¶æ„å›¾

é€šè¿‡ExoPlayerçš„æ¶æ„å›¾ï¼Œå¯ä»¥çœ‹åˆ°å…¶ç»„ä»¶æ¨¡å—åŒ–çš„è®¾è®¡ï¼Œè¿™ä¸ªæ¶æ„è®¾è®¡å€¼å¾—å­¦ä¹ ï¼Œä¹Ÿæ˜¯å¥½çš„ç»„ä»¶/SDKçš„ä¸€ä¸ªé‡è¦è¦æ±‚ã€‚åœ¨æ—¥å¸¸é¡¹ç›®å¼€å‘ä¸­ï¼Œå¼€å‘ä¸€ä¸ªç»„ä»¶ä»æ˜“ç”¨æ€§å’Œä»¥æ‰©å±•æ€§æ–¹é¢è€ƒè™‘ï¼Œæ—¢è¦ä¿è¯ä½¿ç”¨è€…å¾ˆå®¹æ˜“ä¸Šæ‰‹ä½¿ç”¨ï¼ˆæä¾›ä¸€å¥—é»˜è®¤å®ç°ï¼‰ï¼Œåˆè¦æœ‰æ–¹ä¾¿ä½¿ç”¨è€…æ ¹æ®è‡ªå·±çš„åœºæ™¯è¿›è¡Œæ–¹ä¾¿çš„æ‰©å±•çš„èƒ½åŠ›ã€‚

{% asset_img 6.png %}

#### çº¿ç¨‹æ¨¡å‹

{% asset_img 7.svg %}

#### åŸºæœ¬ä½¿ç”¨

æˆ‘ä»¬åªè¦æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤å°±èƒ½ç®€å•çš„å°†ExoPlayerä½¿ç”¨èµ·æ¥äº†ï¼š

1ã€æ·»åŠ å¯¹ExoPlayeråº“çš„ä¾èµ–
2ã€åˆ›å»ºä¸€ä¸ªSimpleExoPlayerå®ä¾‹
3ã€å°†æ’­æ”¾å™¨å…³è”åˆ°æ’­æ”¾æ¸²æŸ“çš„Viewä¸Š
4ã€å°†æ’­æ”¾èµ„æºåŒ…è£…ç±»MediaSourceçš„å¯¹è±¡å‡†å¤‡å¥½ï¼Œé€šè¿‡ExoPlayerçš„prepare()æ–¹æ³•è®¾ç½®è¿›å»
5ã€å½“æˆ‘ä»¬ä¸éœ€è¦æ’­æ”¾çš„æ—¶å€™è®°å¾—é€šè¿‡releaseæ–¹æ³•è¿›è¡Œé‡Šæ”¾

1. **æ·»åŠ ExoPlayeræ¨¡å—**

    ``` java
    // implementation 'com.google.android.exoplayer:exoplayer:2.x.x'
    implementation 'com.google.android.exoplayer:exoplayer:2.15.0'
    ```

2. **æ·»åŠ Java 8æ”¯æŒ**

    ``` java
    compileOptions {
            targetCompatibility JavaVersion.VERSION_1_8
    }
    ```

3. **åˆ›å»ºæ’­æ”¾å™¨**

    ExoPlayerå¯ä»¥ä½¿ç”¨SimpleExoPlayer.Builderæˆ–åˆ›å»ºå®ä¾‹ExoPlayer.Builderï¼Œè¿™äº›æ„å»ºå™¨æä¾›äº†ä¸€ç³»åˆ—ç”¨äºåˆ›å»ºExoPlayerå®ä¾‹çš„å®šåˆ¶é€‰é¡¹ã€‚

    å¯¹äºç»å¤§å¤šæ•°ç”¨ä¾‹ï¼Œ SimpleExoPlayer.Builderéƒ½å¯ä»¥ä½¿ç”¨ã€‚

    æ­¤æ„å»ºå™¨è¿”å› SimpleExoPlayerï¼Œå®ƒæ‰©å±•ExoPlayerä¸ºæ·»åŠ å…¶ä»–é«˜çº§æ’­æ”¾å™¨åŠŸèƒ½ã€‚

    ``` java
    // 2.12ç‰ˆæœ¬ä»¥åæ¨è
    SimpleExoPlayer player = new SimpleExoPlayer.Builder(context).build();
    ```

    ä¹Ÿå¯ä»¥è¿™ä¹ˆåˆ›å»ºï¼š

    ``` java
    // åˆ›å»ºå¸¦å®½
    BandwidthMeter bandwidthMeter = new DefaultBandwidthMeter();
    // åˆ›å»ºè½¨é“é€‰æ‹©å·¥å‚ è§†é¢‘æ¯ä¸€è¿™çš„ç”»é¢å¦‚ä½•æ¸²æŸ“,å®ç°é»˜è®¤çš„å®ç°ç±»
    TrackSelection.Factory videoTrackSelectionFactory = new DefaultRenderersFactory(application)
    // åˆ›å»ºè½¨é“é€‰æ‹©å®ä¾‹ è§†é¢‘çš„éŸ³è§†é¢‘è½¨é“å¦‚ä½•åŠ è½½ ä½¿ç”¨é»˜è®¤çš„è½¨é“é€‰æ‹©å™¨
    TrackSelector trackSelector = new DefaultTrackSelector(videoTrackSelectionFactory);
    // åˆ›å»ºæ’­æ”¾å™¨å®ä¾‹
    SimpleExoPlayer player = ExoPlayerFactory.newSimpleInstance(this, trackSelector);
    ```

4. **å°†æ’­æ”¾å™¨é™„åŠ åˆ°è§†å›¾**

    ExoPlayeråº“ä¸ºåª’ä½“æ’­æ”¾æä¾›äº†ä¸€ç³»åˆ—é¢„æ„å»ºçš„UIç»„ä»¶ã€‚å…¶ä¸­åŒ…æ‹¬StyledPlayerViewï¼Œå®ƒå°è£…äº† StyledPlayerControlViewã€SubtitleViewå’Œæ¸²æŸ“è§†é¢‘çš„Surfaceã€‚

    å°†æ’­æ”¾å™¨ç»‘å®šåˆ°è§†å›¾

    ``` java
    // Bind the player to the view.
    playerView.setPlayer(player);
    ```

    å¯¹äºå®ç°è‡ªå·±çš„UIè§†é¢‘çš„åº”ç”¨ï¼Œå¯ä»¥åˆ†åˆ«ä½¿ç”¨SimpleExoPlayerçš„setVideoSurfaceView()ï¼ŒsetVideoTextureView()ï¼ŒsetVideoSurfaceHolder()å’ŒsetVideoSurface()çš„æ–¹æ³•è®¾ç½®è‡ªå·±çš„SurfaceViewï¼ŒTextureViewï¼Œ SurfaceHolderæˆ–è€…Surfaceã€‚

    SimpleExoPlayerçš„addTextOutput()å¯ç”¨äºæ¥æ”¶åœ¨æ’­æ”¾è¿‡ç¨‹ä¸­åº”å‘ˆç°çš„å­—å¹•ã€‚

5. **å¡«å……æ’­æ”¾åˆ—è¡¨å¹¶å‡†å¤‡æ’­æ”¾å™¨**

    åœ¨ExoPlayerä¸­ï¼Œæ¯ç§åª’ä½“éƒ½ç”±è¡¨ç¤ºMediaItemã€‚æ’­æ”¾åˆ—è¡¨å¯ä»¥åœ¨æ’­æ”¾æœŸé—´è¿›è¡Œæ›´æ–°ï¼Œè€Œæ— éœ€å†æ¬¡å‡†å¤‡æ’­æ”¾å™¨ã€‚

    è¦æ’­æ”¾åª’ä½“ï¼Œéœ€è¦æ„å»ºç›¸åº”çš„åª’ä½“MediaItemï¼Œå°†å…¶æ·»åŠ åˆ°æ’­æ”¾å™¨ä¸­ï¼Œå‡†å¤‡æ’­æ”¾å™¨ï¼Œç„¶åè°ƒç”¨playä»¥å¼€å§‹æ’­æ”¾ï¼š

    ``` java
    // åˆ›å»ºmediaItem
    MediaItem mediaItem = MediaItem.fromUri(videoUri);
    // è®¾ç½®mediaItem
    player.setMediaItem(mediaItem);
    // å‡†å¤‡æ’­æ”¾
    player.prepare();
    // å¼€å§‹æ’­æ”¾
    player.play();
    ```

    ExoPlayerç›´æ¥æ”¯æŒæ’­æ”¾åˆ—è¡¨ï¼Œå› æ­¤å¯ä»¥ä¸ºæ’­æ”¾å™¨å‡†å¤‡å¤šä¸ªè¦ä¾æ¬¡æ’­æ”¾çš„åª’ä½“é¡¹ç›®ï¼š

    ``` java
    // åˆ›å»ºmediaItem
    MediaItem firstItem = MediaItem.fromUri(firstVideoUri);
    MediaItem secondItem = MediaItem.fromUri(secondVideoUri);
    // æ·»åŠ è¦æ’­æ”¾çš„åª’ä½“é¡¹ç›®ã€‚
    player.addMediaItem(firstItem);
    player.addMediaItem(secondItem);
    // å‡†å¤‡æ’­æ”¾
    player.prepare();
    // å¼€å§‹æ’­æ”¾
    player.play();
    ```

    åœ¨ExoPlayer 2.12ä¹‹å‰ï¼Œplayeréœ€è¦çš„æ˜¯ä¸€ä¸ªMediaSourceè€Œä¸æ˜¯MediaItemã€‚ä»2.12å¼€å§‹ï¼Œplayerå†…éƒ¨ä¼šå°†MediaItemè½¬æ¢ä¸ºéœ€è¦çš„ MediaSourceå®ä¾‹ï¼Œä½†ä»å¯ä»¥ä½¿ç”¨ExoPlayer.setMediaSource()å’ŒExoPlayer.addMediaSource()å°†MediaSourceå®ä¾‹ç›´æ¥æä¾›ç»™æ’­æ”¾å™¨ã€‚

    2.12ä¹‹å‰æ˜¯è¿™æ ·åˆ›å»ºçš„

    ``` java
    // åˆ›å»ºåŠ è½½æ•°æ®çš„å·¥å‚ (ç”ŸæˆåŠ è½½åª’ä½“æ•°æ®çš„æ•°æ®æºå®ä¾‹)
    DataSource.Factory dataSourceFactory = new DefaultDataSourceFactory(context, Util.getUserAgent(context, "yourApplicationName"));
    
    Uri uri = Uri.parse(url);
    // åˆ›å»ºèµ„æº
    ExtractorMediaSource mediaSource = new ExtractorMediaSource.Factory(dataSourceFactory).createMediaSource(uri);
    // æˆ–è€…MediaSource mediaSource= new ProgressiveMediaSource.Factory(dataSourceFactory).createMediaSource(uri);
    // å‡†å¤‡æ’­æ”¾
    player.prepare(mediaSource);
    // å¼€å§‹æ’­æ”¾
    player.setPlayWhenReady(true);
    ```

6. **æ§åˆ¶æ’­æ”¾å™¨**

    å‡†å¤‡å¥½æ’­æ”¾å™¨åï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨æ’­æ”¾å™¨ä¸Šçš„æ–¹æ³•æ¥æ§åˆ¶æ’­æ”¾ã€‚ä¸‹é¢åˆ—å‡ºäº†ä¸€äº›æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼š
    play()ã€pause()ï¼Œå¼€å§‹å’Œæš‚åœæ’­æ”¾
    seekTo()ï¼Œå…è®¸åœ¨mediaå†…æœå¯»ã€‚
    hasPrevious()ã€hasNext()ã€previous()ã€next()ï¼Œå…è®¸é€šè¿‡æ’­æ”¾åˆ—è¡¨è¿›è¡Œæµè§ˆã€‚
    setRepeatMode()ï¼Œæ§åˆ¶mediaæ˜¯å¦å¾ªç¯ä»¥åŠå¦‚ä½•å¾ªç¯ã€‚
    setShuffleModeEnabled()ï¼Œæ§åˆ¶æ’­æ”¾åˆ—è¡¨ç§»åŠ¨ã€‚
    setPlaybackParameters()ï¼Œè°ƒæ•´æ’­æ”¾é€Ÿåº¦å’ŒéŸ³é¢‘éŸ³é«˜ã€‚

    å¦‚æœplayerç»‘å®šåˆ°PlayerViewæˆ–PlayerControlViewï¼Œåˆ™ç”¨æˆ·ä¸è¿™äº›ç»„ä»¶çš„äº¤äº’å°†å¯¼è‡´è°ƒç”¨playerä¸Šçš„ç›¸åº”æ–¹æ³•ã€‚

7. **é‡Šæ”¾æ’­æ”¾å™¨**

    åœ¨ä¸å†éœ€è¦æ’­æ”¾å™¨æ—¶å°†å…¶é‡Šæ”¾ï¼Œä»¥é‡Šæ”¾æœ‰é™çš„èµ„æºï¼ˆä¾‹å¦‚è§†é¢‘è§£ç å™¨ï¼‰ä¾›å…¶ä»–åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚

    å¯ä»¥é€šè¿‡è°ƒç”¨æ¥å®ŒæˆExoPlayer.release

    ``` java
    @Override
    protected void onDestroy() {
        super.onDestroy();
        if (player != null) {
            player.release();
        }
    }
    ```

#### æ‹“å±•ä½¿ç”¨

1. æ·»åŠ å›è°ƒå‡½æ•°ä¸å…¶å®ƒç›‘å¬å™¨

    Events å¦‚çŠ¶æ€æ›´æ”¹å’Œæ’­æ”¾é”™è¯¯ç­‰äº‹ä»¶å°†æŠ¥å‘Šç»™å·²æ³¨å†ŒPlayer.EventListenerå®ä¾‹ã€‚

    æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨æ¥æ¥æ”¶è¿™æ ·çš„äº‹ä»¶ï¼š

    ``` java
    // æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨æ¥æ¥æ”¶æ¥è‡ªæ’­æ”¾å™¨çš„äº‹ä»¶.
    player.addListener(eventListener);
    ```

    é€šç”¨å›è°ƒï¼š
    |æ–¹æ³•|ä½œç”¨|
    | -- | -- |
    | onEvents(Player player, Events events) | å›è°ƒ |

    ä¸ªåˆ«å›è°ƒï¼š
    |æ–¹æ³•|ä½œç”¨|
    | -- | -- |
    | onPlaybackStateChanged(@State int state) | æ’­æ”¾çŠ¶æ€å˜æ›´ |
    | onIsPlayingChanged(boolean isPlaying) | å•ç‹¬æ£€æŸ¥æ˜¯å¦æ’­æ”¾ï¼Œä¸ç”¨æ¯æ¬¡éƒ½isPlaying() |
    | onPlayerError(ExoPlaybackException error) | æ¥æ”¶åˆ°å¯¼è‡´æ’­æ”¾å¤±è´¥çš„é”™è¯¯ä¿¡æ¯ï¼Œå‘ç”Ÿé”™è¯¯æ—¶å°†åœ¨æ’­æ”¾çŠ¶æ€è½¬æ¢ä¸ºPlayer.STATE_IDLEä¹‹å‰ç«‹å³è°ƒç”¨æ­¤æ–¹æ³•ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ExoPlayer.retryé‡è¯•æˆ–åœæ­¢çš„æ’­æ”¾ |
    | onMediaItemTransition(MediaItem mediaItem, @MediaItemTransitionReason int reason) | æ’­æ”¾å™¨æ›´æ”¹æ’­æ”¾åˆ—è¡¨ä¸­çš„æ–°åª’ä½“é¡¹ç›®æ—¶ï¼Œå°±ä¼šåœ¨æ³¨å†ŒPlayer.EventListenersä¸Šè°ƒç”¨åˆ° ã€‚è¡¨æ˜åŸå› æ˜¯è‡ªåŠ¨è¿‡æ¸¡ã€seekï¼ˆä¾‹å¦‚åœ¨è°ƒç”¨ä¹‹åplayer.next()ï¼‰ã€é‡å¤ç›¸åŒé¡¹ç›®è¿˜æ˜¯ç”±äºæ’­æ”¾åˆ—è¡¨æ›´æ”¹ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå½“å‰æ­£åœ¨æ’­æ”¾çš„é¡¹ç›®è¢«åˆ é™¤ï¼‰å¼•èµ·çš„ |
    | onPositionDiscontinuity()ä¸reason=DISCONTINUITY_REASON_SEEK | æ˜¯è°ƒç”¨Player.seekToçš„ç›´æ¥ç»“æœ |

    ä¸¤è€…çš„åŒºåˆ«ï¼š
    |é€šç”¨å›è°ƒ|ä¸ªåˆ«å›è°ƒ|
    | ----- | ----- |
    | å¸Œæœ›é’ˆå¯¹å¤šä¸ªäº‹ä»¶è§¦å‘ç›¸åŒçš„é€»è¾‘ï¼ˆä¾‹å¦‚æ›´æ–°ç”¨äºä¸¤è€…çš„UIonPlaybackStateChangedå’Œ onPlayWhenReadyChangedï¼‰ | å¯¹æ›´æ”¹çš„åŸå› æ„Ÿå…´è¶£ã€‚ä¾‹å¦‚ï¼Œä¸ºonPlayWhenReadyChangedæˆ–æä¾›çš„åŸå› onMediaItemTransition |
    | éœ€è¦è®¿é—®è¯¥Playerå¯¹è±¡ä»¥è§¦å‘å…¶ä»–äº‹ä»¶ï¼Œä¾‹å¦‚åœ¨åª’ä½“é¡¹è½¬æ¢åè¿›è¡Œæœç´¢ | ä»…å¯¹é€šè¿‡å›è°ƒå‚æ•°æä¾›çš„æ–°å€¼èµ·ä½œç”¨ï¼Œæˆ–è§¦å‘ä¸ä¾èµ–äºå›è°ƒå‚æ•°çš„å…¶ä»–äº‹ä»¶ |
    | å¯¹äº‹ä»¶æ˜¯å¦åœ¨é€»è¾‘ä¸Šä¸€èµ·å‘ç”Ÿæ„Ÿå…´è¶£ã€‚ä¾‹å¦‚onPlaybackStateChangedï¼Œä»¥STATE_BUFFERINGå› åª’ä½“é¡¹ç›®è¿‡æ¸¡ã€‚ | æ›´å–œæ¬¢åœ¨æ–¹æ³•åç§°ä¸­ä»¥æ¸…æ™°å¯è¯»çš„æ–¹å¼æŒ‡ç¤ºè§¦å‘äº‹ä»¶çš„åŸå›  |

    æ·»åŠ å…¶å®ƒSimpleExoPlayerç›‘å¬å™¨ï¼š
    addAnalyticsListenerï¼šæ”¶å¬è¯¦ç»†çš„äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å¯èƒ½å¯¹åˆ†æå’Œæ—¥å¿—è®°å½•æœ‰ç”¨ã€‚è¯·å‚é˜…åˆ†æé¡µé¢ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚
    addTextOutputï¼šæ”¶å¬å­—å¹•æˆ–å­—å¹•æç¤ºä¸­çš„æ›´æ”¹ã€‚
    addMetadataOutputï¼šæ”¶å¬å®šæ—¶çš„å…ƒæ•°æ®äº‹ä»¶ï¼Œä¾‹å¦‚å®šæ—¶çš„ID3å’ŒEMSGæ•°æ®ã€‚
    addVideoListenerï¼šæ”¶å¬ä¸è§†é¢‘æ¸²æŸ“æœ‰å…³çš„äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å¯èƒ½å¯¹è°ƒæ•´UIæœ‰ç”¨ï¼ˆä¾‹å¦‚ï¼ŒSurfaceæ­£åœ¨æ¸²æŸ“è§†é¢‘çš„é•¿å®½æ¯”ï¼‰ã€‚
    addAudioListenerï¼šæ”¶å¬ä¸éŸ³é¢‘æœ‰å…³çš„äº‹ä»¶ï¼Œä¾‹å¦‚éŸ³é¢‘ä¼šè¯IDæ›´æ”¹ä»¥åŠæ’­æ”¾å™¨éŸ³é‡æ›´æ”¹æ—¶ã€‚
    addDeviceListenerï¼šæ”¶å¬ä¸è®¾å¤‡çŠ¶æ€æœ‰å…³çš„äº‹ä»¶ã€‚

    ExoPlayerçš„UIç»„ä»¶ï¼ˆä¾‹å¦‚StyledPlayerViewï¼‰å°†è‡ªå·±æ³¨å†Œä¸ºç›¸åº”çš„äº‹ä»¶çš„ç›‘å¬å™¨ã€‚å› æ­¤ï¼Œä½¿ç”¨ä¸Šè¿°æ–¹æ³•è¿›è¡Œæ‰‹åŠ¨æ³¨å†Œä»…å¯¹å®ç°è‡ªå·±çš„æ’­æ”¾å™¨UIæˆ–éœ€è¦å‡ºäºå…¶ä»–ç›®çš„ç›‘å¬äº‹ä»¶çš„åº”ç”¨ç¨‹åºæœ‰ç”¨ã€‚

2. åœ¨æŒ‡å®šçš„æ’­æ”¾ä½ç½®è§¦å‘äº‹ä»¶

    å¦‚æœéœ€è¦åœ¨æŒ‡å®šçš„æ’­æ”¾ä½ç½®è§¦å‘äº‹ä»¶ï¼Œæ”¯æŒä½¿ç”¨ExoPlayer.createMessage()æ¥åˆ›å»ºPlayerMessageã€‚å®ƒå¯ä»¥ä½¿ç”¨æ¥è®¾ç½®åº”æ‰§è¡Œæ’­æ”¾çš„ä½ç½®PlayerMessage.setPosition()ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯æ˜¯åœ¨æ’­æ”¾çº¿ç¨‹ä¸Šæ‰§è¡Œçš„ï¼Œä½†è¿™å¯ä»¥ä½¿ç”¨è¿›è¡Œè‡ªå®šä¹‰ PlayerMessage.setLooper()ã€‚PlayerMessage.setDeleteAfterDelivery()å¯ç”¨äºæ§åˆ¶æ˜¯åœ¨æ¯æ¬¡é‡åˆ°æŒ‡å®šçš„æ’­æ”¾ä½ç½®æ—¶ï¼ˆæ˜¯ç”±äºæœå¯»å’Œé‡å¤æ¨¡å¼è€Œå‘ç”Ÿå¤šæ¬¡ï¼‰è¿˜æ˜¯ä»…åœ¨ç¬¬ä¸€æ¬¡æ—¶æ‰§è¡Œæ¶ˆæ¯ã€‚ä¸€æ—¦PlayerMessageé…ç½®äº†ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿›è¡Œå®‰æ’PlayerMessage.send()ã€‚

    åœ¨æŒ‡å®šçš„æ’­æ”¾ä½ç½®è§¦å‘äº‹ä»¶

    ``` java
    player.createMessage((messageType, payload) -> {
        // Do something at the specified playback position.
    })
    .setLooper(Looper.getMainLooper())
    .setPosition(/* windowIndex= */ 0, /* positionMs= */ 120000)
    .setPayload(customPayloadData)
    .setDeleteAfterDelivery(false)
    .send();
    ```

3. æŸ¥è¯¢/ä¿®æ”¹æ’­æ”¾åˆ—è¡¨

    å¯ä»¥ä½¿ç”¨Player.getMediaItemCountå’ŒPlayer.getMediaItemAt()æ¥æŸ¥è¯¢æ’­æ”¾åˆ—è¡¨ã€‚

    å¯ä»¥é€šè¿‡Player.getCurrentMediaItem()æŸ¥è¯¢å½“å‰æ’­æ”¾çš„åª’ä½“é¡¹ç›®ã€‚

    å¯ä»¥é€šè¿‡æ·»åŠ ã€ç§»åŠ¨å’Œåˆ é™¤åª’ä½“é¡¹æ¥åŠ¨æ€ä¿®æ”¹æ’­æ”¾åˆ—è¡¨ã€‚

    å¯ä»¥åœ¨æ’­æ”¾ä¹‹å‰å’Œæ’­æ”¾è¿‡ç¨‹ä¸­é€šè¿‡è°ƒç”¨ç›¸åº”çš„æ’­æ”¾åˆ—è¡¨APIæ–¹æ³•æ¥å®Œæˆæ­¤æ“ä½œï¼š

    ``` java
    // åœ¨playlistçš„positionæ·»åŠ ä¸€ä¸ªMediaItem
    player.addMediaItem(/* index= */ 1, MediaItem.fromUri(thirdUri));
    //å°†ç¬¬ä¸‰ä¸ªMediaItemä»ä½ç½®2ç§»åŠ¨åˆ°playlistçš„å¼€å§‹
    player.moveMediaItem(/* currentIndex= */ 2, /* newIndex= */ 0);
    // ä»playlistä¸­ç§»é™¤ç¬¬ä¸€é¡¹
    player.removeMediaItem(/* index= */ 0);
    ```

    è¿˜æ”¯æŒæ›¿æ¢å’Œæ¸…é™¤æ•´ä¸ªæ’­æ”¾åˆ—è¡¨ï¼š

    ``` java
    // Replaces the playlist with a new one.
    List<MediaItem> newItems = ImmutableList.of(
        MediaItem.fromUri(fourthUri),
        MediaItem.fromUri(fifthUri)
    );
    player.setMediaItems(newItems, /* resetPosition= */ true);
    // Clears the playlist. If prepared, the player transitions to the ended state.
    player.clearMediaItems();
    ```

    æ’­æ”¾å™¨ä¼šåœ¨æ’­æ”¾è¿‡ç¨‹ä¸­ä»¥æ­£ç¡®çš„æ–¹å¼è‡ªåŠ¨å¤„ç†ä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå½“å‰æ’­æ”¾çš„åª’ä½“é¡¹ç›®å·²ç§»åŠ¨ï¼Œåˆ™æ’­æ”¾ä¸ä¼šä¸­æ–­ï¼Œå¹¶ä¸”æ–°çš„åç»§å¯¹è±¡å°†åœ¨å®Œæˆåæ’­æ”¾ã€‚å¦‚æœMediaItemåˆ é™¤äº†å½“å‰æ­£åœ¨æ’­æ”¾çš„åˆ—è¡¨é¡¹ï¼Œåˆ™æ’­æ”¾å™¨å°†è‡ªåŠ¨ç§»åŠ¨åˆ°æ’­æ”¾å‰©ä½™çš„ç¬¬ä¸€ä¸ªåç»§åˆ—è¡¨é¡¹ï¼Œå¦‚æœä¸å­˜åœ¨è¯¥åç»§æ’­æ”¾å™¨ï¼Œåˆ™æ’­æ”¾å™¨å°†è¿‡æ¸¡åˆ°ç»“æŸçŠ¶æ€ã€‚

***

### ijkPlayerï¼ˆä¸“æ³¨äºè·¨å¹³å°ï¼‰

#### ç®€ä»‹

ijkplayeræ˜¯ç”±bç«™å¼€æºçš„æ’­æ”¾å™¨é¡¹ç›®ï¼Œæœ€åº•å±‚çš„æ˜¯**ijkffmpeg**æ¨¡å—æ˜¯ç”±è‘—åçš„å¼€æºæµåª’ä½“å¼€æºé¡¹ç›®ffmpegæ”¹å†™è€Œæ¥ï¼Œè´Ÿè´£è§†é¢‘çš„è§£åè®®ã€è§£å°è£…çš„ä¸€äº›ä¸šåŠ¡ã€‚

yuvæ ¼å¼ä¸€å¼€å§‹æ˜¯ä¸ºäº†å¹¿æ’­ç”µè§†ä¿¡å·å…¼å®¹é»‘ç™½ç”µè§†è€Œç”Ÿï¼Œè€Œåœ¨ç½‘ç»œæ—¶ä»£ç”±äºyuv420ã€yuv420spéœ€è¦çš„å¸¦å®½ç›¸å¯¹è¾ƒå°æ‰€ä»¥ä¾ç„¶å¾—åˆ°äº†æ²¿ç”¨ã€‚ä½†æ˜¯ç”±äºç¡¬ä»¶è®¾å¤‡æ”¯æŒçš„éƒ½æ˜¯rgbaæ ¼å¼çš„åƒç´ ä¿¡æ¯ï¼Œæ‰€ä»¥è§£å°è£…ä¹‹åæ‹¿åˆ°çš„åƒç´ ä¿¡æ¯éœ€è¦è¿›è¡Œè½¬åŒ–ä¹‹åæ‰å¯ä»¥æ˜¾ç¤ºå‡ºæ¥ï¼Œijkplayerä¸­è´Ÿè´£è¿™æ–¹é¢åŠŸèƒ½çš„æ¨¡å—æ˜¯**ijkyuv**ã€‚

åƒç´ ä¿¡æ¯è§£æä¹‹åéœ€è¦å±•ç¤ºåˆ°ç”¨æˆ·çš„é¢å‰ï¼Œijkplayeré€‰æ‹©äº†ä½¿ç”¨è‘—åçš„å¯ç§»æ¤æ¡†æ¶SDLï¼Œä½†æ˜¯ijkplayeré’ˆå¯¹ç§»åŠ¨å¹³å°çš„è¿›è¡Œäº†ä¼˜åŒ–å¹¶å°†åç§°æ”¹ä¸º**ijkSDL**ã€‚

æ—¢ç„¶æœ‰åƒç´ ä¿¡æ¯çš„å¤„ç†é‚£å°±å¿…ç„¶ä¹Ÿå­˜åœ¨å¯¹éŸ³é¢‘ä¿¡æ¯çš„å¤„ç†ï¼Œæ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªåœºæ™¯å°±æ˜¯å˜é€Ÿæ’­æ”¾ï¼Œä½†æ˜¯OpenSL ESåœ¨å€é€Ÿæ’­æ”¾éŸ³é¢‘çš„æ—¶å€™å­˜åœ¨å˜è°ƒçš„é—®é¢˜ï¼Œæ‰€ä»¥å¼•å…¥äº†**ijksoundtouch**æ¥è§£å†³å€é€Ÿå˜è°ƒçš„é—®é¢˜ã€‚

androidå¹³å°åŸç”Ÿå°±æ”¯æŒå¤šç§æ ¼å¼ï¼Œå¹¶ä¸”å¦‚æœä½¿ç”¨ç¡¬ä»¶è§£ç çš„è¯å¯ä»¥é™ä½cpuçš„è½½è·ï¼Œå°†è¿™äº›ä»»åŠ¡äº¤ç»™gpuè¿›è¡Œã€‚ä½†æ˜¯æ¯”è¾ƒå°´å°¬çš„æ˜¯ndkåœ¨android 21ä¹‹åæ‰æ·»åŠ ç›¸å…³çš„æ¥å£ã€‚æ‰€ä»¥ä¸ºäº†é€‚é…ä½é…ç½®ä½ç‰ˆæœ¬Androidæ‰‹æœº ijkplayer é‡‡ç”¨äº† ndk è°ƒç”¨ java æ–¹æ³•çš„æ–¹å¼æ¥è¿›è¡Œç¡¬ä»¶è§£ç ã€‚åŒæ—¶å¦‚æœé€‰æ‹©AudioTrackè¿›è¡Œæ’­æ”¾çš„è¯ä¹Ÿæ˜¯é€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œçš„ï¼Œè´Ÿè´£è¿™ä¸€æ–¹é¢å·¥ä½œçš„å°±æ˜¯**ijkj4a**ã€‚

#### ç³»ç»Ÿæ¶æ„å›¾

Androidä¸Šçš„ç³»ç»Ÿæ¶æ„å›¾å¦‚ä¸‹ï¼š

{% asset_img 8.png %}

**ijkplayer-exampleï¼š**æ˜¯uié€»è¾‘çš„å®ç°ï¼ŒåŒ…æ‹¬activityçš„å®ç°ã€uiæ§ä»¶çš„ç»„ç»‡ã€çª—å£çš„å®šåˆ¶ã€æ•°æ®çš„å­˜å‚¨ã€‚é€šè¿‡è°ƒç”¨ijkmediaplayerã€android mediaplayerã€ google exoplayerè¿™ä¸‰ç§mediaplayeræ¥å®ç°åª’ä½“æ’­æ”¾ã€‚

**ijkplayer-javaï¼š**æ˜¯å¯¹åº•å±‚å®ç°çš„ijkmediaplayerå’Œandroid mediaplayerçš„javaå°è£…ï¼Œå¯¹ijkmediaplayerçš„å°è£…æ˜¯é€šè¿‡è°ƒç”¨åº•å±‚jniå¯¹åº”çš„javaæ¥å£ï¼Œå¯¹android mediaplayerçš„å°è£…æ˜¯è°ƒç”¨androidç³»ç»Ÿå®ç°çš„é»˜è®¤mediaplayeræ¥å£ã€‚

**ijkplayer-exoï¼š**æ˜¯å¯¹google exoplayerçš„å°è£…ã€‚

**libijkplayerï¼š**æä¾›äº†ijkmediaplayerçš„jniå®ç°ijkplayer_jni.cï¼Œç„¶åè°ƒç”¨å°è£…è¿‡çš„ffplayer.cï¼Œå†è°ƒç”¨åº•å±‚å®ç°çš„è§£ç åº“libijkffmpegå’Œæ˜¾ç¤ºåº“libijksdlï¼Œå®ç°äº†åª’ä½“æ–‡ä»¶çš„demuxã€decodeç­‰åŠŸèƒ½ã€‚

**libijksdlï¼š**å®ç°å¯¹è§£ç åçš„æ•°æ®è¿›è¡Œæ˜¾ç¤ºã€‚

#### Javaå±‚å…³é”®æ¨¡å—åˆ†æ

1. ä¸‰ç§ä¸åŒçš„mediaplayerå®ç°

    {% asset_img 9.png %}

    AndroidMediaPlayeræ˜¯å¯¹Andoidé»˜è®¤æ’­æ”¾å™¨çš„å°è£…ã€‚
    IjkMediaPlayeræ˜¯åŸºäºffmpegçš„æ’­æ”¾å™¨å®ç°ã€‚
    IjkExoMediaPlayeræ˜¯åŸºäºGoodleå¼€æºçš„ExoPlayerçš„å°è£…ã€‚

2. è®¾ç½®ä¸åŒçš„Render

    {% asset_img 10.png %}

    SurfaceRenderViewæ˜¯åŸºäºSurfaceViewçš„æ˜¾ç¤ºå®ç°ã€‚
    TextureRenderViewæ˜¯åŸºäºTextureViewçš„æ˜¾ç¤ºå®ç°ã€‚
    ä¸Šè¿°ä¸¤ç§æ˜¾ç¤ºå®ç°æ–¹å¼éƒ½å®ç°äº†æ¥å£IRenderViewã€‚

#### å…³é”®æµç¨‹

1. è®¾ç½®surface

    {% asset_img 11.png %}

    é€šè¿‡æ¥å£_setVideoSurface()ï¼ŒæŠŠUIå±‚çš„Surfaceå¯¹è±¡ï¼ˆå¯ä»¥ç†è§£ä¸ºæ˜¾ç¤ºçª—å£ï¼‰è®¾ç½®ç»™SDLæ˜¾ç¤ºå¯¹è±¡ï¼Œä½œä¸ºå…¶æ˜¾ç¤ºçª—å£ï¼ˆnative_windowï¼‰ï¼Œè¿™æ ·SDLæœ‰éœ€è¦æ˜¾ç¤ºçš„å†…å®¹å¯ä»¥ç›´æ¥åœ¨è¿™ä¸ªæ˜¾ç¤ºçª—å£ä¸Šæ˜¾ç¤ºè¾“å‡ºå³å¯ã€‚

2. æ˜¾ç¤ºæµç¨‹

    {% asset_img 112.png %}

    è§£ç çº¿ç¨‹ffp_video_thread()è§£ç å®Œæˆä»¥åï¼Œè°ƒç”¨æ¥å£queue_picture()æŠŠéœ€è¦æ˜¾ç¤ºçš„bufferå¾€SDLæ¨¡å—å‘é€ã€‚
    ç„¶åè°ƒç”¨func_fill_frame()å¡«å……æ˜¾ç¤ºbuffer, è¿™ä¸ªæ—¶å€™éœ€è¦åˆ¤æ–­æ˜¯é€šè¿‡ffmpegè¿˜æ˜¯mediacodecå®ç°çš„è§£ç ã€‚
    å¦‚æœæ˜¯ffmpegå®ç°çš„è¯åˆ™è°ƒç”¨ijksdl_vout_overlay_ffmpeg.cä¸­çš„å‡½æ•°func_fill_frame()ã€‚
    å¦åˆ™è°ƒç”¨ijksdl_vout_overlay_android_mediacodec.cä¸­çš„func_fill_frame()ã€‚
    ç„¶åæ˜¾ç¤ºçº¿ç¨‹video_refresh_threadå°±å¯ä»¥å¼€å§‹æ˜¾ç¤ºäº†ã€‚å¦‚æœæ˜¯GPUæ”¯æŒçš„æ ¼å¼åˆ™è°ƒç”¨GPUè¿›è¡Œè¾“å‡ºï¼Œè¿™ä¸ªæ—¶å€™è°ƒç”¨çš„æ˜¯IJK_EGL_displayï¼Œå¦åˆ™è°ƒç”¨ANativeWindow_lockå’ŒANativeWindow_unlockAndPostè¿›è¡Œè¾“å‡ºã€‚

#### åŸºæœ¬ä½¿ç”¨

ijkPlayerçš„ä½¿ç”¨ä¸mediaPlayerçš„è¿‡ç¨‹åŸºæœ¬ç›¸ä¼¼ï¼Œå³å°†MediaPlayerå¯¹è±¡æ¢ä¸ºIjkMediaPlayerå¯¹è±¡ã€‚ä¸åŒçš„æ˜¯IjkMediaPlayeråœ¨ä¸åŒå¹³å°ä¸‹é’ˆå¯¹æ€§çš„åº•å±‚è§£ç ã€‚

***

### å…¶å®ƒ

DKPlayerã€GSYVideoPlayer åŸºäºijkPlayerçš„æ’­æ”¾å™¨ï¼›
JiaoZiVideoPlayer ä¸“æ³¨äºå¤šæ’­æ”¾å†…æ ¸åˆ‡æ¢ï¼Œæ–¹ä¾¿æ¥å…¥è€…ä½¿ç”¨ä¸åŒçš„æ’­æ”¾å†…æ ¸ï¼›
PLDroidPlayer ä¸“æ³¨äºå®Œæ•´ SDK çš„å¼€å‘ï¼Œä½†å®ƒç›®å‰åº”è¯¥è¿˜æ˜¯é—­æºçš„ï¼Œç”¨æˆ·éš¾ä»¥å®šåˆ¶ã€‚

***

### æ€»ç»“

**MediaPlayerï¼š**åœ¨Androidç³»ç»Ÿä¸­å¯¹äºè§†é¢‘æ’­æ”¾å™¨æœ‰åŸç”Ÿçš„å®ç°MediaPlayerï¼Œä»¥åŠå°†MediaPlayerã€SurfaceViewå°è£…åœ¨ä¸€èµ·çš„VideoViewï¼Œä¸¤è€…éƒ½åªæ˜¯ä½¿ç”¨ç¡¬è§£æ’­æ”¾ï¼ŒåŸºæœ¬ä¸Šåªæ”¯æŒæœ¬åœ°å’ŒHTTPåè®®çš„è§†é¢‘æ’­æ”¾ï¼Œæ‰©å±•æ€§éƒ½å¾ˆå·®ï¼Œåªé€‚åˆæœ€ç®€å•çš„è§†é¢‘æ’­æ”¾éœ€æ±‚ã€‚

**ExoPlayerï¼š**æä¾›äº†æ›´å¥½çš„æ‰©å±•æ€§å’Œå®šåˆ¶èƒ½åŠ›ï¼Œå¹¶åŠ å…¥äº†å¯¹DASHå’ŒHLSç­‰ç›´æ’­åè®®çš„æ”¯æŒï¼Œä½†ä¹Ÿåªæ”¯æŒç¡¬ç ï¼Œå¦‚æœé¡¹ç›®ä¸­åªéœ€è¦æ”¯æŒå¯¹H264æ ¼å¼çš„è§†é¢‘æ’­æ”¾ï¼Œä»¥åŠæµåª’ä½“åè®®æ¯”è¾ƒå¸¸è§„ï¼ˆæ¯”å¦‚HTTPï¼ŒHLSï¼‰ï¼ŒåŸºäºExoPlayerå®šåˆ¶ä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚

**IjkPlayerï¼š**æ•´åˆäº†FFMpegã€ExoPlayerã€MediaPlayerç­‰å¤šç§å®ç°ï¼Œæä¾›äº†ç±»ä¼¼äºMediaPlayerçš„APIï¼Œå¯ä»¥å®ç°è½¯ç¡¬è§£ç è‡ªç”±åˆ‡æ¢ï¼Œè‡ªå®šä¹‰TextureViewå®ç°ï¼ŒåŒæ—¶å¾—ç›ŠäºFFMpegçš„èƒ½åŠ›ï¼Œä¹Ÿèƒ½æ”¯æŒå¤šç§æµåª’ä½“åè®®ï¼ˆRTSPã€RTMPã€HLSç­‰ï¼‰ï¼Œå¤šç§è§†é¢‘ç¼–ç æ ¼å¼ï¼ˆh264ï¼Œmpeg4ï¼Œmjpeg)ï¼Œå…·æœ‰å¾ˆé«˜çš„çµæ´»æ€§ï¼Œå¯ä»¥å®šåˆ¶å®ç°è‡ªå·±ç‰¹è‰²çš„æ’­æ”¾å™¨ï¼ˆæ¯”å¦‚æ”¯æŒè§†é¢‘ç¼©æ”¾ã€è§†é¢‘ç¿»è½¬ç­‰ï¼‰ã€‚

***

### å‚è€ƒä¸é¸£è°¢

> <https://blog.csdn.net/weixin_43846184/article/details/96132895>
> <https://www.jianshu.com/p/3f2f8bf1d581>
> <https://blog.csdn.net/u014606081/article/details/79927057>
> <https://blog.csdn.net/qq_35864421/article/details/115345091>
> <https://blog.csdn.net/dengpeng_/article/details/54910840>
> <https://blog.csdn.net/codeyanbao/article/details/92842939>
> <https://cloud.tencent.com/developer/article/1824644>
> <https://blog.51cto.com/u_15127656/2803056>
> <https://exoplayer.dev/doc/reference/com/google/android/exoplayer2/ExoPlayer.html>
> <https://exoplayer.dev/doc/reference/com/google/android/exoplayer2/Player.EventListener.html>
> <https://exoplayer.dev/listening-to-player-events.html#individual-callbacks-vs-onevents>
> <https://wenxiaoming.github.io/2018/03/19/analysis-of-ijkplayer/>
> <https://zhuanlan.zhihu.com/p/256402336>
> <https://blog.csdn.net/qq_34895720/article/details/101511876>

---
title: SpindleNet：一种用于实时检测睡眠纺锤波的深度学习方法
categories:
  - 🌙进阶学习
  - ⭐脑机接口与混合智能研究团队（BCI团队）
  - 💫学习报告
abbrlink: c97be626
date: 2022-11-01 04:25:30
tags:
---

本篇学习报告的内容为：一种用于实时检测睡眠纺锤波的深度学习方法（SpindleNet），所参考的文献是《A deep learning approach for real-time detection of sleep spindles》。本文提出了一种基于单个EEG通道的深度学习方法来检测睡眠纺锤波，在测试两个公开睡眠纺锤波数据集时，SpindleNet相比其他睡眠纺锤波检测方法获得了更高的检测准确率和速度，且对不同年龄和物种的不同受试者的不同睡眠数据集具有很好的泛化能力。

<!--more-->

***

### 研究背景

#### 睡眠纺锤波的定义

睡眠纺锤波是神经振荡的短暂爆发（9-16Hz或11-16Hz，0.5-3s），由丘脑网状核和其他丘脑核在非快速眼动睡眠（N2和N3阶段）期间相互作用产生。纺锤波可以在各种丘脑和新皮层结构中观察到，并在非快速眼动睡眠期间与新皮层慢振荡（SOs，0.5-1Hz）和海马锐波波纹（SWRs，150-250Hz）在时间上耦合。

***

#### 睡眠纺锤波的作用

（1）纺锤波和SOs在不同睡眠阶段的记忆巩固或不同类型的记忆痕迹巩固中可能有不同的作用。

（2）纺锤波被认为有助于许多神经过程，如体感发育、丘脑皮质感觉门控和突触可塑性。

（3）纺锤波也与用现有知识整合新记忆有关。

***

#### 睡眠纺锤波的研究意义

（1）纺锤波密度可以预测先验知识对记忆巩固的影响。

（2）睡眠障碍是许多神经或神经精神疾病的重要症状。

（3）睡眠纺锤波的特征（如振荡频率、纺锤波密度、持续时间）可作为与大脑健康相关的重要生物标志物，用于神经退行性疾病（如轻度认知障碍和阿尔茨海默病）的早期检测，用于评估儿童的认知发展，以及预测压力和精神分裂症。

***

#### 睡眠纺锤波的研究现状

纺锤波为N2阶段的睡眠提供了重要的信号。在人类睡眠实验室中，纺锤波检测需要由睡眠专家手动注释，这是一项耗时的资源密集型任务，而且受评分者之间的差异影响。在动物睡眠研究中，没有专家注释的纺锤波公开数据集。此外，在不同的大脑区域和记录工具之间，纺锤波的特征可能有很大的差异。因此，几十年来，**睡眠纺锤波的检测一直是人类和动物睡眠研究的活跃领域。**

到目前为止，纺锤波自动检测的大部分工作都是针对特定队列的离线应用，这些应用可能依赖于各种无监督或有监督技术，包括恒定或自适应阈值、匹配追踪、时频变换、决策树和低秩优化。

尽管一些纺锤波检测算法已经被应用于在线应用，但它们的**检测延迟还没有得到充分的研究**。延迟的考虑是至关重要的，因为闭环刺激的时机会影响TMR（targeted memory reactivation，有针对性的记忆复活），声学刺激已被证明在SO下降状态的下降阶段或在皮层下降状态向上升状态的过渡期间是最有效的。此外，由于快（13-16 Hz）或慢（9-13 Hz）纺锤波可能发生在不同的SO（0.5-1s）或皮层（向上和向下）状态，它们可能在记忆巩固中发挥不同的作用。如果睡眠纺锤波检测得太晚（>350ms），那么就不能正确选择SO相位，因此刺激不会得到正确的应用。

迄今为止，**尽管已经开发了许多检测睡眠纺锤波的方法或算法，但其中大多数都不适合在线检测或实时应用**。为了适应实时处理，纺锤波检测方法需要对神经数据进行动态处理，计算速度要快于或相当于数据流的速度。**许多可用的纺锤波检测算法不能直接用于在线应用，要么是因为它们不能按顺序处理数据，要么是因为它们不能满足速度要求。**

由于带注释的纺锤波很少，本文通过计算机模拟提出了一种与合成纺锤波相结合的迁移学习方法，将纺锤波检测扩展到各种数据集（患者群体、非侵入式和侵入式EEG、人类和动物）。

***

### 研究方法

#### 实验数据

包括4个公开的人类睡眠数据集、1个非公开的人类睡眠纺锤波数据集和1个非公开的老鼠睡眠数据集。

（1）MASS（5折交叉验证）

MASS由几个组群组成，组群被划分为子集。队列1有5个子集，包括97名男性和103名女性的200个完整夜间PSG记录，年龄在18-76岁之间（平均±SD：38.3±18.9岁）。

（2）DREAMS（睡眠专家标注存在不同之处，用他们标注的合集评估模型性能）

DREAMS数据集由8名患有各种睡眠病理（睡眠障碍、不安综合征、失眠和呼吸暂停/低通气综合征）的受试者（4男4女，年龄：45.88±7.87岁）30分钟的PSG摘录组成。

（3）（第三、四个数据集）NSRR（国家睡眠研究资源存储库）

第三个数据集来自老年男性（65岁或以上）的夜间PSG记录。第四个数据集来自儿童（5岁至9.9岁）的夜间PSG数据。从每个数据集中随机选择5名受试者进行实验。

（4）iEEG（由颅内脑电图记录组成，来自18名癫痫患者，侵入式监测）

选择3名受试者，对他们随机施加声学刺激，产生了睡眠纺锤波。

（5）rat sleep recordings

用异氟醚（1.5-2%）麻醉大鼠，并植入安装在定制微驱动器上的硅探针。在右脑植入了一两个探针。

***

#### SpindleNet的训练设置

SpindleNet包含两个深度学习模块：CNN和RNN。（集成在顺序结构中）

{% asset_img 1.webp %}
<div align='center'>图1 Spindle的整体结构</div>

{% asset_img 2.webp %}
<div align='center'>图2 CNN的结构</div>

CNN由5个卷积层组成，每层有40个大小为1×7的一维时间滤波器，后面是指数线性单元。CNN的输入由原始脑电图时间序列的1 × 50矢量组成。RNN的输入由相同长度的带通滤波信号的包络组成。最后，将脑电图功率特征与CNN和RNN的输出结合，并通过全连接层处理连接向量。

***

#### 数据校准

EEG信号具有不同的振幅或方差统计，具体取决于睡眠阶段、电极电导和记录深度。因此，本文将尺度归一化应用于数据校准。在基准实验测试中，选择尺度作为专家标注纺锤波的平均标准差。对于其他数据集，用数据集中随机选择的受试者的原始时间序列的标准差统计量对信号（EEG、iEEG或啮齿类动物LFP）进行缩放。这是基于这样的假设，即在NREM睡眠中纺锤波振幅与EEG振幅的比率相似或稳定。

***

#### 数据增强

{% asset_img 3.webp %}
<div align='center'>图3 移动窗口示例</div>

纺锤波的出现分布在NREM（N2、N3）睡眠的第2或第3阶段，其**密度**因受试者和病理而异。这**导致了一个不平衡的数据集**，来自正类（纺锤波）的样本比来自负类（非纺锤波）的样本少。为了产生平衡的训练样本量，增加了正类和负类，直到它们平衡。这是通过在纺锤波中心前后选择一个固定的时间间隔，并使用一个大小为Tw，步幅为1的移动窗口来生成样本。对于长度为Tw的每个窗口，如果该窗口内超过50%的样本与专家标注的纺锤波重叠，则生成一个正标签；否则使用负标签。

***

#### 特征选择和融合

纺锤波的特征是在光谱图的纺锤波段（9-16 Hz）有局部的高功率。在纺锤波段预处理后计算功率特征，功率特征被附加到两个子网络的RNN的输出。

***

#### 睡眠纺锤波的线上&线下检测

根据具体的应用，采用不同的标准来定义睡眠纺锤波。在线上检测中，延迟是最重要的因素。而对于线下检测应用，检测延迟不是问题，因此使用更严格的持续时间标准来消除小于指定长度（例如400ms）的检测事件。

设置了两个检测标准（softmax概率和最小纺锤波持续时间）来确定在线检测的置信度。引入最小纺锤波持续时间将引入检测延迟。相反，在线下检测中将没有持续时间标准。

***

#### 性能评估

{% asset_img 4.webp %}
{% asset_img 5.webp %}
{% asset_img 6.webp %}

当算法估计的纺锤波起始点与真值起始点之间的绝对差小于0.25s时，评估为positive。通过比较SpindleNet检测到的纺锤波起始点与专家注释的纺锤波起始点计算检测延迟。

***

#### 合成纺锤波的生成

拟合QPS模型对睡眠纺锤波进行测试，分别计算每个受试者的模拟参数，用于生成合成纺锤波。

{% asset_img 7.webp %}
<div align='center'>图4 合成纺锤波生成的原理图</div>

调幅后的QPS描述符+带阻EEG baseline+宽带噪声=合成纺锤波

***

#### 其他睡眠纺锤波检测方法（用于与本文方法比较）

（1）McSleep

McSleep算法是一种非线性子空间检测方法，它将输入的脑电信号分解为瞬态和振荡分量的总和。通过Teager算子进一步检测振荡活动的envelope（包络，信号局部最大值的变化情况），然后进行纺锤波阈值检测。

（2）Spindler

Spindler使用Gabor原子进行匹配追踪以估计纺锤波位置，然后对其阈值化以进一步识别纺锤波。

***

#### 检测结果一致性的评估（Cohen’s kappa）

{% asset_img 8.webp %}

P(a)表示观察到的一致性百分比，P(e)表示在一个机会水平上预期一致的概率（对于二分类问题，P(e)=0.5）。κ=1表示完全一致。

***

### 实验结果

#### 两个带注释的人类睡眠数据集的结果

（1）MASS

sensitivity：90.07± 2.16%

specificity：96.19 ± 0.71%

FDR：30.36 ± 5.88%

F1-score：0.75 ± 0.05

AUROC：98.97 ± 0.13%

（AUROC是一个介于0到1之间的数值，当AUROC值接近于1时，表示分类器可以较好的分类正负样本。）

比较了假阳性（FP）检测的统计数据与纺锤波TPs（ground truth）检测的持续时间和功率，发现这两个集合在重叠特征空间中几乎不可分割，表明SpindleNet检测到的纺锤波可能被专家遗漏。

（2）DREAMS

sensitivity：77.85 ± 4.28%

specificity：94.2 ± 1.26%

FDR：61.96 ± 7.39%

F1-score：0.48 ± 0.07

AUROC：95.97 ± 0.96%

{% asset_img 9.webp %}
<div align='center'>图5 DREAMS数据集上的统计结果</div>

（3）不同输入组成对应的性能比较

{% asset_img 10.webp %}
<div align='center'>图6 MASS数据集上不同输入特征下的性能比较</div>

（4）对EEG信号采样频率的鲁棒性

{% asset_img 11.webp %}
<div align='center'>图7 不同采样频率下的睡眠纺锤波频谱图</div>

***

#### 和最先进纺锤波检测方法的比较

{% asset_img 12.webp %}
<div align='center'>图8 不同算法在不同数据集上的性能比较</div>

（1）MASS

{% asset_img 13.webp %}

（2）DREAMS

与MASS类似

***

#### 其他数据集和迁移学习的应用

从所有组的脑电图记录中注释大量睡眠纺锤波的成本很高，因此有了迁移学习的应用。

{% asset_img 14.webp %}
<div align='center'>图9 不同年龄和物种对应的睡眠纺锤波示例</div>

{% asset_img 15.webp %}
<div align='center'>图10 SpindleNet和McSleep算法在不同睡眠纺锤波特征上的比较</div>

SpindleNet生成的纺锤波统计数据可与McSleep算法相媲美。

***

### 总结和思考

#### 总结

（1）从人类睡眠中学习到的SpindleNet知识可以直接用于识别老鼠的睡眠纺锤波，尽管纺锤波统计数据存在物种间差异。

（2）SpindleNet对EEG记录的采样频率不敏感并且对噪声具有鲁棒性。

（3）以往的研究主要依赖于将CNN或RNN应用于单个域的EEG数据，本文采用CNN和RNN结合的方法，并结合功率特征对时域的EEG数据进行处理。

***

#### 创新点

**改进前：**

（1）大多数纺锤波检测方法依赖于对过滤后的EEG数据进行线下处理，然后采用各种阈值算法。

（2）没有检测延迟的方法。

（3）基于阈值的检测方法往往对全局最优阈值的选择非常敏感，阈值适应是纯启发式的。

**改进后：**

（1）SpindleNet通过学习高阶光谱时间滤波器和时间结构克服了这些限制。以前的方法在受试者、疾病和物种之间的可扩展性有限，因为它们需要手动调整特征和参数。

（2）本文的方法能够泛化数据集并学习常见的光谱时间特征。

（3）SpindleNet能够学习对纺锤波检测最具鉴别力的纺锤波特征，因此与其他检测方法相比，它在多个性能指标上始终表现更好。

***

#### 不足之处

本文方法仅限于标记数据和监督学习。（结合无监督深度学习方法进行特征选择可以克服标记数据的样本量问题，并进一步提高睡眠纺锤波的检测性能。）

***

#### 未来工作

（1）来自SpindleNet的强大检测性能突出了数据驱动深度学习的优势。然而，要全面比较不同的睡眠纺锤波方法，需要一个或多个独立的、大型的带注释的纺锤波数据集。

（2）本文的深度学习方法是否可以推广到检测不同神经状态下的其他EEG振荡。

***

### 原文链接

> <https://www.scholat.com/teamwork/showPostMessage.html?id=12551>
